<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Saúl Gil">
<meta name="author" content="Pedro Peñalver">
<meta name="author" content="Joel Seguí">
<meta name="description" content="Vamos a analizar el mercado de la vivienda y comprarlo con su accesibilidad de los jóvenes">
<title>Vivienda en España - VIVIENDA EN ESPAÑA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./imagenes/my_favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": true,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: lightgrey;
      }

      .quarto-title-block .quarto-title-banner {
        color: lightgrey;
      }
</style>
<script src="site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="site_libs/plotly-binding-4.10.2/plotly.js"></script><script src="site_libs/typedarray-0.1/typedarray.min.js"></script><script src="site_libs/jquery-3.5.1/jquery.min.js"></script><link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link rel="stylesheet" href="my_styles.css">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./my_favicon.png" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Vivienda en España</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Buscar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Navegación de palanca" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item compact">
    <a class="nav-link" href="./index.html" rel="" target=""><i class="bi bi-house-door" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link active" href="./my_trabajo_BigData.html" rel="" target="" aria-current="page">
 <span class="menu-text">Trabajo en equipo</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./my_slides_BigData.html" rel="" target="_blank">
 <span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:tu-mail@alumni.uv.es" rel="" target=""><i class="bi bi-envelope" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
<div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <div class="quarto-title-block"><div><h1 class="title">VIVIENDA EN ESPAÑA</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Código</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Mostrar todo el código</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Ocultar todo el código</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">Ver el código fuente</a></li></ul></div></div>
                  <div>
        <div class="description">
          <p>Vamos a analizar el mercado de la vivienda y comprarlo con su accesibilidad de los jóvenes</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Trabajo BigData</div>
                <div class="quarto-category">Vivienda</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Autores/as</div>
      <div class="quarto-title-meta-contents">
               <p>Saúl Gil </p>
               <p>Pedro Peñalver </p>
               <p>Joel Seguí </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Fecha de publicación</div>
      <div class="quarto-title-meta-contents">
        <p class="date">1 de noviembre de 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Índice</h2>
   
  <ul>
<li><a href="#introducci%C3%B3n" id="toc-introducción" class="nav-link active" data-scroll-target="#introducci%C3%B3n">Introducción</a></li>
  <li><a href="#datos-del-trabajo" id="toc-datos-del-trabajo" class="nav-link" data-scroll-target="#datos-del-trabajo">Datos del trabajo</a></li>
  <li><a href="#evoluci%C3%B3n-de-la-renta-neta-por-edad" id="toc-evolución-de-la-renta-neta-por-edad" class="nav-link" data-scroll-target="#evoluci%C3%B3n-de-la-renta-neta-por-edad">Evolución de la renta neta por edad</a></li>
  <li><a href="#%C3%ADndice-del-nivel-de-precios-de-la-vivienda-a-nivel-nacional" id="toc-índice-del-nivel-de-precios-de-la-vivienda-a-nivel-nacional" class="nav-link" data-scroll-target="#%C3%ADndice-del-nivel-de-precios-de-la-vivienda-a-nivel-nacional">Índice del nivel de Precios de la vivienda a nivel nacional</a></li>
  <li><a href="#variaci%C3%B3n-del-indice-de-precios-de-la-vivienda" id="toc-variación-del-indice-de-precios-de-la-vivienda" class="nav-link" data-scroll-target="#variaci%C3%B3n-del-indice-de-precios-de-la-vivienda">Variación del Indice de Precios de la Vivienda</a></li>
  <li><a href="#mapa-de-coropletas-vivienda-por-ccaa" id="toc-mapa-de-coropletas-vivienda-por-ccaa" class="nav-link" data-scroll-target="#mapa-de-coropletas-vivienda-por-ccaa">Mapa de coropletas: Vivienda por CCAA</a></li>
  <li><a href="#r%C3%A9gimen-de-viviendas-de-16-a-29-a%C3%B1os" id="toc-régimen-de-viviendas-de-16-a-29-años" class="nav-link" data-scroll-target="#r%C3%A9gimen-de-viviendas-de-16-a-29-a%C3%B1os">Régimen de viviendas de 16 a 29 años</a></li>
  <li><a href="#otros-gr%C3%A1ficos-bonitos-pero-poco-%C3%BAtiles-sobre-el-salario" id="toc-otros-gráficos-bonitos-pero-poco-útiles-sobre-el-salario" class="nav-link" data-scroll-target="#otros-gr%C3%A1ficos-bonitos-pero-poco-%C3%BAtiles-sobre-el-salario">Otros gráficos bonitos pero poco útiles sobre el salario</a></li>
  <li><a href="#mas-informaci%C3%B3n-sobre-el-tema" id="toc-mas-información-sobre-el-tema" class="nav-link" data-scroll-target="#mas-informaci%C3%B3n-sobre-el-tema">Mas información sobre el tema</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content"><section id="introducción" class="level1"><h1>Introducción</h1>
<p>El objetivo de este trabajo es analizar la situación en la que se encuentran los jóvenes a la hora de acceder al mercado laboral. Para ello analizaremos diferentes métricas entre las que se encuentran: Evolución de los niveles de precios de la vivienda a nivel nacional y autonómico, comparación de esta con la de los salarios reales…</p>
<p>De esta manera constataremos las dificultades a alas que se enfrentan los jóvenes españoles para emanciparse. También extraeremos conclusiones sobre si es así en todo el país o si por el contrario hay diferencias según el área geográfica.</p>
</section><section id="datos-del-trabajo" class="level1"><h1>Datos del trabajo</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Datos</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Código</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Vamos a utilizar datos de los paquetes <code>pxR</code> <i>(ine)</i>, <code>eurostat</code> además de proveedores de datos externos.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-layout-align="center">
<details open=""><summary>Código</summary><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">#Paquetes Preliminares</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(pxR)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(rlist)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(fs)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">library</span>(curl)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">library</span>(rio)</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="fu">library</span>(downloader)</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="fu">library</span>(writexl)</span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">#-------------------Creamos una carpeta para guardar los datos------------------</span></span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="fu">dir_create</span>(<span class="st">"./docs/datos"</span>)</span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="co">#Descargamos los datos y los exportamos sin pulir: </span></span>
<span id="cb1-18"><a href="#cb1-18"></a></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co">#---------------------Índice de Precios de Vivienda-----------------------------</span></span>
<span id="cb1-20"><a href="#cb1-20"></a></span>
<span id="cb1-21"><a href="#cb1-21"></a>url <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/px/25171.px?nocab=1"</span></span>
<span id="cb1-22"><a href="#cb1-22"></a>aa <span class="ot">&lt;-</span> <span class="fu">read.px</span>(url)</span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="co">#Lo convertimos a CSV para simplificar y creamos un dataframe</span></span>
<span id="cb1-25"><a href="#cb1-25"></a></span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="fu">write.csv</span>(aa, <span class="at">file =</span> <span class="st">"data.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb1-27"><a href="#cb1-27"></a>IPV <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data.csv"</span>)</span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()[<span class="sc">!</span><span class="fu">ls</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"IPV"</span>)])</span>
<span id="cb1-29"><a href="#cb1-29"></a></span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="co">#Los guardamos sin arreglar</span></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="fu">write.csv</span>(IPV,  <span class="at">file =</span> <span class="st">"./docs/datos/ipv.csv"</span>)</span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="co">#-------------------------Compra-venta de vivienda------------------------------</span></span>
<span id="cb1-33"><a href="#cb1-33"></a></span>
<span id="cb1-34"><a href="#cb1-34"></a>ruta_xls <span class="ot">&lt;-</span> <span class="st">"https://apps.fomento.gob.es/BoletinOnline2/sedal/34010110.XLS"</span></span>
<span id="cb1-35"><a href="#cb1-35"></a></span>
<span id="cb1-36"><a href="#cb1-36"></a><span class="fu">download.file</span>(ruta_xls, <span class="st">"datos.xls"</span>, <span class="at">mode =</span> <span class="st">"wb"</span>)</span>
<span id="cb1-37"><a href="#cb1-37"></a></span>
<span id="cb1-38"><a href="#cb1-38"></a>nombres_hojas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2004,2005,2006,2007,2008"</span>, <span class="st">"2009,2010,2011,2012,2013"</span>, </span>
<span id="cb1-39"><a href="#cb1-39"></a>                   <span class="st">"2014,2015,2016,2017,2018"</span>, <span class="st">"2019,2020,2021,2022,2023"</span>)</span>
<span id="cb1-40"><a href="#cb1-40"></a><span class="co"># Leer todas las hojas en una lista</span></span>
<span id="cb1-41"><a href="#cb1-41"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(nombres_hojas)) {</span>
<span id="cb1-42"><a href="#cb1-42"></a>  hoja <span class="ot">&lt;-</span> nombres_hojas[i]</span>
<span id="cb1-43"><a href="#cb1-43"></a>  df <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"datos.xls"</span>, <span class="at">sheet =</span> i) </span>
<span id="cb1-44"><a href="#cb1-44"></a>  <span class="fu">write.csv</span>(df, <span class="at">file =</span> <span class="fu">paste0</span>(hoja, <span class="st">".csv"</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>)}</span>
<span id="cb1-45"><a href="#cb1-45"></a></span>
<span id="cb1-46"><a href="#cb1-46"></a><span class="co">#Juntamos las cuatro sheets en una y después arreglaremos el desastre</span></span>
<span id="cb1-47"><a href="#cb1-47"></a>compraventa_2004 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"2004,2005,2006,2007,2008.csv"</span>)</span>
<span id="cb1-48"><a href="#cb1-48"></a>compraventa_2009 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"2009,2010,2011,2012,2013.csv"</span>)</span>
<span id="cb1-49"><a href="#cb1-49"></a>compraventa_2014 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"2014,2015,2016,2017,2018.csv"</span>)</span>
<span id="cb1-50"><a href="#cb1-50"></a>compraventa_2019 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"2019,2020,2021,2022,2023.csv"</span>)</span>
<span id="cb1-51"><a href="#cb1-51"></a></span>
<span id="cb1-52"><a href="#cb1-52"></a>cv <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(compraventa_2009,compraventa_2014)</span>
<span id="cb1-53"><a href="#cb1-53"></a>cv <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(cv,compraventa_2019)</span>
<span id="cb1-54"><a href="#cb1-54"></a>compraventa_2004 <span class="ot">&lt;-</span> compraventa_2004[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(cv), ]</span>
<span id="cb1-55"><a href="#cb1-55"></a>cv <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(cv,compraventa_2004)</span>
<span id="cb1-56"><a href="#cb1-56"></a></span>
<span id="cb1-57"><a href="#cb1-57"></a></span>
<span id="cb1-58"><a href="#cb1-58"></a>cv <span class="ot">&lt;-</span> cv <span class="sc">%&gt;%</span></span>
<span id="cb1-59"><a href="#cb1-59"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">72</span>)</span>
<span id="cb1-60"><a href="#cb1-60"></a>cv <span class="ot">&lt;-</span> cv <span class="sc">%&gt;%</span></span>
<span id="cb1-61"><a href="#cb1-61"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="dv">2</span>)</span>
<span id="cb1-62"><a href="#cb1-62"></a></span>
<span id="cb1-63"><a href="#cb1-63"></a><span class="co">#Los guardamos sin arreglar</span></span>
<span id="cb1-64"><a href="#cb1-64"></a><span class="fu">write.csv</span>(cv,  <span class="at">file =</span> <span class="st">"./docs/datos/cv.csv"</span>)</span>
<span id="cb1-65"><a href="#cb1-65"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-66"><a href="#cb1-66"></a></span>
<span id="cb1-67"><a href="#cb1-67"></a></span>
<span id="cb1-68"><a href="#cb1-68"></a><span class="co">#--------------------------Renta por edad y sexo--------------------------------</span></span>
<span id="cb1-69"><a href="#cb1-69"></a></span>
<span id="cb1-70"><a href="#cb1-70"></a>url3 <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/px/9942.px?nocab=1"</span></span>
<span id="cb1-71"><a href="#cb1-71"></a>aa <span class="ot">&lt;-</span> <span class="fu">read.px</span>(url3)</span>
<span id="cb1-72"><a href="#cb1-72"></a></span>
<span id="cb1-73"><a href="#cb1-73"></a><span class="co">#Lo convertimos a CSV para simplificar y creamos un dataframe</span></span>
<span id="cb1-74"><a href="#cb1-74"></a></span>
<span id="cb1-75"><a href="#cb1-75"></a><span class="fu">write.csv</span>(aa, <span class="at">file =</span> <span class="st">"data.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb1-76"><a href="#cb1-76"></a>renta_edad <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data.csv"</span>)</span>
<span id="cb1-77"><a href="#cb1-77"></a></span>
<span id="cb1-78"><a href="#cb1-78"></a><span class="co">#Los guardamos sin arreglar</span></span>
<span id="cb1-79"><a href="#cb1-79"></a><span class="fu">write.csv</span>(renta_edad, <span class="at">file =</span> <span class="st">"./docs/datos/renta_edad.csv"</span>)</span>
<span id="cb1-80"><a href="#cb1-80"></a></span>
<span id="cb1-81"><a href="#cb1-81"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-82"><a href="#cb1-82"></a><span class="co">#---------------------------Renta por nacionalidad------------------------------</span></span>
<span id="cb1-83"><a href="#cb1-83"></a></span>
<span id="cb1-84"><a href="#cb1-84"></a>url4 <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/px/9945.px?nocab=1"</span></span>
<span id="cb1-85"><a href="#cb1-85"></a>aa <span class="ot">&lt;-</span> <span class="fu">read.px</span>(url4)</span>
<span id="cb1-86"><a href="#cb1-86"></a></span>
<span id="cb1-87"><a href="#cb1-87"></a><span class="co">#Lo convertimos a CSV para simplificar y creamos un dataframe</span></span>
<span id="cb1-88"><a href="#cb1-88"></a></span>
<span id="cb1-89"><a href="#cb1-89"></a><span class="fu">write.csv</span>(aa, <span class="at">file =</span> <span class="st">"data.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb1-90"><a href="#cb1-90"></a>renta_nacionalidad <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data.csv"</span>)</span>
<span id="cb1-91"><a href="#cb1-91"></a></span>
<span id="cb1-92"><a href="#cb1-92"></a><span class="co">#Los guardamos sin arreglar</span></span>
<span id="cb1-93"><a href="#cb1-93"></a><span class="fu">write.csv</span>(renta_nacionalidad, <span class="at">file =</span> <span class="st">"./docs/datos/renta_nacionalidad.csv"</span>)</span>
<span id="cb1-94"><a href="#cb1-94"></a></span>
<span id="cb1-95"><a href="#cb1-95"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-96"><a href="#cb1-96"></a></span>
<span id="cb1-97"><a href="#cb1-97"></a></span>
<span id="cb1-98"><a href="#cb1-98"></a><span class="co">#---------------------Hogares por regimen de tenencia edad----------------------</span></span>
<span id="cb1-99"><a href="#cb1-99"></a></span>
<span id="cb1-100"><a href="#cb1-100"></a>url4 <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/px/9994.px?nocab=1"</span></span>
<span id="cb1-101"><a href="#cb1-101"></a>aa <span class="ot">&lt;-</span> <span class="fu">read.px</span>(url4)</span>
<span id="cb1-102"><a href="#cb1-102"></a></span>
<span id="cb1-103"><a href="#cb1-103"></a><span class="co">#Lo convertimos a CSV para simplificar y creamos un dataframe</span></span>
<span id="cb1-104"><a href="#cb1-104"></a></span>
<span id="cb1-105"><a href="#cb1-105"></a><span class="fu">write.csv</span>(aa, <span class="at">file =</span> <span class="st">"data.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb1-106"><a href="#cb1-106"></a>vivienda_edad <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data.csv"</span>)</span>
<span id="cb1-107"><a href="#cb1-107"></a></span>
<span id="cb1-108"><a href="#cb1-108"></a><span class="co">#Los guardamos sin arreglar</span></span>
<span id="cb1-109"><a href="#cb1-109"></a><span class="fu">write.csv</span>(vivienda_edad, <span class="at">file =</span> <span class="st">"./docs/datos/vivienda_datos.csv"</span>)</span>
<span id="cb1-110"><a href="#cb1-110"></a></span>
<span id="cb1-111"><a href="#cb1-111"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-112"><a href="#cb1-112"></a></span>
<span id="cb1-113"><a href="#cb1-113"></a><span class="co">#Borramos archivos como las sheets separadas y otros datos</span></span>
<span id="cb1-114"><a href="#cb1-114"></a><span class="fu">file.remove</span>(<span class="st">"2004,2005,2006,2007,2008.csv"</span>, <span class="st">"2009,2010,2011,2012,2013.csv"</span>,</span>
<span id="cb1-115"><a href="#cb1-115"></a>            <span class="st">"2014,2015,2016,2017,2018.csv"</span>, <span class="st">"2019,2020,2021,2022,2023.csv"</span>, </span>
<span id="cb1-116"><a href="#cb1-116"></a>            <span class="st">"compraventa.csv"</span>, <span class="st">"data.csv"</span>, <span class="st">"datos.xls"</span>, <span class="st">"./docs/datos/25171.px"</span>,</span>
<span id="cb1-117"><a href="#cb1-117"></a>            <span class="st">"./docs/datos/34010110.XLS"</span>)</span>
<span id="cb1-118"><a href="#cb1-118"></a><span class="co">#&gt; [1]  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE FALSE FALSE</span></span>
<span id="cb1-119"><a href="#cb1-119"></a></span>
<span id="cb1-120"><a href="#cb1-120"></a><span class="co">#----------------------Procedemos a limpiar los datos---------------------------</span></span>
<span id="cb1-121"><a href="#cb1-121"></a></span>
<span id="cb1-122"><a href="#cb1-122"></a><span class="co">#-------------Creamos una carpeta para guardar los datos pulidos----------------</span></span>
<span id="cb1-123"><a href="#cb1-123"></a></span>
<span id="cb1-124"><a href="#cb1-124"></a><span class="fu">dir_create</span>(<span class="st">"./datos_pulidos"</span>)</span>
<span id="cb1-125"><a href="#cb1-125"></a><span class="fu">library</span>(zoo)</span>
<span id="cb1-126"><a href="#cb1-126"></a></span>
<span id="cb1-127"><a href="#cb1-127"></a><span class="do">###AHORA LIMPIAMOS LOS DATOS PARA TRABAJAR MEJOR CON ELLOS###</span></span>
<span id="cb1-128"><a href="#cb1-128"></a></span>
<span id="cb1-129"><a href="#cb1-129"></a><span class="co">#-------------------Indice de precios de la Vivienda----------------------------</span></span>
<span id="cb1-130"><a href="#cb1-130"></a></span>
<span id="cb1-131"><a href="#cb1-131"></a>cv <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="at">file =</span> <span class="st">"./docs/datos/cv.csv"</span>)</span>
<span id="cb1-132"><a href="#cb1-132"></a></span>
<span id="cb1-133"><a href="#cb1-133"></a><span class="co">#Elimino las columnas duplicadas indicando el nombre de la provincia </span></span>
<span id="cb1-134"><a href="#cb1-134"></a><span class="co">#para dejar solo una columna de provincias</span></span>
<span id="cb1-135"><a href="#cb1-135"></a></span>
<span id="cb1-136"><a href="#cb1-136"></a>cv <span class="ot">&lt;-</span> cv[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb1-137"><a href="#cb1-137"></a><span class="fu">colnames</span>(cv) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-138"><a href="#cb1-138"></a>columnas_duplicadas <span class="ot">&lt;-</span> <span class="fu">duplicated</span>(<span class="fu">t</span>(cv))</span>
<span id="cb1-139"><a href="#cb1-139"></a><span class="fu">print</span>(columnas_duplicadas)</span>
<span id="cb1-140"><a href="#cb1-140"></a><span class="co">#&gt;  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span></span>
<span id="cb1-141"><a href="#cb1-141"></a><span class="co">#&gt; [13] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE</span></span>
<span id="cb1-142"><a href="#cb1-142"></a><span class="co">#&gt; [25] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span></span>
<span id="cb1-143"><a href="#cb1-143"></a><span class="co">#&gt; [37] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE</span></span>
<span id="cb1-144"><a href="#cb1-144"></a><span class="co">#&gt; [49] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span></span>
<span id="cb1-145"><a href="#cb1-145"></a><span class="co">#&gt; [61] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span></span>
<span id="cb1-146"><a href="#cb1-146"></a><span class="co">#&gt; [73] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span></span>
<span id="cb1-147"><a href="#cb1-147"></a></span>
<span id="cb1-148"><a href="#cb1-148"></a>cv <span class="ot">&lt;-</span> cv[, <span class="sc">!</span>columnas_duplicadas]</span>
<span id="cb1-149"><a href="#cb1-149"></a><span class="fu">colnames</span>(cv) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"col_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(cv))</span>
<span id="cb1-150"><a href="#cb1-150"></a><span class="co">#Elimino otra columnaa duplicadaa que el argumento no encuenrtra </span></span>
<span id="cb1-151"><a href="#cb1-151"></a></span>
<span id="cb1-152"><a href="#cb1-152"></a>cv <span class="ot">&lt;-</span> cv[, <span class="sc">-</span><span class="dv">62</span>]</span>
<span id="cb1-153"><a href="#cb1-153"></a></span>
<span id="cb1-154"><a href="#cb1-154"></a><span class="co">#Doy nombre a la posición [1,2] de provincias para después poder trabajar mejor</span></span>
<span id="cb1-155"><a href="#cb1-155"></a><span class="co">#Ya que convertiremos la primera fila en colnames</span></span>
<span id="cb1-156"><a href="#cb1-156"></a></span>
<span id="cb1-157"><a href="#cb1-157"></a>cv[<span class="dv">1</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">"Provincia"</span></span>
<span id="cb1-158"><a href="#cb1-158"></a><span class="fu">colnames</span>(cv)</span>
<span id="cb1-159"><a href="#cb1-159"></a><span class="co">#&gt;  [1] "col_1"  "col_2"  "col_3"  "col_4"  "col_5"  "col_6"  "col_7"  "col_8" </span></span>
<span id="cb1-160"><a href="#cb1-160"></a><span class="co">#&gt;  [9] "col_9"  "col_10" "col_11" "col_12" "col_13" "col_14" "col_15" "col_16"</span></span>
<span id="cb1-161"><a href="#cb1-161"></a><span class="co">#&gt; [17] "col_17" "col_18" "col_19" "col_20" "col_21" "col_22" "col_23" "col_24"</span></span>
<span id="cb1-162"><a href="#cb1-162"></a><span class="co">#&gt; [25] "col_25" "col_26" "col_27" "col_28" "col_29" "col_30" "col_31" "col_32"</span></span>
<span id="cb1-163"><a href="#cb1-163"></a><span class="co">#&gt; [33] "col_33" "col_34" "col_35" "col_36" "col_37" "col_38" "col_39" "col_40"</span></span>
<span id="cb1-164"><a href="#cb1-164"></a><span class="co">#&gt; [41] "col_41" "col_42" "col_43" "col_44" "col_45" "col_46" "col_47" "col_48"</span></span>
<span id="cb1-165"><a href="#cb1-165"></a><span class="co">#&gt; [49] "col_49" "col_50" "col_51" "col_52" "col_53" "col_54" "col_55" "col_56"</span></span>
<span id="cb1-166"><a href="#cb1-166"></a><span class="co">#&gt; [57] "col_57" "col_58" "col_59" "col_60" "col_61" "col_63" "col_64" "col_65"</span></span>
<span id="cb1-167"><a href="#cb1-167"></a><span class="co">#&gt; [65] "col_66" "col_67" "col_68" "col_69" "col_70" "col_71" "col_72" "col_73"</span></span>
<span id="cb1-168"><a href="#cb1-168"></a><span class="co">#&gt; [73] "col_74" "col_75" "col_76" "col_77" "col_78" "col_79" "col_80" "col_81"</span></span>
<span id="cb1-169"><a href="#cb1-169"></a><span class="co">#&gt; [81] "col_82"</span></span>
<span id="cb1-170"><a href="#cb1-170"></a></span>
<span id="cb1-171"><a href="#cb1-171"></a><span class="co">#Seleccionamos la primera fila del df y lo convertimos en un vector. Después, </span></span>
<span id="cb1-172"><a href="#cb1-172"></a><span class="co">#Hacemos que los NA se sustituyan por el texto de su izquierda (Remplazamos NA`s</span></span>
<span id="cb1-173"><a href="#cb1-173"></a><span class="co">#por el año al que corresponde esa columnas)</span></span>
<span id="cb1-174"><a href="#cb1-174"></a></span>
<span id="cb1-175"><a href="#cb1-175"></a>df <span class="ot">&lt;-</span> cv <span class="sc">%&gt;%</span></span>
<span id="cb1-176"><a href="#cb1-176"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-177"><a href="#cb1-177"></a>  <span class="fu">unlist</span>()</span>
<span id="cb1-178"><a href="#cb1-178"></a></span>
<span id="cb1-179"><a href="#cb1-179"></a>df <span class="ot">&lt;-</span> <span class="fu">na.locf</span>(df)</span>
<span id="cb1-180"><a href="#cb1-180"></a></span>
<span id="cb1-181"><a href="#cb1-181"></a><span class="co">#Ahora convertimos el vector en la fila 1 que después convrtiremos en colnames</span></span>
<span id="cb1-182"><a href="#cb1-182"></a><span class="co">#para trabajar mejor.</span></span>
<span id="cb1-183"><a href="#cb1-183"></a></span>
<span id="cb1-184"><a href="#cb1-184"></a>cv[<span class="dv">1</span>,] <span class="ot">&lt;-</span> df </span>
<span id="cb1-185"><a href="#cb1-185"></a></span>
<span id="cb1-186"><a href="#cb1-186"></a><span class="co">#Juntamos la fila 1 y 2 a partir de la tercer columna separando el texto con "_" </span></span>
<span id="cb1-187"><a href="#cb1-187"></a><span class="co">#y le rellenamos las dos columnas restantes con los nombres que nos vengan mejor </span></span>
<span id="cb1-188"><a href="#cb1-188"></a><span class="co">#para trabajar</span></span>
<span id="cb1-189"><a href="#cb1-189"></a>aa <span class="ot">&lt;-</span> cv[<span class="dv">1</span>,]</span>
<span id="cb1-190"><a href="#cb1-190"></a>aa <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">""</span>,<span class="st">"Provincia"</span>,<span class="fu">paste</span>(cv[<span class="dv">1</span>,<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(cv)],cv[<span class="dv">2</span>,<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(cv)], <span class="at">sep =</span> <span class="st">"_"</span>))</span>
<span id="cb1-191"><a href="#cb1-191"></a></span>
<span id="cb1-192"><a href="#cb1-192"></a><span class="co">#Convertimos el vector aa en colnames</span></span>
<span id="cb1-193"><a href="#cb1-193"></a></span>
<span id="cb1-194"><a href="#cb1-194"></a><span class="fu">colnames</span>(cv) <span class="ot">=</span> aa</span>
<span id="cb1-195"><a href="#cb1-195"></a></span>
<span id="cb1-196"><a href="#cb1-196"></a><span class="co">#Quitamos la primera y la segunda fila, es información que ya indica colnames</span></span>
<span id="cb1-197"><a href="#cb1-197"></a></span>
<span id="cb1-198"><a href="#cb1-198"></a>cv <span class="ot">&lt;-</span> cv[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="sc">-</span>(<span class="dv">1</span>)]</span>
<span id="cb1-199"><a href="#cb1-199"></a><span class="fu">colnames</span>(cv)</span>
<span id="cb1-200"><a href="#cb1-200"></a><span class="co">#&gt;  [1] "Provincia"        "Año 2009_1º"      "Año 2009_2º"      "Año 2009_3º"     </span></span>
<span id="cb1-201"><a href="#cb1-201"></a><span class="co">#&gt;  [5] "Año 2009_4º"      "Año 2010_1º"      "Año 2010_2º"      "Año 2010_3º"     </span></span>
<span id="cb1-202"><a href="#cb1-202"></a><span class="co">#&gt;  [9] "Año 2010_4º"      "Año 2011_1º"      "Año 2011_2º"      "Año 2011_3º"     </span></span>
<span id="cb1-203"><a href="#cb1-203"></a><span class="co">#&gt; [13] "Año 2011_4º"      "Año 2012_1º"      "Año 2012_2º"      "Año 2012_3º"     </span></span>
<span id="cb1-204"><a href="#cb1-204"></a><span class="co">#&gt; [17] "Año 2012_4º"      "Año 2013_1º"      "Año 2013_2º"      "Año 2013_3º"     </span></span>
<span id="cb1-205"><a href="#cb1-205"></a><span class="co">#&gt; [21] "Año 2013_4º"      "Año 2014_1º"      "Año 2014_2º"      "Año 2014_3º"     </span></span>
<span id="cb1-206"><a href="#cb1-206"></a><span class="co">#&gt; [25] "Año 2014_4º"      "Año 2015_1º"      "Año 2015_2º"      "Año 2015_3º"     </span></span>
<span id="cb1-207"><a href="#cb1-207"></a><span class="co">#&gt; [29] "Año 2015_4º"      "Año 2016_1º"      "Año 2016_2º"      "Año 2016_3º"     </span></span>
<span id="cb1-208"><a href="#cb1-208"></a><span class="co">#&gt; [33] "Año 2016_4º"      "Año 2017_1º"      "Año 2017_2º"      "Año 2017_3º"     </span></span>
<span id="cb1-209"><a href="#cb1-209"></a><span class="co">#&gt; [37] "Año 2017_4º"      "Año 2018_1º"      "Año 2018_2º"      "Año 2018_3º"     </span></span>
<span id="cb1-210"><a href="#cb1-210"></a><span class="co">#&gt; [41] "Año 2018_4º"      "Año 2019_1º"      "Año 2019_2º"      "Año 2019_3º"     </span></span>
<span id="cb1-211"><a href="#cb1-211"></a><span class="co">#&gt; [45] "Año 2019_4º"      "Año 2020_1º"      "Año 2020_2º"      "Año 2020_3º"     </span></span>
<span id="cb1-212"><a href="#cb1-212"></a><span class="co">#&gt; [49] "Año 2020_4º"      "Año 2021_1º"      "Año 2021_2º"      "Año 2021_3º"     </span></span>
<span id="cb1-213"><a href="#cb1-213"></a><span class="co">#&gt; [53] "Año 2021_4º"      "Año 2022_1º"      "Año 2022_2º"      "Año 2022_3º"     </span></span>
<span id="cb1-214"><a href="#cb1-214"></a><span class="co">#&gt; [57] "Año 2022_4º"      "Año 2023_1º"      "Año 2023_2º"      "Año 2023_3º (**)"</span></span>
<span id="cb1-215"><a href="#cb1-215"></a><span class="co">#&gt; [61] "Año 2004_1º"      "Año 2004_2º"      "Año 2004_3º"      "Año 2004_4º"     </span></span>
<span id="cb1-216"><a href="#cb1-216"></a><span class="co">#&gt; [65] "Año 2005_1º"      "Año 2005_2º"      "Año 2005_3º"      "Año 2005_4º"     </span></span>
<span id="cb1-217"><a href="#cb1-217"></a><span class="co">#&gt; [69] "Año 2006_1º"      "Año 2006_2º"      "Año 2006_3º"      "Año 2006_4º"     </span></span>
<span id="cb1-218"><a href="#cb1-218"></a><span class="co">#&gt; [73] "Año 2007_1º"      "Año 2007_2º"      "Año 2007_3º"      "Año 2007_4º"     </span></span>
<span id="cb1-219"><a href="#cb1-219"></a><span class="co">#&gt; [77] "Año 2008_1º"      "Año 2008_2º"      "Año 2008_3º"      "Año 2008_4º"</span></span>
<span id="cb1-220"><a href="#cb1-220"></a></span>
<span id="cb1-221"><a href="#cb1-221"></a><span class="co">#Hacemos que todas las columnas que indican año_trimestre pivoten y dejen los</span></span>
<span id="cb1-222"><a href="#cb1-222"></a><span class="co">#valores que contenían las transacciones por un lado y el año_trimestre por otro</span></span>
<span id="cb1-223"><a href="#cb1-223"></a></span>
<span id="cb1-224"><a href="#cb1-224"></a>Transacciones_por_provincia <span class="ot">&lt;-</span> cv <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"Año"</span>), </span>
<span id="cb1-225"><a href="#cb1-225"></a>                                                   <span class="at">names_to =</span> <span class="st">"Año_Trimestre"</span>, </span>
<span id="cb1-226"><a href="#cb1-226"></a>                                                   <span class="at">names_prefix =</span> <span class="st">"Año"</span>, </span>
<span id="cb1-227"><a href="#cb1-227"></a>                                                   <span class="at">values_to =</span> <span class="st">"Transacciones"</span>,</span>
<span id="cb1-228"><a href="#cb1-228"></a>                                                   <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-229"><a href="#cb1-229"></a></span>
<span id="cb1-230"><a href="#cb1-230"></a><span class="co">#Guardamos en la carpeta(en formato .csv) de datos pulidos y seguimos</span></span>
<span id="cb1-231"><a href="#cb1-231"></a></span>
<span id="cb1-232"><a href="#cb1-232"></a><span class="fu">write.csv</span>(Transacciones_por_provincia, </span>
<span id="cb1-233"><a href="#cb1-233"></a>          <span class="at">file =</span> <span class="st">"datos_pulidos/Transacciones_por_povincia.csv"</span>)</span>
<span id="cb1-234"><a href="#cb1-234"></a></span>
<span id="cb1-235"><a href="#cb1-235"></a><span class="co">#----------------Índice de precios de la vivienda-------------------------------</span></span>
<span id="cb1-236"><a href="#cb1-236"></a></span>
<span id="cb1-237"><a href="#cb1-237"></a></span>
<span id="cb1-238"><a href="#cb1-238"></a>ipv <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="at">file =</span> <span class="st">"./docs/datos/ipv.csv"</span>)</span>
<span id="cb1-239"><a href="#cb1-239"></a></span>
<span id="cb1-240"><a href="#cb1-240"></a><span class="co">#Estos datos están bien, quitamos las dos columnas que no aportan y los guardamos</span></span>
<span id="cb1-241"><a href="#cb1-241"></a>ipv <span class="ot">&lt;-</span> ipv[,<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)]</span>
<span id="cb1-242"><a href="#cb1-242"></a></span>
<span id="cb1-243"><a href="#cb1-243"></a><span class="fu">write.csv</span>(ipv, <span class="at">file =</span> <span class="st">"./datos_pulidos/indice_precio_vivienda.csv"</span>)</span>
<span id="cb1-244"><a href="#cb1-244"></a></span>
<span id="cb1-245"><a href="#cb1-245"></a><span class="co">#rm(list = ls())</span></span>
<span id="cb1-246"><a href="#cb1-246"></a></span>
<span id="cb1-247"><a href="#cb1-247"></a></span>
<span id="cb1-248"><a href="#cb1-248"></a><span class="co">#----------------Renta por edad-------------------------------------------------</span></span>
<span id="cb1-249"><a href="#cb1-249"></a></span>
<span id="cb1-250"><a href="#cb1-250"></a>re <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="at">file  =</span> <span class="st">"./docs/datos/renta_edad.csv"</span>)</span>
<span id="cb1-251"><a href="#cb1-251"></a></span>
<span id="cb1-252"><a href="#cb1-252"></a><span class="co">#Renombramos las columnas, seleccionamos lo que nos interesa y borramos el restante</span></span>
<span id="cb1-253"><a href="#cb1-253"></a><span class="co">#Exportamos</span></span>
<span id="cb1-254"><a href="#cb1-254"></a>re <span class="ot">&lt;-</span> re <span class="sc">%&gt;%</span></span>
<span id="cb1-255"><a href="#cb1-255"></a>  <span class="fu">rename</span>(<span class="at">renta =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-256"><a href="#cb1-256"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(<span class="st">"V1"</span>, <span class="st">"X"</span>))</span>
<span id="cb1-257"><a href="#cb1-257"></a></span>
<span id="cb1-258"><a href="#cb1-258"></a><span class="fu">write.csv</span>(re, <span class="at">file =</span> <span class="st">"./datos_pulidos/renta_por_edad.csv"</span>)</span>
<span id="cb1-259"><a href="#cb1-259"></a></span>
<span id="cb1-260"><a href="#cb1-260"></a></span>
<span id="cb1-261"><a href="#cb1-261"></a></span>
<span id="cb1-262"><a href="#cb1-262"></a></span>
<span id="cb1-263"><a href="#cb1-263"></a><span class="co">#----------------Régimen tenencia de vivienda por edad--------------------------</span></span>
<span id="cb1-264"><a href="#cb1-264"></a></span>
<span id="cb1-265"><a href="#cb1-265"></a>vd <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="at">file  =</span> <span class="st">"./docs/datos/vivienda_datos.csv"</span>)</span>
<span id="cb1-266"><a href="#cb1-266"></a></span>
<span id="cb1-267"><a href="#cb1-267"></a><span class="co">#Renombramos las columnas, seleccionamos lo que nos interesa y borramos el restante</span></span>
<span id="cb1-268"><a href="#cb1-268"></a><span class="co">#Exportamos</span></span>
<span id="cb1-269"><a href="#cb1-269"></a>vd<span class="ot">&lt;-</span> vd <span class="sc">%&gt;%</span></span>
<span id="cb1-270"><a href="#cb1-270"></a>  <span class="fu">rename</span>(<span class="at">Porcentaje =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-271"><a href="#cb1-271"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(<span class="st">"V1"</span>, <span class="st">"X"</span>))</span>
<span id="cb1-272"><a href="#cb1-272"></a></span>
<span id="cb1-273"><a href="#cb1-273"></a><span class="fu">write.csv</span>(vd, <span class="at">file =</span> <span class="st">"./datos_pulidos/tenencia_de_vivienda.csv"</span>)</span>
<span id="cb1-274"><a href="#cb1-274"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-275"><a href="#cb1-275"></a></span>
<span id="cb1-276"><a href="#cb1-276"></a><span class="co">#--------------------IMPORTAR DATOS CE / EUROSTAT-------------------------------</span></span>
<span id="cb1-277"><a href="#cb1-277"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>) <span class="co">#- para quitar la notación científica</span></span>
<span id="cb1-278"><a href="#cb1-278"></a></span>
<span id="cb1-279"><a href="#cb1-279"></a><span class="fu">library</span>(eurostat) </span>
<span id="cb1-280"><a href="#cb1-280"></a><span class="fu">library</span>(DT) </span>
<span id="cb1-281"><a href="#cb1-281"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-282"><a href="#cb1-282"></a></span>
<span id="cb1-283"><a href="#cb1-283"></a>info <span class="ot">&lt;-</span> <span class="fu">search_eurostat</span>(<span class="st">"GDP"</span>, <span class="at">type =</span> <span class="st">"all"</span>)</span>
<span id="cb1-284"><a href="#cb1-284"></a>my_table <span class="ot">&lt;-</span><span class="st">"sdg_08_10"</span></span>
<span id="cb1-285"><a href="#cb1-285"></a></span>
<span id="cb1-286"><a href="#cb1-286"></a><span class="co">#Comprobamos que es el PIB pc</span></span>
<span id="cb1-287"><a href="#cb1-287"></a><span class="fu">label_eurostat_tables</span>(my_table)</span>
<span id="cb1-288"><a href="#cb1-288"></a><span class="co">#&gt; [1] "Real GDP per capita"</span></span>
<span id="cb1-289"><a href="#cb1-289"></a></span>
<span id="cb1-290"><a href="#cb1-290"></a>df_original <span class="ot">&lt;-</span> <span class="fu">get_eurostat</span>(my_table, <span class="at">time_format =</span> <span class="st">'raw'</span>, <span class="at">keepFlags =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-291"><a href="#cb1-291"></a>df_names <span class="ot">&lt;-</span> <span class="fu">names</span>(df_original)</span>
<span id="cb1-292"><a href="#cb1-292"></a>df_original <span class="ot">&lt;-</span> <span class="fu">label_eurostat</span>(df_original, <span class="at">code =</span> df_names, <span class="at">fix_duplicated =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-293"><a href="#cb1-293"></a></span>
<span id="cb1-294"><a href="#cb1-294"></a><span class="co">#Creamos otro df para trabajor con él </span></span>
<span id="cb1-295"><a href="#cb1-295"></a></span>
<span id="cb1-296"><a href="#cb1-296"></a>df <span class="ot">&lt;-</span> df_original</span>
<span id="cb1-297"><a href="#cb1-297"></a></span>
<span id="cb1-298"><a href="#cb1-298"></a><span class="co">#Ver que hay en el df</span></span>
<span id="cb1-299"><a href="#cb1-299"></a>df_aa <span class="ot">&lt;-</span> pjpv.curso.R<span class="fl">.2022</span><span class="sc">::</span><span class="fu">pjp_dicc</span>(df)</span>
<span id="cb1-300"><a href="#cb1-300"></a>df_bb <span class="ot">&lt;-</span> pjpv.curso.R<span class="fl">.2022</span><span class="sc">::</span><span class="fu">pjp_valores_unicos</span>(df, <span class="at">nn =</span> <span class="dv">400</span>)</span>
<span id="cb1-301"><a href="#cb1-301"></a></span>
<span id="cb1-302"><a href="#cb1-302"></a><span class="co">#Vamos a hacer un poco de limpieza</span></span>
<span id="cb1-303"><a href="#cb1-303"></a>obj_buenos <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"df"</span>, <span class="st">"df_original"</span>, <span class="st">"df_bb"</span>)</span>
<span id="cb1-304"><a href="#cb1-304"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">setdiff</span>(<span class="fu">ls</span>(), obj_buenos))</span>
<span id="cb1-305"><a href="#cb1-305"></a></span>
<span id="cb1-306"><a href="#cb1-306"></a><span class="co">#Vamos a seguir arreglando el df</span></span>
<span id="cb1-307"><a href="#cb1-307"></a></span>
<span id="cb1-308"><a href="#cb1-308"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb1-309"><a href="#cb1-309"></a>  <span class="fu">rename</span>(<span class="at">year =</span> time_code) <span class="sc">|&gt;</span> </span>
<span id="cb1-310"><a href="#cb1-310"></a>  <span class="fu">rename</span>(<span class="at">PIB_pc =</span> values) <span class="sc">|&gt;</span> </span>
<span id="cb1-311"><a href="#cb1-311"></a>  <span class="fu">rename</span>(<span class="at">country =</span> geo)</span>
<span id="cb1-312"><a href="#cb1-312"></a></span>
<span id="cb1-313"><a href="#cb1-313"></a><span class="co">#Chain linked volumes (2010), euro per capita</span></span>
<span id="cb1-314"><a href="#cb1-314"></a><span class="co">#Solo queremos el PIB_pc</span></span>
<span id="cb1-315"><a href="#cb1-315"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb1-316"><a href="#cb1-316"></a>  <span class="fu">filter</span>(unit <span class="sc">==</span> <span class="st">"Chain linked volumes (2010), euro per capita"</span>)</span>
<span id="cb1-317"><a href="#cb1-317"></a></span>
<span id="cb1-318"><a href="#cb1-318"></a><span class="co">#Eliminamos todo lo que nos molesta a la vista </span></span>
<span id="cb1-319"><a href="#cb1-319"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb1-320"><a href="#cb1-320"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(unit_code, values_code, unit, time, na_item_code, na_item, flags))</span>
<span id="cb1-321"><a href="#cb1-321"></a></span>
<span id="cb1-322"><a href="#cb1-322"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span>  <span class="fu">mutate</span>(<span class="at">year =</span>  <span class="fu">as.numeric</span>(year))</span>
<span id="cb1-323"><a href="#cb1-323"></a></span>
<span id="cb1-324"><a href="#cb1-324"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span>  <span class="fu">mutate</span>(<span class="at">iso_2_code =</span>  eurostat<span class="sc">::</span><span class="fu">harmonize_country_code</span>(geo_code))</span>
<span id="cb1-325"><a href="#cb1-325"></a></span>
<span id="cb1-326"><a href="#cb1-326"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb1-327"><a href="#cb1-327"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(geo_code, flags_code))</span>
<span id="cb1-328"><a href="#cb1-328"></a></span>
<span id="cb1-329"><a href="#cb1-329"></a></span>
<span id="cb1-330"><a href="#cb1-330"></a><span class="fu">library</span>(fs)</span>
<span id="cb1-331"><a href="#cb1-331"></a><span class="fu">dir_create</span>(<span class="st">"datos_pulidos"</span>)</span>
<span id="cb1-332"><a href="#cb1-332"></a></span>
<span id="cb1-333"><a href="#cb1-333"></a><span class="co">#A continuación vamos a exportar los datos para luego importarlas más fácilmente #library(rio)</span></span>
<span id="cb1-334"><a href="#cb1-334"></a></span>
<span id="cb1-335"><a href="#cb1-335"></a><span class="fu">export</span>(df, <span class="st">"./datos_pulidos/PIB_pc.csv"</span>, <span class="at">type =</span> <span class="st">"csv"</span>)</span>
<span id="cb1-336"><a href="#cb1-336"></a><span class="co">#---------------DATOS SOBRE EL SALARIO POR NIVEL DE FORMACIÓN-------------------</span></span>
<span id="cb1-337"><a href="#cb1-337"></a></span>
<span id="cb1-338"><a href="#cb1-338"></a><span class="fu">library</span>(rio)</span>
<span id="cb1-339"><a href="#cb1-339"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-340"><a href="#cb1-340"></a>url <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/13931.csv?nocab=1"</span></span>
<span id="cb1-341"><a href="#cb1-341"></a>df_ine <span class="ot">&lt;-</span> <span class="fu">import</span>(url)</span>
<span id="cb1-342"><a href="#cb1-342"></a>df_ine_01 <span class="ot">&lt;-</span> df_ine <span class="sc">|&gt;</span> </span>
<span id="cb1-343"><a href="#cb1-343"></a>  <span class="fu">filter</span>(Decil <span class="sc">%in%</span> (<span class="st">"Total decil"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb1-344"><a href="#cb1-344"></a>  <span class="fu">select</span>(<span class="st">"Periodo"</span>, <span class="st">"Tipo de jornada"</span>, <span class="st">"NIVELES DE FORMACION"</span>, <span class="st">"Total"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-345"><a href="#cb1-345"></a>  <span class="fu">rename</span>(<span class="at">year =</span> Periodo) <span class="sc">|&gt;</span> </span>
<span id="cb1-346"><a href="#cb1-346"></a>  <span class="fu">rename</span>(<span class="at">jornada =</span> <span class="st">'Tipo de jornada'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-347"><a href="#cb1-347"></a>  <span class="fu">rename</span>(<span class="at">formacion =</span> <span class="st">'NIVELES DE FORMACION'</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-348"><a href="#cb1-348"></a>  <span class="fu">rename</span>(<span class="at">salario =</span> Total)</span>
<span id="cb1-349"><a href="#cb1-349"></a></span>
<span id="cb1-350"><a href="#cb1-350"></a><span class="co">#VAMOS A CONVERTIR LA VARIABLE salario A NUMERIC</span></span>
<span id="cb1-351"><a href="#cb1-351"></a></span>
<span id="cb1-352"><a href="#cb1-352"></a><span class="co">#R y el INE me han jodiedo la vida para pasar esto a numeric (antes no funcionaba)</span></span>
<span id="cb1-353"><a href="#cb1-353"></a>df_ine_01 <span class="ot">&lt;-</span> df_ine_01 <span class="sc">|&gt;</span> </span>
<span id="cb1-354"><a href="#cb1-354"></a>  <span class="fu">mutate</span>(<span class="at">salario =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">""</span>, salario))))</span>
<span id="cb1-355"><a href="#cb1-355"></a></span>
<span id="cb1-356"><a href="#cb1-356"></a><span class="fu">export</span>(df_ine_01,<span class="st">"./datos_pulidos/salario_formacion.csv"</span>, <span class="at">type =</span> <span class="st">"csv"</span>)</span>
<span id="cb1-357"><a href="#cb1-357"></a></span>
<span id="cb1-358"><a href="#cb1-358"></a></span>
<span id="cb1-359"><a href="#cb1-359"></a><span class="co">#-----------------------DATOS SOBRE EL SALARIO POR EDADES-----------------------</span></span>
<span id="cb1-360"><a href="#cb1-360"></a></span>
<span id="cb1-361"><a href="#cb1-361"></a>url_1 <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/13928.csv?nocab=1"</span></span>
<span id="cb1-362"><a href="#cb1-362"></a>df_ine_x1 <span class="ot">&lt;-</span> <span class="fu">import</span>(url_1)</span>
<span id="cb1-363"><a href="#cb1-363"></a></span>
<span id="cb1-364"><a href="#cb1-364"></a>df_ine_02 <span class="ot">&lt;-</span> df_ine_x1 <span class="sc">|&gt;</span> </span>
<span id="cb1-365"><a href="#cb1-365"></a>  <span class="fu">filter</span>(Decil <span class="sc">%in%</span> (<span class="st">"Total decil"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-366"><a href="#cb1-366"></a>  <span class="fu">select</span>(<span class="st">"Periodo"</span>, <span class="st">"Tipo de jornada"</span>, <span class="st">"Grupo de edad"</span>, <span class="st">"Total"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-367"><a href="#cb1-367"></a>  <span class="fu">rename</span>(<span class="at">year =</span> Periodo) <span class="sc">|&gt;</span> </span>
<span id="cb1-368"><a href="#cb1-368"></a>  <span class="fu">rename</span>(<span class="at">jornada =</span> <span class="st">'Tipo de jornada'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-369"><a href="#cb1-369"></a>  <span class="fu">rename</span>(<span class="at">grupo_edad =</span> <span class="st">'Grupo de edad'</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-370"><a href="#cb1-370"></a>  <span class="fu">rename</span>(<span class="at">salario =</span> Total)</span>
<span id="cb1-371"><a href="#cb1-371"></a></span>
<span id="cb1-372"><a href="#cb1-372"></a><span class="co">#PASAMOS A NUMERIC</span></span>
<span id="cb1-373"><a href="#cb1-373"></a>df_ine_02 <span class="ot">&lt;-</span> df_ine_02 <span class="sc">|&gt;</span> </span>
<span id="cb1-374"><a href="#cb1-374"></a>  <span class="fu">mutate</span>(<span class="at">salario =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">""</span>, salario))))</span>
<span id="cb1-375"><a href="#cb1-375"></a></span>
<span id="cb1-376"><a href="#cb1-376"></a><span class="fu">export</span>(df_ine_02,<span class="st">"./datos_pulidos/salario_grupo_edad.csv"</span>, <span class="at">type =</span> <span class="st">"csv"</span>)</span>
<span id="cb1-377"><a href="#cb1-377"></a><span class="co">#------------------------------DATOS SOBRE EL IPC-------------------------------</span></span>
<span id="cb1-378"><a href="#cb1-378"></a></span>
<span id="cb1-379"><a href="#cb1-379"></a>url_2 <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/50908.csv?nocab=1"</span></span>
<span id="cb1-380"><a href="#cb1-380"></a>df_ipc <span class="ot">&lt;-</span> <span class="fu">import</span>(url_2)</span>
<span id="cb1-381"><a href="#cb1-381"></a></span>
<span id="cb1-382"><a href="#cb1-382"></a>df_ipc_01 <span class="ot">&lt;-</span> df_ipc <span class="sc">|&gt;</span> </span>
<span id="cb1-383"><a href="#cb1-383"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Grupos ECOICOP</span><span class="st">`</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Índice general"</span>, <span class="st">"04 Vivienda, agua, electricidad, gas y otros combustibles"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb1-384"><a href="#cb1-384"></a>  <span class="fu">select</span>(<span class="st">"Periodo"</span>, <span class="st">"Grupos ECOICOP"</span>, <span class="st">"Tipo de dato"</span>, <span class="st">"Total"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-385"><a href="#cb1-385"></a>  <span class="fu">rename</span>(<span class="at">year =</span> Periodo) <span class="sc">|&gt;</span></span>
<span id="cb1-386"><a href="#cb1-386"></a>  <span class="fu">rename</span>(<span class="at">grupo =</span> <span class="st">'Grupos ECOICOP'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-387"><a href="#cb1-387"></a>  <span class="fu">rename</span>(<span class="at">tipo_dato =</span> <span class="st">`</span><span class="at">Tipo de dato</span><span class="st">`</span> ) </span>
<span id="cb1-388"><a href="#cb1-388"></a></span>
<span id="cb1-389"><a href="#cb1-389"></a><span class="co">#PASAMOS A NUMERIC</span></span>
<span id="cb1-390"><a href="#cb1-390"></a>df_ipc_01 <span class="ot">&lt;-</span> df_ipc_01 <span class="sc">|&gt;</span> </span>
<span id="cb1-391"><a href="#cb1-391"></a>  <span class="fu">mutate</span>(<span class="at">Total =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">""</span>, Total))))</span>
<span id="cb1-392"><a href="#cb1-392"></a></span>
<span id="cb1-393"><a href="#cb1-393"></a><span class="co">#PARA SEPARAR EN LA VARIABLE YEAR LOS DATOS POR AÑOS Y MESES</span></span>
<span id="cb1-394"><a href="#cb1-394"></a><span class="co">#df_sep &lt;- df_ipc_01 |&gt; </span></span>
<span id="cb1-395"><a href="#cb1-395"></a><span class="co">#  separate(col = year, into = c("year", "month"), sep = "M")</span></span>
<span id="cb1-396"><a href="#cb1-396"></a></span>
<span id="cb1-397"><a href="#cb1-397"></a><span class="co">#df_sep &lt;- df_sep |&gt; </span></span>
<span id="cb1-398"><a href="#cb1-398"></a><span class="co">#  mutate(month = paste0("M", month))</span></span>
<span id="cb1-399"><a href="#cb1-399"></a></span>
<span id="cb1-400"><a href="#cb1-400"></a><span class="fu">export</span>(df_ipc_01, <span class="st">"./datos_pulidos/IPC_mas_vivienda.csv"</span>, <span class="at">type =</span> <span class="st">"csv"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<hr></section><section id="evolución-de-la-renta-neta-por-edad" class="level1"><h1>Evolución de la renta neta por edad</h1>
<p>Iniciaremos analizando los datos de renta según la edad (como pueden imaginar, los jóvenes constituyen el grupo poblacional que dispone de menos renta), para, a continuación, adentrarnos en datos que muestran la evolución de los precios de la vivienda.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Gráfico en movimiento</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Gráfico fijo interactivo</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell" data-layout-align="center">
<details open=""><summary>Código</summary><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">#Cargamos datos</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">library</span>(rio)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="fu">library</span>(hrbrthemes)</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#-</span></span>
<span id="cb2-9"><a href="#cb2-9"></a></span>
<span id="cb2-10"><a href="#cb2-10"></a>renta_edad <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos_pulidos/renta_por_edad.csv"</span>)</span>
<span id="cb2-11"><a href="#cb2-11"></a></span>
<span id="cb2-12"><a href="#cb2-12"></a>dff  <span class="ot">&lt;-</span> renta_edad <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">tipo =</span> Renta.anual.neta.media.por.persona.y.por.unidad.de.consumo) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(tipo <span class="sc">==</span> <span class="st">"Renta neta media por persona"</span>, Sexo <span class="sc">==</span> <span class="st">"Ambos sexos"</span>, <span class="sc">!</span>(Edad <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"De 18 a 64 años"</span>, <span class="st">"Menos de 18 años"</span>, <span class="st">"Total"</span>)))</span>
<span id="cb2-13"><a href="#cb2-13"></a></span>
<span id="cb2-14"><a href="#cb2-14"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dff, <span class="fu">aes</span>(<span class="at">x =</span> Periodo, <span class="at">y =</span> renta, <span class="at">color =</span> Edad)) <span class="sc">+</span></span>
<span id="cb2-15"><a href="#cb2-15"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-16"><a href="#cb2-16"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Evolución de la renta neta media por edad"</span>, <span class="at">subtitle =</span> <span class="st">"(Euros corrientes)"</span>,</span>
<span id="cb2-17"><a href="#cb2-17"></a>       <span class="at">x =</span> <span class="st">"Año"</span>, <span class="at">y =</span> <span class="st">"Renta neta"</span>) <span class="sc">+</span></span>
<span id="cb2-18"><a href="#cb2-18"></a>  <span class="fu">theme_ipsum</span>() <span class="sc">+</span> </span>
<span id="cb2-19"><a href="#cb2-19"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb2-20"><a href="#cb2-20"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"gray87"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>),</span>
<span id="cb2-21"><a href="#cb2-21"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"aliceblue"</span>),</span>
<span id="cb2-22"><a href="#cb2-22"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-23"><a href="#cb2-23"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"serif"</span>, <span class="at">size =</span> <span class="dv">9</span>, <span class="at">colour =</span> <span class="st">"gray17"</span>)) <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"green4"</span>, <span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb2-24"><a href="#cb2-24"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Edad), <span class="at">nudge_x =</span> <span class="fl">0.5</span>, <span class="at">nudge_y =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb2-25"><a href="#cb2-25"></a></span>
<span id="cb2-26"><a href="#cb2-26"></a>p_animated <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">transition_reveal</span>(Periodo) <span class="sc">+</span></span>
<span id="cb2-27"><a href="#cb2-27"></a>  <span class="fu">enter_fade</span>() <span class="sc">+</span> </span>
<span id="cb2-28"><a href="#cb2-28"></a>  <span class="fu">exit_fade</span>()</span>
<span id="cb2-29"><a href="#cb2-29"></a></span>
<span id="cb2-30"><a href="#cb2-30"></a><span class="fu">animate</span>(p_animated, <span class="at">nframes =</span> <span class="dv">200</span>, <span class="at">fps =</span> <span class="dv">20</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="my_trabajo_BigData_files/figure-html/unnamed-chunk-2-1.gif" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell" data-layout-align="center">
<details open=""><summary>Código</summary><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="fu">library</span>(hrbrthemes)</span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a>renta_edad <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos_pulidos/renta_por_edad.csv"</span>)</span>
<span id="cb3-8"><a href="#cb3-8"></a></span>
<span id="cb3-9"><a href="#cb3-9"></a>dff  <span class="ot">&lt;-</span> renta_edad <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">tipo =</span> Renta.anual.neta.media.por.persona.y.por.unidad.de.consumo) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(tipo <span class="sc">==</span> <span class="st">"Renta neta media por persona"</span>, Sexo <span class="sc">==</span> <span class="st">"Ambos sexos"</span>, <span class="sc">!</span>(Edad <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"De 18 a 64 años"</span>, <span class="st">"Menos de 18 años"</span>, <span class="st">"Total"</span>)))</span>
<span id="cb3-10"><a href="#cb3-10"></a></span>
<span id="cb3-11"><a href="#cb3-11"></a>p6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dff) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Periodo, <span class="at">y =</span> renta, <span class="at">color =</span> Edad, <span class="at">group =</span> Edad)) <span class="sc">+</span><span class="fu">labs</span> (<span class="at">title =</span> <span class="st">"Evolución de la renta neta media por edad"</span>, <span class="at">subtitle =</span> <span class="st">"(En euros corrientes)"</span>, <span class="at">y =</span> <span class="st">"Renta"</span>, <span class="at">x =</span> <span class="st">"Año"</span>) <span class="sc">+</span> <span class="fu">theme_ipsum</span>()</span>
<span id="cb3-13"><a href="#cb3-13"></a></span>
<span id="cb3-14"><a href="#cb3-14"></a>plotly<span class="sc">::</span><span class="fu">ggplotly</span>(p6)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-7af0c980208732529df7" style="width:95%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-7af0c980208732529df7">{"x":{"data":[{"x":[2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022],"y":[10893,11685,11783,11463,11867,11960,12183,12206,12416,12528,12758,13315,14132,14426,14762],"text":["Periodo: 2008<br />renta: 10893<br />Edad: 65 y más años<br />Edad: 65 y más años","Periodo: 2009<br />renta: 11685<br />Edad: 65 y más años<br />Edad: 65 y más años","Periodo: 2010<br />renta: 11783<br />Edad: 65 y más años<br />Edad: 65 y más años","Periodo: 2011<br />renta: 11463<br />Edad: 65 y más años<br />Edad: 65 y más años","Periodo: 2012<br />renta: 11867<br />Edad: 65 y más años<br />Edad: 65 y más años","Periodo: 2013<br />renta: 11960<br />Edad: 65 y más años<br />Edad: 65 y más años","Periodo: 2014<br />renta: 12183<br />Edad: 65 y más años<br />Edad: 65 y más años","Periodo: 2015<br />renta: 12206<br />Edad: 65 y más años<br />Edad: 65 y más años","Periodo: 2016<br />renta: 12416<br />Edad: 65 y más años<br />Edad: 65 y más años","Periodo: 2017<br />renta: 12528<br />Edad: 65 y más años<br />Edad: 65 y más años","Periodo: 2018<br />renta: 12758<br />Edad: 65 y más años<br />Edad: 65 y más años","Periodo: 2019<br />renta: 13315<br />Edad: 65 y más años<br />Edad: 65 y más años","Periodo: 2020<br />renta: 14132<br />Edad: 65 y más años<br />Edad: 65 y más años","Periodo: 2021<br />renta: 14426<br />Edad: 65 y más años<br />Edad: 65 y más años","Periodo: 2022<br />renta: 14762<br />Edad: 65 y más años<br />Edad: 65 y más años"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"65 y más años","legendgroup":"65 y más años","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022],"y":[10321,10797,10651,10032,9727,9438,9004,8935,9373,9815,10156,10345,11031,10903,11660],"text":["Periodo: 2008<br />renta: 10321<br />Edad: De 16 a 29 años<br />Edad: De 16 a 29 años","Periodo: 2009<br />renta: 10797<br />Edad: De 16 a 29 años<br />Edad: De 16 a 29 años","Periodo: 2010<br />renta: 10651<br />Edad: De 16 a 29 años<br />Edad: De 16 a 29 años","Periodo: 2011<br />renta: 10032<br />Edad: De 16 a 29 años<br />Edad: De 16 a 29 años","Periodo: 2012<br />renta:  9727<br />Edad: De 16 a 29 años<br />Edad: De 16 a 29 años","Periodo: 2013<br />renta:  9438<br />Edad: De 16 a 29 años<br />Edad: De 16 a 29 años","Periodo: 2014<br />renta:  9004<br />Edad: De 16 a 29 años<br />Edad: De 16 a 29 años","Periodo: 2015<br />renta:  8935<br />Edad: De 16 a 29 años<br />Edad: De 16 a 29 años","Periodo: 2016<br />renta:  9373<br />Edad: De 16 a 29 años<br />Edad: De 16 a 29 años","Periodo: 2017<br />renta:  9815<br />Edad: De 16 a 29 años<br />Edad: De 16 a 29 años","Periodo: 2018<br />renta: 10156<br />Edad: De 16 a 29 años<br />Edad: De 16 a 29 años","Periodo: 2019<br />renta: 10345<br />Edad: De 16 a 29 años<br />Edad: De 16 a 29 años","Periodo: 2020<br />renta: 11031<br />Edad: De 16 a 29 años<br />Edad: De 16 a 29 años","Periodo: 2021<br />renta: 10903<br />Edad: De 16 a 29 años<br />Edad: De 16 a 29 años","Periodo: 2022<br />renta: 11660<br />Edad: De 16 a 29 años<br />Edad: De 16 a 29 años"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(163,165,0,1)","dash":"solid"},"hoveron":"points","name":"De 16 a 29 años","legendgroup":"De 16 a 29 años","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022],"y":[11024,11687,11480,11106,10912,10543,10348,10353,10536,11040,11397,11422,12053,12012,12974],"text":["Periodo: 2008<br />renta: 11024<br />Edad: De 30 a 44 años<br />Edad: De 30 a 44 años","Periodo: 2009<br />renta: 11687<br />Edad: De 30 a 44 años<br />Edad: De 30 a 44 años","Periodo: 2010<br />renta: 11480<br />Edad: De 30 a 44 años<br />Edad: De 30 a 44 años","Periodo: 2011<br />renta: 11106<br />Edad: De 30 a 44 años<br />Edad: De 30 a 44 años","Periodo: 2012<br />renta: 10912<br />Edad: De 30 a 44 años<br />Edad: De 30 a 44 años","Periodo: 2013<br />renta: 10543<br />Edad: De 30 a 44 años<br />Edad: De 30 a 44 años","Periodo: 2014<br />renta: 10348<br />Edad: De 30 a 44 años<br />Edad: De 30 a 44 años","Periodo: 2015<br />renta: 10353<br />Edad: De 30 a 44 años<br />Edad: De 30 a 44 años","Periodo: 2016<br />renta: 10536<br />Edad: De 30 a 44 años<br />Edad: De 30 a 44 años","Periodo: 2017<br />renta: 11040<br />Edad: De 30 a 44 años<br />Edad: De 30 a 44 años","Periodo: 2018<br />renta: 11397<br />Edad: De 30 a 44 años<br />Edad: De 30 a 44 años","Periodo: 2019<br />renta: 11422<br />Edad: De 30 a 44 años<br />Edad: De 30 a 44 años","Periodo: 2020<br />renta: 12053<br />Edad: De 30 a 44 años<br />Edad: De 30 a 44 años","Periodo: 2021<br />renta: 12012<br />Edad: De 30 a 44 años<br />Edad: De 30 a 44 años","Periodo: 2022<br />renta: 12974<br />Edad: De 30 a 44 años<br />Edad: De 30 a 44 años"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,125,1)","dash":"solid"},"hoveron":"points","name":"De 30 a 44 años","legendgroup":"De 30 a 44 años","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022],"y":[12413,12906,13047,12374,12270,11921,11626,11591,11931,12311,12550,12988,13626,13373,14225],"text":["Periodo: 2008<br />renta: 12413<br />Edad: De 45 a 64 años<br />Edad: De 45 a 64 años","Periodo: 2009<br />renta: 12906<br />Edad: De 45 a 64 años<br />Edad: De 45 a 64 años","Periodo: 2010<br />renta: 13047<br />Edad: De 45 a 64 años<br />Edad: De 45 a 64 años","Periodo: 2011<br />renta: 12374<br />Edad: De 45 a 64 años<br />Edad: De 45 a 64 años","Periodo: 2012<br />renta: 12270<br />Edad: De 45 a 64 años<br />Edad: De 45 a 64 años","Periodo: 2013<br />renta: 11921<br />Edad: De 45 a 64 años<br />Edad: De 45 a 64 años","Periodo: 2014<br />renta: 11626<br />Edad: De 45 a 64 años<br />Edad: De 45 a 64 años","Periodo: 2015<br />renta: 11591<br />Edad: De 45 a 64 años<br />Edad: De 45 a 64 años","Periodo: 2016<br />renta: 11931<br />Edad: De 45 a 64 años<br />Edad: De 45 a 64 años","Periodo: 2017<br />renta: 12311<br />Edad: De 45 a 64 años<br />Edad: De 45 a 64 años","Periodo: 2018<br />renta: 12550<br />Edad: De 45 a 64 años<br />Edad: De 45 a 64 años","Periodo: 2019<br />renta: 12988<br />Edad: De 45 a 64 años<br />Edad: De 45 a 64 años","Periodo: 2020<br />renta: 13626<br />Edad: De 45 a 64 años<br />Edad: De 45 a 64 años","Periodo: 2021<br />renta: 13373<br />Edad: De 45 a 64 años<br />Edad: De 45 a 64 años","Periodo: 2022<br />renta: 14225<br />Edad: De 45 a 64 años<br />Edad: De 45 a 64 años"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,176,246,1)","dash":"solid"},"hoveron":"points","name":"De 45 a 64 años","legendgroup":"De 45 a 64 años","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022],"y":[8005,8444,8355,8259,8151,7741,7726,7841,8078,8354,8919,8899,9025,9036,9605],"text":["Periodo: 2008<br />renta:  8005<br />Edad: Menores de 16 años<br />Edad: Menores de 16 años","Periodo: 2009<br />renta:  8444<br />Edad: Menores de 16 años<br />Edad: Menores de 16 años","Periodo: 2010<br />renta:  8355<br />Edad: Menores de 16 años<br />Edad: Menores de 16 años","Periodo: 2011<br />renta:  8259<br />Edad: Menores de 16 años<br />Edad: Menores de 16 años","Periodo: 2012<br />renta:  8151<br />Edad: Menores de 16 años<br />Edad: Menores de 16 años","Periodo: 2013<br />renta:  7741<br />Edad: Menores de 16 años<br />Edad: Menores de 16 años","Periodo: 2014<br />renta:  7726<br />Edad: Menores de 16 años<br />Edad: Menores de 16 años","Periodo: 2015<br />renta:  7841<br />Edad: Menores de 16 años<br />Edad: Menores de 16 años","Periodo: 2016<br />renta:  8078<br />Edad: Menores de 16 años<br />Edad: Menores de 16 años","Periodo: 2017<br />renta:  8354<br />Edad: Menores de 16 años<br />Edad: Menores de 16 años","Periodo: 2018<br />renta:  8919<br />Edad: Menores de 16 años<br />Edad: Menores de 16 años","Periodo: 2019<br />renta:  8899<br />Edad: Menores de 16 años<br />Edad: Menores de 16 años","Periodo: 2020<br />renta:  9025<br />Edad: Menores de 16 años<br />Edad: Menores de 16 años","Periodo: 2021<br />renta:  9036<br />Edad: Menores de 16 años<br />Edad: Menores de 16 años","Periodo: 2022<br />renta:  9605<br />Edad: Menores de 16 años<br />Edad: Menores de 16 años"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(231,107,243,1)","dash":"solid"},"hoveron":"points","name":"Menores de 16 años","legendgroup":"Menores de 16 años","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":95.701120797011214,"r":39.850560398505614,"b":86.841012868410132,"l":93.814860938148641},"font":{"color":"rgba(0,0,0,1)","family":"Arial Narrow","size":15.276048152760483},"title":{"text":"<b> Evolución de la renta neta media por edad <\/b>","font":{"color":"rgba(0,0,0,1)","family":"Arial Narrow","size":23.910336239103366},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[2007.3,2022.7],"tickmode":"array","ticktext":["2008","2012","2016","2020"],"tickvals":[2008,2012,2016,2020],"categoryorder":"array","categoryarray":["2008","2012","2016","2020"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.8190120381901207,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"Arial Narrow","size":15.276048152760483},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.265670402656704,"zeroline":false,"anchor":"y","title":{"text":"Año","font":{"color":"rgba(0,0,0,1)","family":"Arial Narrow","size":11.955168119551683}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[7374.1999999999998,15113.799999999999],"tickmode":"array","ticktext":["9000","11000","13000","15000"],"tickvals":[9000,11000,13000,15000],"categoryorder":"array","categoryarray":["9000","11000","13000","15000"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.8190120381901207,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"Arial Narrow","size":15.276048152760483},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.26567040265670405,"zeroline":false,"anchor":"x","title":{"text":"Renta","font":{"color":"rgba(0,0,0,1)","family":"Arial Narrow","size":11.955168119551683}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"Arial Narrow","size":12.220838522208389},"title":{"text":"Edad","font":{"color":"rgba(0,0,0,1)","family":"Arial Narrow","size":15.276048152760483}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"54d042c219c":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"54d042c219c","visdat":{"54d042c219c":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>Tenemos este primer gráfico dinámico, que básicamente lo hemos hecho para demostrar que lo podemos hacer. Sabemos que no es especialmente útil, pero sí vistoso, por eso hemos hecho esta presión interactiva pero estática del mismo gráfico</p>
<p>En este gráfico, cuyos datos están extraídos del INE podemos observar, como ya anticipábamos, que los jóvenes (16-29 años de edad) son el rango de edad que dispone de menos renta. Más notorio es, claro está, con los menores de 16 años. Los jóvenes de 16 a 29 años contaban con una renta media neta o disponible (después de impuestos) de 11.660€.</p>
<ul>
<li><p>La diferencia con el grupo de 30 a 44 años ha pasado de un 6’38% en 2008 a 10’13% en 2022. Un incremento de un 58’78%.</p></li>
<li><p>Con el grupo de 45 a 64 años del 16’86% mencionado arriba a un 18’03%. Un incremento de un 6’94%.</p></li>
<li><p>La mayor divergencia se da con el grupo de los mayores de 65 años. De una diferencia del 6’03% en 2008 a una del 21% en 2022. Un espectacular incremento del 248’23%.</p></li>
</ul>
<p>Por tanto, la renta de lo jóvenes de entre 16 y 29 años es la que menos ha crecido: tan solo un 12’97% en 14 años.</p>
<p>Como podemos observar, no sólo es que los jóvenes tengan una renta disponible menor, si no que cada vez se queda más atrás respecto al resto. Los jóvenes, en términos de renta, son cada vez relativamente más tarde.</p>
<hr></section><section id="índice-del-nivel-de-precios-de-la-vivienda-a-nivel-nacional" class="level1"><h1>Índice del nivel de Precios de la vivienda a nivel nacional</h1>
<p>Ahora vamos a analizar cómo se han comportado los precios de la vivienda en general. Primero lo vamos a hacer observando el comportamiento de los precios de forma general a nivel nacional. Luego veremos cómo se ha comportado en términos de tasas de variación, y más tarde, el nivel de precios por comunidades autónomas y en diferentes momentos del tiempo.</p>
<div class="cell" data-layout-align="center">
<details open=""><summary>Código</summary><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="fu">library</span>(ggExtra)</span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="fu">library</span>(pxR)</span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a>url <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/px/25171.px?nocab=1"</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>aa <span class="ot">&lt;-</span> <span class="fu">read.px</span>(url)</span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="fu">write.csv</span>(aa, <span class="at">file =</span> <span class="st">"./datos_pulidos/data.csv"</span>)</span>
<span id="cb4-11"><a href="#cb4-11"></a></span>
<span id="cb4-12"><a href="#cb4-12"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos_pulidos/data.csv"</span>)</span>
<span id="cb4-13"><a href="#cb4-13"></a></span>
<span id="cb4-14"><a href="#cb4-14"></a>df1 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(á<span class="at">mbito =</span> Comunidades.y.Ciudades.Autónomas, <span class="at">tipo =</span> General..vivienda.nueva.y.de.segunda.mano, <span class="at">Valor =</span> value) <span class="sc">%&gt;%</span> <span class="fu">filter</span> (tipo <span class="sc">==</span> <span class="st">"General"</span>, Índices.y.tasas <span class="sc">==</span> <span class="st">"Índice"</span>, ámbito <span class="sc">==</span> <span class="st">"Nacional"</span>)</span>
<span id="cb4-15"><a href="#cb4-15"></a></span>
<span id="cb4-16"><a href="#cb4-16"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df1, <span class="fu">aes</span>(<span class="at">x =</span> Periodo, <span class="at">y =</span> Valor)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Índice nivel de precios de la vivienda a nivel nacional"</span>, <span class="at">subtitle =</span> <span class="st">"Base 100 = 2015"</span>, <span class="at">y =</span> <span class="st">"Valor"</span>, <span class="at">x =</span> <span class="st">"Periodo"</span>,) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">theme_light</span>() <span class="sc">+</span> <span class="fu">rotateTextX</span>()</span>
<span id="cb4-17"><a href="#cb4-17"></a></span>
<span id="cb4-18"><a href="#cb4-18"></a>p1</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="my_trabajo_BigData_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>En este gráfico podemos observar cómo el nivel de precios general en españa tiene una forma de “uve”. Los precios caen de forma abrupta desde 2008 hasta 2013 (donde encontramos los valores más bajos) y luego vuelven a crecer más lentamente. Actualmente (2023T3) nos encontramos en niveles de precios similares a los de la burbuja, lo cual es negativo, pues ya era muy difícil acceder a la vivienda en la burbuja (sin endeudarse masivamente). Ahora, con el poco crecimiento de la renta con estos niveles de precios, también lo es.</p>
<hr></section><section id="variación-del-indice-de-precios-de-la-vivienda" class="level1"><h1>Variación del Indice de Precios de la Vivienda</h1>
<div class="cell" data-layout-align="center">
<details open=""><summary>Código</summary><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>df_IPV <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"./datos_pulidos/indice_precio_vivienda.csv"</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a>df <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"./datos_pulidos/tenencia_de_vivienda.csv"</span>)</span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a>df_IPV_01 <span class="ot">&lt;-</span> df_IPV <span class="sc">|&gt;</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="fu">filter</span>(Índices.y.tasas <span class="sc">==</span> <span class="st">"Variación anual"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-7"><a href="#cb5-7"></a>  <span class="fu">filter</span>(Comunidades.y.Ciudades.Autónomas <span class="sc">==</span> <span class="st">"Nacional"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-8"><a href="#cb5-8"></a>  <span class="fu">filter</span>(General..vivienda.nueva.y.de.segunda.mano <span class="sc">==</span> <span class="st">"General"</span>)</span>
<span id="cb5-9"><a href="#cb5-9"></a></span>
<span id="cb5-10"><a href="#cb5-10"></a>df_media_anual <span class="ot">&lt;-</span> df_IPV_01 <span class="sc">|&gt;</span> </span>
<span id="cb5-11"><a href="#cb5-11"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">substr</span>(Periodo, <span class="dv">1</span>, <span class="dv">4</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb5-12"><a href="#cb5-12"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span> </span>
<span id="cb5-13"><a href="#cb5-13"></a>  <span class="fu">summarise</span>(<span class="at">media_salario =</span> <span class="fu">mean</span>(value))</span>
<span id="cb5-14"><a href="#cb5-14"></a></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="fu">ggplot</span>(df_media_anual, <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>media_salario)) <span class="sc">+</span></span>
<span id="cb5-16"><a href="#cb5-16"></a>  <span class="fu">geom_segment</span>( <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">xend=</span> year, <span class="at">y=</span><span class="dv">0</span>, <span class="at">yend=</span>media_salario), <span class="at">color=</span><span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17"></a>  <span class="fu">geom_point</span>( <span class="at">color=</span><span class="st">"orange"</span>, <span class="at">size=</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb5-19"><a href="#cb5-19"></a>  <span class="fu">theme</span>(</span>
<span id="cb5-20"><a href="#cb5-20"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb5-21"><a href="#cb5-21"></a>    <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb5-22"><a href="#cb5-22"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb5-23"><a href="#cb5-23"></a>  ) <span class="sc">+</span></span>
<span id="cb5-24"><a href="#cb5-24"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb5-25"><a href="#cb5-25"></a>  <span class="fu">ylab</span>(<span class="st">"Índice del Precio de la Vivienda"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="my_trabajo_BigData_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>En este gráfico podemos observar las tasas de variación, de los niveles de precios por año. En este caso los datos son anuales. Sencillamente hemos sacado la media de los 4 trimestres para cada año. Aquí se puede ver claramente en qué años las tasas de variación fueron más negativas tras la explosión de la burbuja. Al contrario de lo que se suele pensar, las tasas más negativas fueron 2011, 2012 y 2013, no 2008. A partir de ahí se encadenan tasas positivas durante 10 años. Eso explica los altos niveles actuales.</p>
<hr></section><section id="mapa-de-coropletas-vivienda-por-ccaa" class="level1"><h1>Mapa de coropletas: Vivienda por CCAA</h1>
<p>A continuación comprobamos cómo ha evolucionado el precio de la vivienda por toda la geografía Española durante los últimos años. Para ello vamos a analizar los siguientes mapas de coropletas en los que, utilizamos un número índice con base 100 en 2015.</p>
<div class="cell" data-layout-align="center">
<details open=""><summary>Código</summary><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co">#Cargamos librerías</span></span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="fu">library</span>(rio)</span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="fu">library</span>(mapSpain)</span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="fu">library</span>(pxR)</span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="fu">library</span>(ggExtra) </span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="fu">library</span>(data.table)</span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="fu">library</span>(fs)</span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="fu">library</span>(sf)</span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="fu">library</span>(plotly)</span>
<span id="cb6-16"><a href="#cb6-16"></a></span>
<span id="cb6-17"><a href="#cb6-17"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"r-lib/conflicted"</span>)</span>
<span id="cb6-18"><a href="#cb6-18"></a></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="co">#Empezamos creado el dataframe</span></span>
<span id="cb6-20"><a href="#cb6-20"></a></span>
<span id="cb6-21"><a href="#cb6-21"></a>url <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/px/25171.px?nocab=1"</span></span>
<span id="cb6-22"><a href="#cb6-22"></a>aa <span class="ot">&lt;-</span> <span class="fu">read.px</span>(url)</span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="fu">write.csv</span>(aa, <span class="at">file =</span> <span class="st">"./datos_pulidos/data.csv"</span>)</span>
<span id="cb6-24"><a href="#cb6-24"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos_pulidos/data.csv"</span>)</span>
<span id="cb6-25"><a href="#cb6-25"></a></span>
<span id="cb6-26"><a href="#cb6-26"></a><span class="co">#Empezamos con el manejo de datos/ limpieza</span></span>
<span id="cb6-27"><a href="#cb6-27"></a>df1 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(á<span class="at">mbito =</span> Comunidades.y.Ciudades.Autónomas, <span class="at">tipo =</span> General..vivienda.nueva.y.de.segunda.mano, <span class="at">Valor =</span> value) <span class="sc">%&gt;%</span> <span class="fu">filter</span> (tipo <span class="sc">==</span> <span class="st">"General"</span>, Índices.y.tasas <span class="sc">==</span> <span class="st">"Índice"</span>, ámbito <span class="sc">==</span> <span class="st">"Nacional"</span>)</span>
<span id="cb6-28"><a href="#cb6-28"></a></span>
<span id="cb6-29"><a href="#cb6-29"></a>df1<span class="fl">.1</span>  <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Territorio =</span> Comunidades.y.Ciudades.Autónomas, <span class="at">tipo =</span> General..vivienda.nueva.y.de.segunda.mano, <span class="at">Valor =</span> value) </span>
<span id="cb6-30"><a href="#cb6-30"></a></span>
<span id="cb6-31"><a href="#cb6-31"></a>df1<span class="fl">.2</span> <span class="ot">&lt;-</span> df1<span class="fl">.1</span> <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Territorio =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-32"><a href="#cb6-32"></a>  Territorio <span class="sc">==</span> <span class="st">"01 Andalucía"</span> <span class="sc">~</span> <span class="st">"Andalucía"</span>,</span>
<span id="cb6-33"><a href="#cb6-33"></a>  Territorio <span class="sc">==</span> <span class="st">"02 Aragón"</span> <span class="sc">~</span> <span class="st">"Aragón"</span>,</span>
<span id="cb6-34"><a href="#cb6-34"></a>  Territorio <span class="sc">==</span> <span class="st">"03 Asturias, Principado de"</span> <span class="sc">~</span> <span class="st">"Asturias, Principado de"</span>,</span>
<span id="cb6-35"><a href="#cb6-35"></a>  Territorio <span class="sc">==</span> <span class="st">"04 Balears, Illes"</span> <span class="sc">~</span> <span class="st">"Balears, Illes"</span>,</span>
<span id="cb6-36"><a href="#cb6-36"></a>  Territorio <span class="sc">==</span> <span class="st">"05 Canarias"</span> <span class="sc">~</span> <span class="st">"Canarias"</span>,</span>
<span id="cb6-37"><a href="#cb6-37"></a>  Territorio <span class="sc">==</span> <span class="st">"06 Cantabria"</span> <span class="sc">~</span> <span class="st">"Cantabria"</span>,</span>
<span id="cb6-38"><a href="#cb6-38"></a>  Territorio <span class="sc">==</span> <span class="st">"07 Castilla y León"</span> <span class="sc">~</span> <span class="st">"Castilla y León"</span>,</span>
<span id="cb6-39"><a href="#cb6-39"></a>  Territorio <span class="sc">==</span> <span class="st">"08 Castilla - La Mancha"</span> <span class="sc">~</span> <span class="st">"Castilla-La Mancha"</span>,</span>
<span id="cb6-40"><a href="#cb6-40"></a>  Territorio <span class="sc">==</span> <span class="st">"09 Cataluña"</span> <span class="sc">~</span> <span class="st">"Cataluña"</span>,</span>
<span id="cb6-41"><a href="#cb6-41"></a>  Territorio <span class="sc">==</span> <span class="st">"10 Comunitat Valenciana"</span> <span class="sc">~</span> <span class="st">"Comunitat Valenciana"</span>,</span>
<span id="cb6-42"><a href="#cb6-42"></a>  Territorio <span class="sc">==</span> <span class="st">"11 Extremadura"</span> <span class="sc">~</span> <span class="st">"Extremadura"</span>,</span>
<span id="cb6-43"><a href="#cb6-43"></a>  Territorio <span class="sc">==</span> <span class="st">"12 Galicia"</span> <span class="sc">~</span> <span class="st">"Galicia"</span>,</span>
<span id="cb6-44"><a href="#cb6-44"></a>  Territorio <span class="sc">==</span> <span class="st">"13 Madrid, Comunidad de"</span> <span class="sc">~</span> <span class="st">"Madrid, Comunidad de"</span>,</span>
<span id="cb6-45"><a href="#cb6-45"></a>  Territorio <span class="sc">==</span> <span class="st">"14 Murcia, Región de"</span> <span class="sc">~</span> <span class="st">"Murcia, Región de"</span>,</span>
<span id="cb6-46"><a href="#cb6-46"></a>  Territorio <span class="sc">==</span> <span class="st">"15 Navarra, Comunidad Foral de"</span> <span class="sc">~</span> <span class="st">"Navarra, Comunidad Foral de"</span>,</span>
<span id="cb6-47"><a href="#cb6-47"></a>  Territorio <span class="sc">==</span> <span class="st">"16 País Vasco"</span> <span class="sc">~</span> <span class="st">"País Vasco"</span>,</span>
<span id="cb6-48"><a href="#cb6-48"></a>  Territorio <span class="sc">==</span> <span class="st">"17 Rioja, La"</span> <span class="sc">~</span> <span class="st">"Rioja, La"</span>,</span>
<span id="cb6-49"><a href="#cb6-49"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> Territorio))</span>
<span id="cb6-50"><a href="#cb6-50"></a></span>
<span id="cb6-51"><a href="#cb6-51"></a>df3 <span class="ot">&lt;-</span> df1<span class="fl">.2</span> <span class="sc">%&gt;%</span> <span class="fu">filter</span> (tipo <span class="sc">==</span> <span class="st">"General"</span>, Índices.y.tasas <span class="sc">==</span> <span class="st">"Índice"</span>, <span class="sc">!</span>(Territorio <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Nacional"</span>, <span class="st">"18 Ceuta"</span>, <span class="st">"19 Melilla"</span>)))</span>
<span id="cb6-52"><a href="#cb6-52"></a></span>
<span id="cb6-53"><a href="#cb6-53"></a>prov <span class="ot">&lt;-</span> pjpv.curso.R<span class="fl">.2022</span><span class="sc">::</span>LAU2_prov_2020_canarias</span>
<span id="cb6-54"><a href="#cb6-54"></a></span>
<span id="cb6-55"><a href="#cb6-55"></a>ccaa <span class="ot">&lt;-</span> prov <span class="sc">%&gt;%</span> </span>
<span id="cb6-56"><a href="#cb6-56"></a>  <span class="fu">group_by</span>(ine_ccaa, ine_ccaa.n, ine_ccaa.n.pjp) <span class="sc">%&gt;%</span> </span>
<span id="cb6-57"><a href="#cb6-57"></a>  <span class="fu">summarise</span>() <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb6-58"><a href="#cb6-58"></a></span>
<span id="cb6-59"><a href="#cb6-59"></a>ccaa <span class="ot">&lt;-</span> ccaa <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Territorio =</span> ine_ccaa.n)</span>
<span id="cb6-60"><a href="#cb6-60"></a></span>
<span id="cb6-61"><a href="#cb6-61"></a>df4 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Periodo <span class="sc">==</span> <span class="st">"2023T3"</span>)</span>
<span id="cb6-62"><a href="#cb6-62"></a></span>
<span id="cb6-63"><a href="#cb6-63"></a>df5 <span class="ot">&lt;-</span> <span class="fu">full_join</span>(ccaa, df4, <span class="at">by =</span> <span class="st">"Territorio"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>( <span class="sc">!</span>(Territorio <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ceuta"</span>, <span class="st">"Melilla"</span>)))</span>
<span id="cb6-64"><a href="#cb6-64"></a></span>
<span id="cb6-65"><a href="#cb6-65"></a>df6 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span> </span>
<span id="cb6-66"><a href="#cb6-66"></a>  <span class="fu">filter</span>(Periodo <span class="sc">==</span> <span class="st">"2018T3"</span>)</span>
<span id="cb6-67"><a href="#cb6-67"></a></span>
<span id="cb6-68"><a href="#cb6-68"></a>df7 <span class="ot">&lt;-</span> <span class="fu">full_join</span>(ccaa, df6, <span class="at">by =</span> <span class="st">"Territorio"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>( <span class="sc">!</span>(Territorio <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ceuta"</span>, <span class="st">"Melilla"</span>)))</span>
<span id="cb6-69"><a href="#cb6-69"></a></span>
<span id="cb6-70"><a href="#cb6-70"></a>df8 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Periodo <span class="sc">==</span> <span class="st">"2015T3"</span>)</span>
<span id="cb6-71"><a href="#cb6-71"></a></span>
<span id="cb6-72"><a href="#cb6-72"></a>df9 <span class="ot">&lt;-</span> <span class="fu">full_join</span>(ccaa, df8, <span class="at">by =</span> <span class="st">"Territorio"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>( <span class="sc">!</span>(Territorio <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ceuta"</span>, <span class="st">"Melilla"</span>)))</span>
<span id="cb6-73"><a href="#cb6-73"></a></span>
<span id="cb6-74"><a href="#cb6-74"></a>df10 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Periodo <span class="sc">==</span> <span class="st">"2011T3"</span>)</span>
<span id="cb6-75"><a href="#cb6-75"></a></span>
<span id="cb6-76"><a href="#cb6-76"></a>df11 <span class="ot">&lt;-</span> <span class="fu">full_join</span>(ccaa, df10, <span class="at">by =</span> <span class="st">"Territorio"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>( <span class="sc">!</span>(Territorio <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ceuta"</span>, <span class="st">"Melilla"</span>)))</span>
<span id="cb6-77"><a href="#cb6-77"></a></span>
<span id="cb6-78"><a href="#cb6-78"></a><span class="co">#Empezamos a dibujar mapas</span></span>
<span id="cb6-79"><a href="#cb6-79"></a></span>
<span id="cb6-80"><a href="#cb6-80"></a>escala_limites <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">170</span>)</span>
<span id="cb6-81"><a href="#cb6-81"></a></span>
<span id="cb6-82"><a href="#cb6-82"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df5, <span class="fu">aes</span>(<span class="at">fill =</span> Valor)) <span class="sc">+</span> </span>
<span id="cb6-83"><a href="#cb6-83"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb6-84"><a href="#cb6-84"></a>  <span class="fu">geom_sf_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">as.character</span>(Valor)), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb6-85"><a href="#cb6-85"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">guide =</span> <span class="st">"legend"</span>,<span class="at">limits =</span> escala_limites) <span class="sc">+</span></span>
<span id="cb6-86"><a href="#cb6-86"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Nivel de precios de la vivienda 2023"</span>) <span class="sc">+</span> </span>
<span id="cb6-87"><a href="#cb6-87"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb6-88"><a href="#cb6-88"></a></span>
<span id="cb6-89"><a href="#cb6-89"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df7, <span class="fu">aes</span>(<span class="at">fill =</span> Valor)) <span class="sc">+</span> </span>
<span id="cb6-90"><a href="#cb6-90"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb6-91"><a href="#cb6-91"></a>  <span class="fu">geom_sf_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">as.character</span>(Valor)), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb6-92"><a href="#cb6-92"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">guide =</span> <span class="st">"legend"</span>, <span class="at">limits =</span> escala_limites) <span class="sc">+</span></span>
<span id="cb6-93"><a href="#cb6-93"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Nivel de precios de la vivienda 2018"</span>) <span class="sc">+</span> </span>
<span id="cb6-94"><a href="#cb6-94"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb6-95"><a href="#cb6-95"></a></span>
<span id="cb6-96"><a href="#cb6-96"></a>p6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df9, <span class="fu">aes</span>(<span class="at">fill =</span> Valor)) <span class="sc">+</span> </span>
<span id="cb6-97"><a href="#cb6-97"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb6-98"><a href="#cb6-98"></a>  <span class="fu">geom_sf_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">as.character</span>(Valor)), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb6-99"><a href="#cb6-99"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">guide =</span> <span class="st">"legend"</span>,<span class="at">limits =</span> escala_limites) <span class="sc">+</span></span>
<span id="cb6-100"><a href="#cb6-100"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Nivel de precios de la vivienda 2015"</span>) <span class="sc">+</span> </span>
<span id="cb6-101"><a href="#cb6-101"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb6-102"><a href="#cb6-102"></a></span>
<span id="cb6-103"><a href="#cb6-103"></a>p7 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df11, <span class="fu">aes</span>(<span class="at">fill =</span> Valor)) <span class="sc">+</span> </span>
<span id="cb6-104"><a href="#cb6-104"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb6-105"><a href="#cb6-105"></a>  <span class="fu">geom_sf_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">as.character</span>(Valor)), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb6-106"><a href="#cb6-106"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">guide =</span> <span class="st">"legend"</span>,<span class="at">limits =</span> escala_limites) <span class="sc">+</span></span>
<span id="cb6-107"><a href="#cb6-107"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Nivel de precios de la vivienda 2011"</span>) <span class="sc">+</span> </span>
<span id="cb6-108"><a href="#cb6-108"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb6-109"><a href="#cb6-109"></a></span>
<span id="cb6-110"><a href="#cb6-110"></a><span class="co">#Combinar todos los gráficos</span></span>
<span id="cb6-111"><a href="#cb6-111"></a></span>
<span id="cb6-112"><a href="#cb6-112"></a>p9 <span class="ot">&lt;-</span>p7 <span class="sc">+</span> p6 <span class="sc">+</span>p5 <span class="sc">+</span>p4</span>
<span id="cb6-113"><a href="#cb6-113"></a></span>
<span id="cb6-114"><a href="#cb6-114"></a>p9</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="my_trabajo_BigData_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Estos mapas de coropletas reflejan los niveles de precios de la vivienda en 6 momentos diferentes del tiempo. El primero es del tercer trimestre del año 2007. En ese momento los precios, como podemos observar, son los más altos. Este es el punto más elevado de la burbuja. Los años siguientes reflejan el pinchazo de la burbuja, con un descenso continuado de los precios hasta 2013. Que es el punto más bajo. Hemos decidido poner el año 2015 por ser el año de la base 100. A partir de ahí, vemos cómo en los años posteriores los precios son ya más elevados que en 2015, y particularmente en 2023, ligeramente por debajo, pero sin haber una burbuja. O, al menos, no parece haberla.</p>
<p>Al ser mapas de coropletas podemos sacar conclusiones acerca de en qué comunidades han aumentado más los precios y por tanto, dónde es más difícil acceder a la vivienda, ceteris paribus. En el último gráfico destacan claramente la Comunidad de Madrid, Cataluña y Baleares. Esto no nos sorprende, tanto la Comunidad de Madrid, como Cataluña son regiones muy dinámicas donde, además, se encuentran las principales ciudades de España. Baleares, por su parte, es una de las regiones más turísticas, donde la oferta de inmuebles tampoco es demasiado elevada. Destacan también en segunda fila País Vasco (región muy dinámica), Andalucía y Canarias (regiones muy turísticas).</p>
<p>Tal vez os habéis fijado en que estos mapas no concuerdan exactamente con lo que hemos visto hace dos gráficos (se veía que el nivel general de precios de la vivienda es ahora igual al del punto más alto de la burbuja y, sin embargo, en los mapas parece que en 2007T3 los precios son mucho más elevados que en la actualidad).</p>
<p>Esto se debe a que hay más viviendas allá donde más está subiendo el precio como se observa en el gráfico (que hay que insertar). La explicación de la afirmación anterior que parece a priori contradictoria, es que aunque hay más vivienda en esta zona (oferta elevada), la demanda es todavía más elevada que la oferta.</p>
<p>Este continuo encarecimiento de las viviendas se traduce en que los jóvenes cambian su régimen de tenencia de vivienda:P$OE</p>
<hr></section><section id="régimen-de-viviendas-de-16-a-29-años" class="level1"><h1>Régimen de viviendas de 16 a 29 años</h1>
<div class="cell" data-layout-align="center">
<details open=""><summary>Código</summary><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">#Hogares por regimen de tenencia edad</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co">#Cargamos liberías</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="fu">library</span>(hrbrthemes)</span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="fu">library</span>(pxR)</span>
<span id="cb7-7"><a href="#cb7-7"></a></span>
<span id="cb7-8"><a href="#cb7-8"></a>url4 <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/px/9994.px?nocab=1"</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>ac <span class="ot">&lt;-</span> <span class="fu">read.px</span>(url4)</span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="fu">write.csv</span>(ac, <span class="at">file =</span> <span class="st">"./datos_pulidos/data_1.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb7-11"><a href="#cb7-11"></a>vivienda_edad <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos_pulidos/data_1.csv"</span>)</span>
<span id="cb7-12"><a href="#cb7-12"></a></span>
<span id="cb7-13"><a href="#cb7-13"></a>dd <span class="ot">&lt;-</span> vivienda_edad <span class="sc">%&gt;%</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">regimen =</span> Régimen.de.tenencia.de.la.vivienda.principal, <span class="at">edad =</span> Edad.de.la.persona.de.referencia, <span class="at">sexo =</span> Sexo.de.la.persona.de.referencia) <span class="sc">%&gt;%</span></span>
<span id="cb7-15"><a href="#cb7-15"></a>  <span class="fu">filter</span>(edad <span class="sc">==</span> <span class="st">"De 16 a 29 años"</span>, sexo <span class="sc">==</span> <span class="st">"Ambos sexos"</span>)</span>
<span id="cb7-16"><a href="#cb7-16"></a></span>
<span id="cb7-17"><a href="#cb7-17"></a>p30 <span class="ot">&lt;-</span> dd <span class="sc">%&gt;%</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Periodo, <span class="at">y =</span> value, <span class="at">fill =</span> regimen)) <span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20"></a>  <span class="fu">theme_ipsum</span>() <span class="sc">+</span></span>
<span id="cb7-21"><a href="#cb7-21"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Año"</span>, <span class="at">y =</span> <span class="st">"% según régimen de tenencia"</span>, </span>
<span id="cb7-22"><a href="#cb7-22"></a>       <span class="at">title =</span> <span class="st">"Régimen de vivienda de 16 a 29 años"</span>,</span>
<span id="cb7-23"><a href="#cb7-23"></a>       <span class="at">subtitle =</span> <span class="st">"Datos porcentuales"</span>,</span>
<span id="cb7-24"><a href="#cb7-24"></a>       <span class="at">caption =</span> <span class="st">"Elaboración propia a partir de datos del INE"</span>) <span class="sc">+</span></span>
<span id="cb7-25"><a href="#cb7-25"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#66c2a5"</span>, <span class="st">"#fc8d62"</span>, <span class="st">"#8da0cb"</span>, <span class="st">"#e78ac3"</span>), </span>
<span id="cb7-26"><a href="#cb7-26"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Alquiler a precios de mercado"</span>, <span class="st">"Alquiler inferior al precio de mercado"</span>, <span class="st">"Cesión"</span>, <span class="st">"Propiedad"</span>)) <span class="sc">+</span></span>
<span id="cb7-27"><a href="#cb7-27"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>), </span>
<span id="cb7-28"><a href="#cb7-28"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb7-29"><a href="#cb7-29"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">18</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb7-30"><a href="#cb7-30"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb7-31"><a href="#cb7-31"></a></span>
<span id="cb7-32"><a href="#cb7-32"></a>p30</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="my_trabajo_BigData_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>En este gráfico podemos observar cómo el régimen de vivienda entre los jóvenes ha ido variando a lo largo del tiempo. La mayor sustitución ha sido de régimen de propiedad al de alquiler a precios de mercado. También ha aumentado ligeramente el régimen de cesión, es decir; los jóvenes se han trasladado a opciones más asequibles. Aunque los alquileres también suben en las grandes ciudades, siguen siendo opciones más asumibles que pagar la entrada de la hipoteca y su mensualidad, por no hablar de fórmulas utilizadas como el compartir piso.</p>
<hr></section><section id="otros-gráficos-bonitos-pero-poco-útiles-sobre-el-salario" class="level1"><h1>Otros gráficos bonitos pero poco útiles sobre el salario</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Rigeline por grupo de edad</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Rigeline por formación</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Barras agrupadas por edad</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false">Barras agrupadas por formación</a></li>
</ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell" data-layout-align="center">
<details open=""><summary>Código</summary><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">library</span>(rio)</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb8-5"><a href="#cb8-5"></a></span>
<span id="cb8-6"><a href="#cb8-6"></a>df_edad <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"./datos_pulidos/salario_grupo_edad.csv"</span>)</span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a>p1<span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_edad, <span class="fu">aes</span>(<span class="at">x =</span> salario, <span class="at">y =</span> grupo_edad, <span class="at">fill =</span> grupo_edad)) <span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>  <span class="fu">geom_density_ridges</span>() <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>  <span class="fu">theme_ridges</span>() <span class="sc">+</span> </span>
<span id="cb8-11"><a href="#cb8-11"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb8-12"><a href="#cb8-12"></a></span>
<span id="cb8-13"><a href="#cb8-13"></a>p1</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="my_trabajo_BigData_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell" data-layout-align="center">
<details open=""><summary>Código</summary><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="fu">library</span>(rio)</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a>df_formacion <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"./datos_pulidos/salario_formacion.csv"</span>)</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a>p4<span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_formacion, <span class="fu">aes</span>(<span class="at">x =</span> salario, <span class="at">y =</span> formacion, <span class="at">fill =</span> formacion)) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>  <span class="fu">geom_density_ridges</span>() <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>  <span class="fu">theme_ridges</span>() <span class="sc">+</span> </span>
<span id="cb9-11"><a href="#cb9-11"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb9-12"><a href="#cb9-12"></a></span>
<span id="cb9-13"><a href="#cb9-13"></a>p4</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="my_trabajo_BigData_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell" data-layout-align="center">
<details open=""><summary>Código</summary><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="fu">library</span>(rio)</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb10-5"><a href="#cb10-5"></a></span>
<span id="cb10-6"><a href="#cb10-6"></a>df_edad <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"./datos_pulidos/salario_grupo_edad.csv"</span>)</span>
<span id="cb10-7"><a href="#cb10-7"></a></span>
<span id="cb10-8"><a href="#cb10-8"></a>df_edad_01 <span class="ot">&lt;-</span> df_edad <span class="sc">|&gt;</span> </span>
<span id="cb10-9"><a href="#cb10-9"></a>  <span class="fu">filter</span>(grupo_edad <span class="sc">!=</span> <span class="st">"Total"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-10"><a href="#cb10-10"></a>  <span class="fu">filter</span>()</span>
<span id="cb10-11"><a href="#cb10-11"></a></span>
<span id="cb10-12"><a href="#cb10-12"></a>df_edad_01<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_edad_01<span class="sc">$</span>year)</span>
<span id="cb10-13"><a href="#cb10-13"></a></span>
<span id="cb10-14"><a href="#cb10-14"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_edad_01, <span class="fu">aes</span>(<span class="at">fill =</span> grupo_edad, <span class="at">y =</span> salario, <span class="at">x =</span> year))<span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Salario por grupo de edad"</span>)</span>
<span id="cb10-17"><a href="#cb10-17"></a></span>
<span id="cb10-18"><a href="#cb10-18"></a>p2</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="my_trabajo_BigData_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div class="cell" data-layout-align="center">
<details open=""><summary>Código</summary><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">library</span>(rio)</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb11-5"><a href="#cb11-5"></a></span>
<span id="cb11-6"><a href="#cb11-6"></a>df_formacion <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"./datos_pulidos/salario_formacion.csv"</span>)</span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a>df_form_01 <span class="ot">&lt;-</span> df_formacion <span class="sc">|&gt;</span> </span>
<span id="cb11-9"><a href="#cb11-9"></a>  <span class="fu">filter</span>(formacion <span class="sc">!=</span> <span class="st">"Total"</span>)</span>
<span id="cb11-10"><a href="#cb11-10"></a></span>
<span id="cb11-11"><a href="#cb11-11"></a>df_form_01<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_form_01<span class="sc">$</span>year)</span>
<span id="cb11-12"><a href="#cb11-12"></a></span>
<span id="cb11-13"><a href="#cb11-13"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_form_01, <span class="fu">aes</span>(<span class="at">fill =</span> formacion, <span class="at">y =</span> salario, <span class="at">x =</span> year))<span class="sc">+</span></span>
<span id="cb11-14"><a href="#cb11-14"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb11-15"><a href="#cb11-15"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Salario por formación"</span>)</span>
<span id="cb11-16"><a href="#cb11-16"></a></span>
<span id="cb11-17"><a href="#cb11-17"></a>p5</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="my_trabajo_BigData_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<hr></section><section id="mas-información-sobre-el-tema" class="level1"><h1>Mas información sobre el tema</h1>
<p>un video de blablabla</p>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/live/EtIErMd1EYM?si=-LNzHLRcepGHZ-r5">
</iframe>
</center>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Ejecutar el código</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb12" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb12-1"><a href="#cb12-1"></a><span class="co">---</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="an">title:</span><span class="co"> "VIVIENDA EN ESPAÑA"</span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="an">description:</span><span class="co"> |</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co">  Vamos a analizar el mercado de la vivienda y comprarlo con su accesibilidad de los jóvenes </span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="an">author:</span><span class="co">   </span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="co">  - Saúl Gil\n   </span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co">  - Pedro Peñalver\n</span></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="co">  - Joel Seguí</span></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="an">date:</span><span class="co"> 2023-11-01                           #--</span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="an">categories:</span><span class="co"> [Trabajo BigData, Vivienda]      #--</span></span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="an">image:</span><span class="co"> "./imagenes/my_favicon.png"</span></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="an">title-block-banner:</span><span class="co"> true #- {true, false, "green","#AA0000"}</span></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="an">title-block-banner-color:</span><span class="co"> "lightgrey"    #-"#FFFFFF" </span></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="an">toc-depth:</span><span class="co"> 3</span></span>
<span id="cb12-15"><a href="#cb12-15"></a><span class="an">smooth-scroll:</span><span class="co"> true</span></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb12-17"><a href="#cb12-17"></a><span class="co">  html:</span></span>
<span id="cb12-18"><a href="#cb12-18"></a><span class="co">    #backgroundcolor: "#F1F3F4"</span></span>
<span id="cb12-19"><a href="#cb12-19"></a><span class="co">    #embed-resources: true</span></span>
<span id="cb12-20"><a href="#cb12-20"></a><span class="co">    link-external-newwindow: true</span></span>
<span id="cb12-21"><a href="#cb12-21"></a><span class="co">    #css: ./assets/my_css_file.css   #- CUIDADO!!!!</span></span>
<span id="cb12-22"><a href="#cb12-22"></a><span class="an">code-tools:</span><span class="co"> true</span></span>
<span id="cb12-23"><a href="#cb12-23"></a><span class="an">code-link:</span><span class="co"> true</span></span>
<span id="cb12-24"><a href="#cb12-24"></a><span class="co">---</span></span>
<span id="cb12-25"><a href="#cb12-25"></a></span>
<span id="cb12-26"><a href="#cb12-26"></a><span class="fu"># Introducción </span></span>
<span id="cb12-27"><a href="#cb12-27"></a></span>
<span id="cb12-28"><a href="#cb12-28"></a>El objetivo de este trabajo es analizar la situación en la que se encuentran los jóvenes a la hora de acceder al mercado laboral. Para ello analizaremos diferentes métricas entre las que se encuentran: Evolución de los niveles de precios de la vivienda a nivel nacional y autonómico, comparación de esta con la de los salarios reales…</span>
<span id="cb12-29"><a href="#cb12-29"></a></span>
<span id="cb12-30"><a href="#cb12-30"></a>De esta manera constataremos las dificultades a alas que se enfrentan los jóvenes españoles para emanciparse. También extraeremos conclusiones sobre si es así en todo el país o si por el contrario hay diferencias según el área geográfica. </span>
<span id="cb12-31"><a href="#cb12-31"></a></span>
<span id="cb12-32"><a href="#cb12-32"></a><span class="fu"># Datos del trabajo</span></span>
<span id="cb12-33"><a href="#cb12-33"></a></span>
<span id="cb12-34"><a href="#cb12-34"></a>::: {.panel-tabset}</span>
<span id="cb12-35"><a href="#cb12-35"></a></span>
<span id="cb12-36"><a href="#cb12-36"></a><span class="fu"># Datos</span></span>
<span id="cb12-37"><a href="#cb12-37"></a></span>
<span id="cb12-38"><a href="#cb12-38"></a>Vamos a utilizar datos de los paquetes <span class="in">`pxR`</span> <span class="kw">&lt;i&gt;</span>(ine)<span class="kw">&lt;/I&gt;</span>, <span class="in">`eurostat`</span> además de proveedores de datos externos.</span>
<span id="cb12-39"><a href="#cb12-39"></a></span>
<span id="cb12-40"><a href="#cb12-40"></a><span class="fu"># Código</span></span>
<span id="cb12-41"><a href="#cb12-41"></a></span>
<span id="cb12-44"><a href="#cb12-44"></a><span class="in">```{R}</span></span>
<span id="cb12-45"><a href="#cb12-45"></a><span class="co">#Paquetes Preliminares</span></span>
<span id="cb12-46"><a href="#cb12-46"></a><span class="fu">library</span>(pxR)</span>
<span id="cb12-47"><a href="#cb12-47"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-48"><a href="#cb12-48"></a><span class="fu">library</span>(data.table)</span>
<span id="cb12-49"><a href="#cb12-49"></a><span class="fu">library</span>(rlist)</span>
<span id="cb12-50"><a href="#cb12-50"></a><span class="fu">library</span>(fs)</span>
<span id="cb12-51"><a href="#cb12-51"></a><span class="fu">library</span>(curl)</span>
<span id="cb12-52"><a href="#cb12-52"></a><span class="fu">library</span>(rio)</span>
<span id="cb12-53"><a href="#cb12-53"></a><span class="fu">library</span>(readxl)</span>
<span id="cb12-54"><a href="#cb12-54"></a><span class="fu">library</span>(downloader)</span>
<span id="cb12-55"><a href="#cb12-55"></a><span class="fu">library</span>(writexl)</span>
<span id="cb12-56"><a href="#cb12-56"></a></span>
<span id="cb12-57"><a href="#cb12-57"></a><span class="co">#-------------------Creamos una carpeta para guardar los datos------------------</span></span>
<span id="cb12-58"><a href="#cb12-58"></a></span>
<span id="cb12-59"><a href="#cb12-59"></a><span class="fu">dir_create</span>(<span class="st">"./docs/datos"</span>)</span>
<span id="cb12-60"><a href="#cb12-60"></a></span>
<span id="cb12-61"><a href="#cb12-61"></a><span class="co">#Descargamos los datos y los exportamos sin pulir: </span></span>
<span id="cb12-62"><a href="#cb12-62"></a></span>
<span id="cb12-63"><a href="#cb12-63"></a><span class="co">#---------------------Índice de Precios de Vivienda-----------------------------</span></span>
<span id="cb12-64"><a href="#cb12-64"></a></span>
<span id="cb12-65"><a href="#cb12-65"></a>url <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/px/25171.px?nocab=1"</span></span>
<span id="cb12-66"><a href="#cb12-66"></a>aa <span class="ot">&lt;-</span> <span class="fu">read.px</span>(url)</span>
<span id="cb12-67"><a href="#cb12-67"></a></span>
<span id="cb12-68"><a href="#cb12-68"></a><span class="co">#Lo convertimos a CSV para simplificar y creamos un dataframe</span></span>
<span id="cb12-69"><a href="#cb12-69"></a></span>
<span id="cb12-70"><a href="#cb12-70"></a><span class="fu">write.csv</span>(aa, <span class="at">file =</span> <span class="st">"data.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb12-71"><a href="#cb12-71"></a>IPV <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data.csv"</span>)</span>
<span id="cb12-72"><a href="#cb12-72"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()[<span class="sc">!</span><span class="fu">ls</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"IPV"</span>)])</span>
<span id="cb12-73"><a href="#cb12-73"></a></span>
<span id="cb12-74"><a href="#cb12-74"></a><span class="co">#Los guardamos sin arreglar</span></span>
<span id="cb12-75"><a href="#cb12-75"></a><span class="fu">write.csv</span>(IPV,  <span class="at">file =</span> <span class="st">"./docs/datos/ipv.csv"</span>)</span>
<span id="cb12-76"><a href="#cb12-76"></a><span class="co">#-------------------------Compra-venta de vivienda------------------------------</span></span>
<span id="cb12-77"><a href="#cb12-77"></a></span>
<span id="cb12-78"><a href="#cb12-78"></a>ruta_xls <span class="ot">&lt;-</span> <span class="st">"https://apps.fomento.gob.es/BoletinOnline2/sedal/34010110.XLS"</span></span>
<span id="cb12-79"><a href="#cb12-79"></a></span>
<span id="cb12-80"><a href="#cb12-80"></a><span class="fu">download.file</span>(ruta_xls, <span class="st">"datos.xls"</span>, <span class="at">mode =</span> <span class="st">"wb"</span>)</span>
<span id="cb12-81"><a href="#cb12-81"></a></span>
<span id="cb12-82"><a href="#cb12-82"></a>nombres_hojas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2004,2005,2006,2007,2008"</span>, <span class="st">"2009,2010,2011,2012,2013"</span>, </span>
<span id="cb12-83"><a href="#cb12-83"></a>                   <span class="st">"2014,2015,2016,2017,2018"</span>, <span class="st">"2019,2020,2021,2022,2023"</span>)</span>
<span id="cb12-84"><a href="#cb12-84"></a><span class="co"># Leer todas las hojas en una lista</span></span>
<span id="cb12-85"><a href="#cb12-85"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(nombres_hojas)) {</span>
<span id="cb12-86"><a href="#cb12-86"></a>  hoja <span class="ot">&lt;-</span> nombres_hojas[i]</span>
<span id="cb12-87"><a href="#cb12-87"></a>  df <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"datos.xls"</span>, <span class="at">sheet =</span> i) </span>
<span id="cb12-88"><a href="#cb12-88"></a>  <span class="fu">write.csv</span>(df, <span class="at">file =</span> <span class="fu">paste0</span>(hoja, <span class="st">".csv"</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>)}</span>
<span id="cb12-89"><a href="#cb12-89"></a></span>
<span id="cb12-90"><a href="#cb12-90"></a><span class="co">#Juntamos las cuatro sheets en una y después arreglaremos el desastre</span></span>
<span id="cb12-91"><a href="#cb12-91"></a>compraventa_2004 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"2004,2005,2006,2007,2008.csv"</span>)</span>
<span id="cb12-92"><a href="#cb12-92"></a>compraventa_2009 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"2009,2010,2011,2012,2013.csv"</span>)</span>
<span id="cb12-93"><a href="#cb12-93"></a>compraventa_2014 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"2014,2015,2016,2017,2018.csv"</span>)</span>
<span id="cb12-94"><a href="#cb12-94"></a>compraventa_2019 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"2019,2020,2021,2022,2023.csv"</span>)</span>
<span id="cb12-95"><a href="#cb12-95"></a></span>
<span id="cb12-96"><a href="#cb12-96"></a>cv <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(compraventa_2009,compraventa_2014)</span>
<span id="cb12-97"><a href="#cb12-97"></a>cv <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(cv,compraventa_2019)</span>
<span id="cb12-98"><a href="#cb12-98"></a>compraventa_2004 <span class="ot">&lt;-</span> compraventa_2004[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(cv), ]</span>
<span id="cb12-99"><a href="#cb12-99"></a>cv <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(cv,compraventa_2004)</span>
<span id="cb12-100"><a href="#cb12-100"></a></span>
<span id="cb12-101"><a href="#cb12-101"></a></span>
<span id="cb12-102"><a href="#cb12-102"></a>cv <span class="ot">&lt;-</span> cv <span class="sc">%&gt;%</span></span>
<span id="cb12-103"><a href="#cb12-103"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">72</span>)</span>
<span id="cb12-104"><a href="#cb12-104"></a>cv <span class="ot">&lt;-</span> cv <span class="sc">%&gt;%</span></span>
<span id="cb12-105"><a href="#cb12-105"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="dv">2</span>)</span>
<span id="cb12-106"><a href="#cb12-106"></a></span>
<span id="cb12-107"><a href="#cb12-107"></a><span class="co">#Los guardamos sin arreglar</span></span>
<span id="cb12-108"><a href="#cb12-108"></a><span class="fu">write.csv</span>(cv,  <span class="at">file =</span> <span class="st">"./docs/datos/cv.csv"</span>)</span>
<span id="cb12-109"><a href="#cb12-109"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb12-110"><a href="#cb12-110"></a></span>
<span id="cb12-111"><a href="#cb12-111"></a></span>
<span id="cb12-112"><a href="#cb12-112"></a><span class="co">#--------------------------Renta por edad y sexo--------------------------------</span></span>
<span id="cb12-113"><a href="#cb12-113"></a></span>
<span id="cb12-114"><a href="#cb12-114"></a>url3 <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/px/9942.px?nocab=1"</span></span>
<span id="cb12-115"><a href="#cb12-115"></a>aa <span class="ot">&lt;-</span> <span class="fu">read.px</span>(url3)</span>
<span id="cb12-116"><a href="#cb12-116"></a></span>
<span id="cb12-117"><a href="#cb12-117"></a><span class="co">#Lo convertimos a CSV para simplificar y creamos un dataframe</span></span>
<span id="cb12-118"><a href="#cb12-118"></a></span>
<span id="cb12-119"><a href="#cb12-119"></a><span class="fu">write.csv</span>(aa, <span class="at">file =</span> <span class="st">"data.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb12-120"><a href="#cb12-120"></a>renta_edad <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data.csv"</span>)</span>
<span id="cb12-121"><a href="#cb12-121"></a></span>
<span id="cb12-122"><a href="#cb12-122"></a><span class="co">#Los guardamos sin arreglar</span></span>
<span id="cb12-123"><a href="#cb12-123"></a><span class="fu">write.csv</span>(renta_edad, <span class="at">file =</span> <span class="st">"./docs/datos/renta_edad.csv"</span>)</span>
<span id="cb12-124"><a href="#cb12-124"></a></span>
<span id="cb12-125"><a href="#cb12-125"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb12-126"><a href="#cb12-126"></a><span class="co">#---------------------------Renta por nacionalidad------------------------------</span></span>
<span id="cb12-127"><a href="#cb12-127"></a></span>
<span id="cb12-128"><a href="#cb12-128"></a>url4 <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/px/9945.px?nocab=1"</span></span>
<span id="cb12-129"><a href="#cb12-129"></a>aa <span class="ot">&lt;-</span> <span class="fu">read.px</span>(url4)</span>
<span id="cb12-130"><a href="#cb12-130"></a></span>
<span id="cb12-131"><a href="#cb12-131"></a><span class="co">#Lo convertimos a CSV para simplificar y creamos un dataframe</span></span>
<span id="cb12-132"><a href="#cb12-132"></a></span>
<span id="cb12-133"><a href="#cb12-133"></a><span class="fu">write.csv</span>(aa, <span class="at">file =</span> <span class="st">"data.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb12-134"><a href="#cb12-134"></a>renta_nacionalidad <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data.csv"</span>)</span>
<span id="cb12-135"><a href="#cb12-135"></a></span>
<span id="cb12-136"><a href="#cb12-136"></a><span class="co">#Los guardamos sin arreglar</span></span>
<span id="cb12-137"><a href="#cb12-137"></a><span class="fu">write.csv</span>(renta_nacionalidad, <span class="at">file =</span> <span class="st">"./docs/datos/renta_nacionalidad.csv"</span>)</span>
<span id="cb12-138"><a href="#cb12-138"></a></span>
<span id="cb12-139"><a href="#cb12-139"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb12-140"><a href="#cb12-140"></a></span>
<span id="cb12-141"><a href="#cb12-141"></a></span>
<span id="cb12-142"><a href="#cb12-142"></a><span class="co">#---------------------Hogares por regimen de tenencia edad----------------------</span></span>
<span id="cb12-143"><a href="#cb12-143"></a></span>
<span id="cb12-144"><a href="#cb12-144"></a>url4 <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/px/9994.px?nocab=1"</span></span>
<span id="cb12-145"><a href="#cb12-145"></a>aa <span class="ot">&lt;-</span> <span class="fu">read.px</span>(url4)</span>
<span id="cb12-146"><a href="#cb12-146"></a></span>
<span id="cb12-147"><a href="#cb12-147"></a><span class="co">#Lo convertimos a CSV para simplificar y creamos un dataframe</span></span>
<span id="cb12-148"><a href="#cb12-148"></a></span>
<span id="cb12-149"><a href="#cb12-149"></a><span class="fu">write.csv</span>(aa, <span class="at">file =</span> <span class="st">"data.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb12-150"><a href="#cb12-150"></a>vivienda_edad <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data.csv"</span>)</span>
<span id="cb12-151"><a href="#cb12-151"></a></span>
<span id="cb12-152"><a href="#cb12-152"></a><span class="co">#Los guardamos sin arreglar</span></span>
<span id="cb12-153"><a href="#cb12-153"></a><span class="fu">write.csv</span>(vivienda_edad, <span class="at">file =</span> <span class="st">"./docs/datos/vivienda_datos.csv"</span>)</span>
<span id="cb12-154"><a href="#cb12-154"></a></span>
<span id="cb12-155"><a href="#cb12-155"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb12-156"><a href="#cb12-156"></a></span>
<span id="cb12-157"><a href="#cb12-157"></a><span class="co">#Borramos archivos como las sheets separadas y otros datos</span></span>
<span id="cb12-158"><a href="#cb12-158"></a><span class="fu">file.remove</span>(<span class="st">"2004,2005,2006,2007,2008.csv"</span>, <span class="st">"2009,2010,2011,2012,2013.csv"</span>,</span>
<span id="cb12-159"><a href="#cb12-159"></a>            <span class="st">"2014,2015,2016,2017,2018.csv"</span>, <span class="st">"2019,2020,2021,2022,2023.csv"</span>, </span>
<span id="cb12-160"><a href="#cb12-160"></a>            <span class="st">"compraventa.csv"</span>, <span class="st">"data.csv"</span>, <span class="st">"datos.xls"</span>, <span class="st">"./docs/datos/25171.px"</span>,</span>
<span id="cb12-161"><a href="#cb12-161"></a>            <span class="st">"./docs/datos/34010110.XLS"</span>)</span>
<span id="cb12-162"><a href="#cb12-162"></a></span>
<span id="cb12-163"><a href="#cb12-163"></a><span class="co">#----------------------Procedemos a limpiar los datos---------------------------</span></span>
<span id="cb12-164"><a href="#cb12-164"></a></span>
<span id="cb12-165"><a href="#cb12-165"></a><span class="co">#-------------Creamos una carpeta para guardar los datos pulidos----------------</span></span>
<span id="cb12-166"><a href="#cb12-166"></a></span>
<span id="cb12-167"><a href="#cb12-167"></a><span class="fu">dir_create</span>(<span class="st">"./datos_pulidos"</span>)</span>
<span id="cb12-168"><a href="#cb12-168"></a><span class="fu">library</span>(zoo)</span>
<span id="cb12-169"><a href="#cb12-169"></a></span>
<span id="cb12-170"><a href="#cb12-170"></a><span class="do">###AHORA LIMPIAMOS LOS DATOS PARA TRABAJAR MEJOR CON ELLOS###</span></span>
<span id="cb12-171"><a href="#cb12-171"></a></span>
<span id="cb12-172"><a href="#cb12-172"></a><span class="co">#-------------------Indice de precios de la Vivienda----------------------------</span></span>
<span id="cb12-173"><a href="#cb12-173"></a></span>
<span id="cb12-174"><a href="#cb12-174"></a>cv <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="at">file =</span> <span class="st">"./docs/datos/cv.csv"</span>)</span>
<span id="cb12-175"><a href="#cb12-175"></a></span>
<span id="cb12-176"><a href="#cb12-176"></a><span class="co">#Elimino las columnas duplicadas indicando el nombre de la provincia </span></span>
<span id="cb12-177"><a href="#cb12-177"></a><span class="co">#para dejar solo una columna de provincias</span></span>
<span id="cb12-178"><a href="#cb12-178"></a></span>
<span id="cb12-179"><a href="#cb12-179"></a>cv <span class="ot">&lt;-</span> cv[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb12-180"><a href="#cb12-180"></a><span class="fu">colnames</span>(cv) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb12-181"><a href="#cb12-181"></a>columnas_duplicadas <span class="ot">&lt;-</span> <span class="fu">duplicated</span>(<span class="fu">t</span>(cv))</span>
<span id="cb12-182"><a href="#cb12-182"></a><span class="fu">print</span>(columnas_duplicadas)</span>
<span id="cb12-183"><a href="#cb12-183"></a></span>
<span id="cb12-184"><a href="#cb12-184"></a>cv <span class="ot">&lt;-</span> cv[, <span class="sc">!</span>columnas_duplicadas]</span>
<span id="cb12-185"><a href="#cb12-185"></a><span class="fu">colnames</span>(cv) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"col_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(cv))</span>
<span id="cb12-186"><a href="#cb12-186"></a><span class="co">#Elimino otra columnaa duplicadaa que el argumento no encuenrtra </span></span>
<span id="cb12-187"><a href="#cb12-187"></a></span>
<span id="cb12-188"><a href="#cb12-188"></a>cv <span class="ot">&lt;-</span> cv[, <span class="sc">-</span><span class="dv">62</span>]</span>
<span id="cb12-189"><a href="#cb12-189"></a></span>
<span id="cb12-190"><a href="#cb12-190"></a><span class="co">#Doy nombre a la posición [1,2] de provincias para después poder trabajar mejor</span></span>
<span id="cb12-191"><a href="#cb12-191"></a><span class="co">#Ya que convertiremos la primera fila en colnames</span></span>
<span id="cb12-192"><a href="#cb12-192"></a></span>
<span id="cb12-193"><a href="#cb12-193"></a>cv[<span class="dv">1</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">"Provincia"</span></span>
<span id="cb12-194"><a href="#cb12-194"></a><span class="fu">colnames</span>(cv)</span>
<span id="cb12-195"><a href="#cb12-195"></a></span>
<span id="cb12-196"><a href="#cb12-196"></a><span class="co">#Seleccionamos la primera fila del df y lo convertimos en un vector. Después, </span></span>
<span id="cb12-197"><a href="#cb12-197"></a><span class="co">#Hacemos que los NA se sustituyan por el texto de su izquierda (Remplazamos NA`s</span></span>
<span id="cb12-198"><a href="#cb12-198"></a><span class="co">#por el año al que corresponde esa columnas)</span></span>
<span id="cb12-199"><a href="#cb12-199"></a></span>
<span id="cb12-200"><a href="#cb12-200"></a>df <span class="ot">&lt;-</span> cv <span class="sc">%&gt;%</span></span>
<span id="cb12-201"><a href="#cb12-201"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-202"><a href="#cb12-202"></a>  <span class="fu">unlist</span>()</span>
<span id="cb12-203"><a href="#cb12-203"></a></span>
<span id="cb12-204"><a href="#cb12-204"></a>df <span class="ot">&lt;-</span> <span class="fu">na.locf</span>(df)</span>
<span id="cb12-205"><a href="#cb12-205"></a></span>
<span id="cb12-206"><a href="#cb12-206"></a><span class="co">#Ahora convertimos el vector en la fila 1 que después convrtiremos en colnames</span></span>
<span id="cb12-207"><a href="#cb12-207"></a><span class="co">#para trabajar mejor.</span></span>
<span id="cb12-208"><a href="#cb12-208"></a></span>
<span id="cb12-209"><a href="#cb12-209"></a>cv[<span class="dv">1</span>,] <span class="ot">&lt;-</span> df </span>
<span id="cb12-210"><a href="#cb12-210"></a></span>
<span id="cb12-211"><a href="#cb12-211"></a><span class="co">#Juntamos la fila 1 y 2 a partir de la tercer columna separando el texto con "_" </span></span>
<span id="cb12-212"><a href="#cb12-212"></a><span class="co">#y le rellenamos las dos columnas restantes con los nombres que nos vengan mejor </span></span>
<span id="cb12-213"><a href="#cb12-213"></a><span class="co">#para trabajar</span></span>
<span id="cb12-214"><a href="#cb12-214"></a>aa <span class="ot">&lt;-</span> cv[<span class="dv">1</span>,]</span>
<span id="cb12-215"><a href="#cb12-215"></a>aa <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">""</span>,<span class="st">"Provincia"</span>,<span class="fu">paste</span>(cv[<span class="dv">1</span>,<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(cv)],cv[<span class="dv">2</span>,<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(cv)], <span class="at">sep =</span> <span class="st">"_"</span>))</span>
<span id="cb12-216"><a href="#cb12-216"></a></span>
<span id="cb12-217"><a href="#cb12-217"></a><span class="co">#Convertimos el vector aa en colnames</span></span>
<span id="cb12-218"><a href="#cb12-218"></a></span>
<span id="cb12-219"><a href="#cb12-219"></a><span class="fu">colnames</span>(cv) <span class="ot">=</span> aa</span>
<span id="cb12-220"><a href="#cb12-220"></a></span>
<span id="cb12-221"><a href="#cb12-221"></a><span class="co">#Quitamos la primera y la segunda fila, es información que ya indica colnames</span></span>
<span id="cb12-222"><a href="#cb12-222"></a></span>
<span id="cb12-223"><a href="#cb12-223"></a>cv <span class="ot">&lt;-</span> cv[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="sc">-</span>(<span class="dv">1</span>)]</span>
<span id="cb12-224"><a href="#cb12-224"></a><span class="fu">colnames</span>(cv)</span>
<span id="cb12-225"><a href="#cb12-225"></a></span>
<span id="cb12-226"><a href="#cb12-226"></a><span class="co">#Hacemos que todas las columnas que indican año_trimestre pivoten y dejen los</span></span>
<span id="cb12-227"><a href="#cb12-227"></a><span class="co">#valores que contenían las transacciones por un lado y el año_trimestre por otro</span></span>
<span id="cb12-228"><a href="#cb12-228"></a></span>
<span id="cb12-229"><a href="#cb12-229"></a>Transacciones_por_provincia <span class="ot">&lt;-</span> cv <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"Año"</span>), </span>
<span id="cb12-230"><a href="#cb12-230"></a>                                                   <span class="at">names_to =</span> <span class="st">"Año_Trimestre"</span>, </span>
<span id="cb12-231"><a href="#cb12-231"></a>                                                   <span class="at">names_prefix =</span> <span class="st">"Año"</span>, </span>
<span id="cb12-232"><a href="#cb12-232"></a>                                                   <span class="at">values_to =</span> <span class="st">"Transacciones"</span>,</span>
<span id="cb12-233"><a href="#cb12-233"></a>                                                   <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-234"><a href="#cb12-234"></a></span>
<span id="cb12-235"><a href="#cb12-235"></a><span class="co">#Guardamos en la carpeta(en formato .csv) de datos pulidos y seguimos</span></span>
<span id="cb12-236"><a href="#cb12-236"></a></span>
<span id="cb12-237"><a href="#cb12-237"></a><span class="fu">write.csv</span>(Transacciones_por_provincia, </span>
<span id="cb12-238"><a href="#cb12-238"></a>          <span class="at">file =</span> <span class="st">"datos_pulidos/Transacciones_por_povincia.csv"</span>)</span>
<span id="cb12-239"><a href="#cb12-239"></a></span>
<span id="cb12-240"><a href="#cb12-240"></a><span class="co">#----------------Índice de precios de la vivienda-------------------------------</span></span>
<span id="cb12-241"><a href="#cb12-241"></a></span>
<span id="cb12-242"><a href="#cb12-242"></a></span>
<span id="cb12-243"><a href="#cb12-243"></a>ipv <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="at">file =</span> <span class="st">"./docs/datos/ipv.csv"</span>)</span>
<span id="cb12-244"><a href="#cb12-244"></a></span>
<span id="cb12-245"><a href="#cb12-245"></a><span class="co">#Estos datos están bien, quitamos las dos columnas que no aportan y los guardamos</span></span>
<span id="cb12-246"><a href="#cb12-246"></a>ipv <span class="ot">&lt;-</span> ipv[,<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)]</span>
<span id="cb12-247"><a href="#cb12-247"></a></span>
<span id="cb12-248"><a href="#cb12-248"></a><span class="fu">write.csv</span>(ipv, <span class="at">file =</span> <span class="st">"./datos_pulidos/indice_precio_vivienda.csv"</span>)</span>
<span id="cb12-249"><a href="#cb12-249"></a></span>
<span id="cb12-250"><a href="#cb12-250"></a><span class="co">#rm(list = ls())</span></span>
<span id="cb12-251"><a href="#cb12-251"></a></span>
<span id="cb12-252"><a href="#cb12-252"></a></span>
<span id="cb12-253"><a href="#cb12-253"></a><span class="co">#----------------Renta por edad-------------------------------------------------</span></span>
<span id="cb12-254"><a href="#cb12-254"></a></span>
<span id="cb12-255"><a href="#cb12-255"></a>re <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="at">file  =</span> <span class="st">"./docs/datos/renta_edad.csv"</span>)</span>
<span id="cb12-256"><a href="#cb12-256"></a></span>
<span id="cb12-257"><a href="#cb12-257"></a><span class="co">#Renombramos las columnas, seleccionamos lo que nos interesa y borramos el restante</span></span>
<span id="cb12-258"><a href="#cb12-258"></a><span class="co">#Exportamos</span></span>
<span id="cb12-259"><a href="#cb12-259"></a>re <span class="ot">&lt;-</span> re <span class="sc">%&gt;%</span></span>
<span id="cb12-260"><a href="#cb12-260"></a>  <span class="fu">rename</span>(<span class="at">renta =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-261"><a href="#cb12-261"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(<span class="st">"V1"</span>, <span class="st">"X"</span>))</span>
<span id="cb12-262"><a href="#cb12-262"></a></span>
<span id="cb12-263"><a href="#cb12-263"></a><span class="fu">write.csv</span>(re, <span class="at">file =</span> <span class="st">"./datos_pulidos/renta_por_edad.csv"</span>)</span>
<span id="cb12-264"><a href="#cb12-264"></a></span>
<span id="cb12-265"><a href="#cb12-265"></a></span>
<span id="cb12-266"><a href="#cb12-266"></a></span>
<span id="cb12-267"><a href="#cb12-267"></a></span>
<span id="cb12-268"><a href="#cb12-268"></a><span class="co">#----------------Régimen tenencia de vivienda por edad--------------------------</span></span>
<span id="cb12-269"><a href="#cb12-269"></a></span>
<span id="cb12-270"><a href="#cb12-270"></a>vd <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="at">file  =</span> <span class="st">"./docs/datos/vivienda_datos.csv"</span>)</span>
<span id="cb12-271"><a href="#cb12-271"></a></span>
<span id="cb12-272"><a href="#cb12-272"></a><span class="co">#Renombramos las columnas, seleccionamos lo que nos interesa y borramos el restante</span></span>
<span id="cb12-273"><a href="#cb12-273"></a><span class="co">#Exportamos</span></span>
<span id="cb12-274"><a href="#cb12-274"></a>vd<span class="ot">&lt;-</span> vd <span class="sc">%&gt;%</span></span>
<span id="cb12-275"><a href="#cb12-275"></a>  <span class="fu">rename</span>(<span class="at">Porcentaje =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-276"><a href="#cb12-276"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(<span class="st">"V1"</span>, <span class="st">"X"</span>))</span>
<span id="cb12-277"><a href="#cb12-277"></a></span>
<span id="cb12-278"><a href="#cb12-278"></a><span class="fu">write.csv</span>(vd, <span class="at">file =</span> <span class="st">"./datos_pulidos/tenencia_de_vivienda.csv"</span>)</span>
<span id="cb12-279"><a href="#cb12-279"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb12-280"><a href="#cb12-280"></a></span>
<span id="cb12-281"><a href="#cb12-281"></a><span class="co">#--------------------IMPORTAR DATOS CE / EUROSTAT-------------------------------</span></span>
<span id="cb12-282"><a href="#cb12-282"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>) <span class="co">#- para quitar la notación científica</span></span>
<span id="cb12-283"><a href="#cb12-283"></a></span>
<span id="cb12-284"><a href="#cb12-284"></a><span class="fu">library</span>(eurostat) </span>
<span id="cb12-285"><a href="#cb12-285"></a><span class="fu">library</span>(DT) </span>
<span id="cb12-286"><a href="#cb12-286"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-287"><a href="#cb12-287"></a></span>
<span id="cb12-288"><a href="#cb12-288"></a>info <span class="ot">&lt;-</span> <span class="fu">search_eurostat</span>(<span class="st">"GDP"</span>, <span class="at">type =</span> <span class="st">"all"</span>)</span>
<span id="cb12-289"><a href="#cb12-289"></a>my_table <span class="ot">&lt;-</span><span class="st">"sdg_08_10"</span></span>
<span id="cb12-290"><a href="#cb12-290"></a></span>
<span id="cb12-291"><a href="#cb12-291"></a><span class="co">#Comprobamos que es el PIB pc</span></span>
<span id="cb12-292"><a href="#cb12-292"></a><span class="fu">label_eurostat_tables</span>(my_table)</span>
<span id="cb12-293"><a href="#cb12-293"></a></span>
<span id="cb12-294"><a href="#cb12-294"></a>df_original <span class="ot">&lt;-</span> <span class="fu">get_eurostat</span>(my_table, <span class="at">time_format =</span> <span class="st">'raw'</span>, <span class="at">keepFlags =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-295"><a href="#cb12-295"></a>df_names <span class="ot">&lt;-</span> <span class="fu">names</span>(df_original)</span>
<span id="cb12-296"><a href="#cb12-296"></a>df_original <span class="ot">&lt;-</span> <span class="fu">label_eurostat</span>(df_original, <span class="at">code =</span> df_names, <span class="at">fix_duplicated =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-297"><a href="#cb12-297"></a></span>
<span id="cb12-298"><a href="#cb12-298"></a><span class="co">#Creamos otro df para trabajor con él </span></span>
<span id="cb12-299"><a href="#cb12-299"></a></span>
<span id="cb12-300"><a href="#cb12-300"></a>df <span class="ot">&lt;-</span> df_original</span>
<span id="cb12-301"><a href="#cb12-301"></a></span>
<span id="cb12-302"><a href="#cb12-302"></a><span class="co">#Ver que hay en el df</span></span>
<span id="cb12-303"><a href="#cb12-303"></a>df_aa <span class="ot">&lt;-</span> pjpv.curso.R<span class="fl">.2022</span><span class="sc">::</span><span class="fu">pjp_dicc</span>(df)</span>
<span id="cb12-304"><a href="#cb12-304"></a>df_bb <span class="ot">&lt;-</span> pjpv.curso.R<span class="fl">.2022</span><span class="sc">::</span><span class="fu">pjp_valores_unicos</span>(df, <span class="at">nn =</span> <span class="dv">400</span>)</span>
<span id="cb12-305"><a href="#cb12-305"></a></span>
<span id="cb12-306"><a href="#cb12-306"></a><span class="co">#Vamos a hacer un poco de limpieza</span></span>
<span id="cb12-307"><a href="#cb12-307"></a>obj_buenos <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"df"</span>, <span class="st">"df_original"</span>, <span class="st">"df_bb"</span>)</span>
<span id="cb12-308"><a href="#cb12-308"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">setdiff</span>(<span class="fu">ls</span>(), obj_buenos))</span>
<span id="cb12-309"><a href="#cb12-309"></a></span>
<span id="cb12-310"><a href="#cb12-310"></a><span class="co">#Vamos a seguir arreglando el df</span></span>
<span id="cb12-311"><a href="#cb12-311"></a></span>
<span id="cb12-312"><a href="#cb12-312"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb12-313"><a href="#cb12-313"></a>  <span class="fu">rename</span>(<span class="at">year =</span> time_code) <span class="sc">|&gt;</span> </span>
<span id="cb12-314"><a href="#cb12-314"></a>  <span class="fu">rename</span>(<span class="at">PIB_pc =</span> values) <span class="sc">|&gt;</span> </span>
<span id="cb12-315"><a href="#cb12-315"></a>  <span class="fu">rename</span>(<span class="at">country =</span> geo)</span>
<span id="cb12-316"><a href="#cb12-316"></a></span>
<span id="cb12-317"><a href="#cb12-317"></a><span class="co">#Chain linked volumes (2010), euro per capita</span></span>
<span id="cb12-318"><a href="#cb12-318"></a><span class="co">#Solo queremos el PIB_pc</span></span>
<span id="cb12-319"><a href="#cb12-319"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb12-320"><a href="#cb12-320"></a>  <span class="fu">filter</span>(unit <span class="sc">==</span> <span class="st">"Chain linked volumes (2010), euro per capita"</span>)</span>
<span id="cb12-321"><a href="#cb12-321"></a></span>
<span id="cb12-322"><a href="#cb12-322"></a><span class="co">#Eliminamos todo lo que nos molesta a la vista </span></span>
<span id="cb12-323"><a href="#cb12-323"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb12-324"><a href="#cb12-324"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(unit_code, values_code, unit, time, na_item_code, na_item, flags))</span>
<span id="cb12-325"><a href="#cb12-325"></a></span>
<span id="cb12-326"><a href="#cb12-326"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span>  <span class="fu">mutate</span>(<span class="at">year =</span>  <span class="fu">as.numeric</span>(year))</span>
<span id="cb12-327"><a href="#cb12-327"></a></span>
<span id="cb12-328"><a href="#cb12-328"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span>  <span class="fu">mutate</span>(<span class="at">iso_2_code =</span>  eurostat<span class="sc">::</span><span class="fu">harmonize_country_code</span>(geo_code))</span>
<span id="cb12-329"><a href="#cb12-329"></a></span>
<span id="cb12-330"><a href="#cb12-330"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb12-331"><a href="#cb12-331"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(geo_code, flags_code))</span>
<span id="cb12-332"><a href="#cb12-332"></a></span>
<span id="cb12-333"><a href="#cb12-333"></a></span>
<span id="cb12-334"><a href="#cb12-334"></a><span class="fu">library</span>(fs)</span>
<span id="cb12-335"><a href="#cb12-335"></a><span class="fu">dir_create</span>(<span class="st">"datos_pulidos"</span>)</span>
<span id="cb12-336"><a href="#cb12-336"></a></span>
<span id="cb12-337"><a href="#cb12-337"></a><span class="co">#A continuación vamos a exportar los datos para luego importarlas más fácilmente #library(rio)</span></span>
<span id="cb12-338"><a href="#cb12-338"></a></span>
<span id="cb12-339"><a href="#cb12-339"></a><span class="fu">export</span>(df, <span class="st">"./datos_pulidos/PIB_pc.csv"</span>, <span class="at">type =</span> <span class="st">"csv"</span>)</span>
<span id="cb12-340"><a href="#cb12-340"></a><span class="co">#---------------DATOS SOBRE EL SALARIO POR NIVEL DE FORMACIÓN-------------------</span></span>
<span id="cb12-341"><a href="#cb12-341"></a></span>
<span id="cb12-342"><a href="#cb12-342"></a><span class="fu">library</span>(rio)</span>
<span id="cb12-343"><a href="#cb12-343"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-344"><a href="#cb12-344"></a>url <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/13931.csv?nocab=1"</span></span>
<span id="cb12-345"><a href="#cb12-345"></a>df_ine <span class="ot">&lt;-</span> <span class="fu">import</span>(url)</span>
<span id="cb12-346"><a href="#cb12-346"></a>df_ine_01 <span class="ot">&lt;-</span> df_ine <span class="sc">|&gt;</span> </span>
<span id="cb12-347"><a href="#cb12-347"></a>  <span class="fu">filter</span>(Decil <span class="sc">%in%</span> (<span class="st">"Total decil"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb12-348"><a href="#cb12-348"></a>  <span class="fu">select</span>(<span class="st">"Periodo"</span>, <span class="st">"Tipo de jornada"</span>, <span class="st">"NIVELES DE FORMACION"</span>, <span class="st">"Total"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-349"><a href="#cb12-349"></a>  <span class="fu">rename</span>(<span class="at">year =</span> Periodo) <span class="sc">|&gt;</span> </span>
<span id="cb12-350"><a href="#cb12-350"></a>  <span class="fu">rename</span>(<span class="at">jornada =</span> <span class="st">'Tipo de jornada'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-351"><a href="#cb12-351"></a>  <span class="fu">rename</span>(<span class="at">formacion =</span> <span class="st">'NIVELES DE FORMACION'</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-352"><a href="#cb12-352"></a>  <span class="fu">rename</span>(<span class="at">salario =</span> Total)</span>
<span id="cb12-353"><a href="#cb12-353"></a></span>
<span id="cb12-354"><a href="#cb12-354"></a><span class="co">#VAMOS A CONVERTIR LA VARIABLE salario A NUMERIC</span></span>
<span id="cb12-355"><a href="#cb12-355"></a></span>
<span id="cb12-356"><a href="#cb12-356"></a><span class="co">#R y el INE me han jodiedo la vida para pasar esto a numeric (antes no funcionaba)</span></span>
<span id="cb12-357"><a href="#cb12-357"></a>df_ine_01 <span class="ot">&lt;-</span> df_ine_01 <span class="sc">|&gt;</span> </span>
<span id="cb12-358"><a href="#cb12-358"></a>  <span class="fu">mutate</span>(<span class="at">salario =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">""</span>, salario))))</span>
<span id="cb12-359"><a href="#cb12-359"></a></span>
<span id="cb12-360"><a href="#cb12-360"></a><span class="fu">export</span>(df_ine_01,<span class="st">"./datos_pulidos/salario_formacion.csv"</span>, <span class="at">type =</span> <span class="st">"csv"</span>)</span>
<span id="cb12-361"><a href="#cb12-361"></a></span>
<span id="cb12-362"><a href="#cb12-362"></a></span>
<span id="cb12-363"><a href="#cb12-363"></a><span class="co">#-----------------------DATOS SOBRE EL SALARIO POR EDADES-----------------------</span></span>
<span id="cb12-364"><a href="#cb12-364"></a></span>
<span id="cb12-365"><a href="#cb12-365"></a>url_1 <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/13928.csv?nocab=1"</span></span>
<span id="cb12-366"><a href="#cb12-366"></a>df_ine_x1 <span class="ot">&lt;-</span> <span class="fu">import</span>(url_1)</span>
<span id="cb12-367"><a href="#cb12-367"></a></span>
<span id="cb12-368"><a href="#cb12-368"></a>df_ine_02 <span class="ot">&lt;-</span> df_ine_x1 <span class="sc">|&gt;</span> </span>
<span id="cb12-369"><a href="#cb12-369"></a>  <span class="fu">filter</span>(Decil <span class="sc">%in%</span> (<span class="st">"Total decil"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb12-370"><a href="#cb12-370"></a>  <span class="fu">select</span>(<span class="st">"Periodo"</span>, <span class="st">"Tipo de jornada"</span>, <span class="st">"Grupo de edad"</span>, <span class="st">"Total"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-371"><a href="#cb12-371"></a>  <span class="fu">rename</span>(<span class="at">year =</span> Periodo) <span class="sc">|&gt;</span> </span>
<span id="cb12-372"><a href="#cb12-372"></a>  <span class="fu">rename</span>(<span class="at">jornada =</span> <span class="st">'Tipo de jornada'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-373"><a href="#cb12-373"></a>  <span class="fu">rename</span>(<span class="at">grupo_edad =</span> <span class="st">'Grupo de edad'</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-374"><a href="#cb12-374"></a>  <span class="fu">rename</span>(<span class="at">salario =</span> Total)</span>
<span id="cb12-375"><a href="#cb12-375"></a></span>
<span id="cb12-376"><a href="#cb12-376"></a><span class="co">#PASAMOS A NUMERIC</span></span>
<span id="cb12-377"><a href="#cb12-377"></a>df_ine_02 <span class="ot">&lt;-</span> df_ine_02 <span class="sc">|&gt;</span> </span>
<span id="cb12-378"><a href="#cb12-378"></a>  <span class="fu">mutate</span>(<span class="at">salario =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">""</span>, salario))))</span>
<span id="cb12-379"><a href="#cb12-379"></a></span>
<span id="cb12-380"><a href="#cb12-380"></a><span class="fu">export</span>(df_ine_02,<span class="st">"./datos_pulidos/salario_grupo_edad.csv"</span>, <span class="at">type =</span> <span class="st">"csv"</span>)</span>
<span id="cb12-381"><a href="#cb12-381"></a><span class="co">#------------------------------DATOS SOBRE EL IPC-------------------------------</span></span>
<span id="cb12-382"><a href="#cb12-382"></a></span>
<span id="cb12-383"><a href="#cb12-383"></a>url_2 <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/50908.csv?nocab=1"</span></span>
<span id="cb12-384"><a href="#cb12-384"></a>df_ipc <span class="ot">&lt;-</span> <span class="fu">import</span>(url_2)</span>
<span id="cb12-385"><a href="#cb12-385"></a></span>
<span id="cb12-386"><a href="#cb12-386"></a>df_ipc_01 <span class="ot">&lt;-</span> df_ipc <span class="sc">|&gt;</span> </span>
<span id="cb12-387"><a href="#cb12-387"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Grupos ECOICOP</span><span class="st">`</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Índice general"</span>, <span class="st">"04 Vivienda, agua, electricidad, gas y otros combustibles"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb12-388"><a href="#cb12-388"></a>  <span class="fu">select</span>(<span class="st">"Periodo"</span>, <span class="st">"Grupos ECOICOP"</span>, <span class="st">"Tipo de dato"</span>, <span class="st">"Total"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-389"><a href="#cb12-389"></a>  <span class="fu">rename</span>(<span class="at">year =</span> Periodo) <span class="sc">|&gt;</span></span>
<span id="cb12-390"><a href="#cb12-390"></a>  <span class="fu">rename</span>(<span class="at">grupo =</span> <span class="st">'Grupos ECOICOP'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-391"><a href="#cb12-391"></a>  <span class="fu">rename</span>(<span class="at">tipo_dato =</span> <span class="st">`</span><span class="at">Tipo de dato</span><span class="st">`</span> ) </span>
<span id="cb12-392"><a href="#cb12-392"></a></span>
<span id="cb12-393"><a href="#cb12-393"></a><span class="co">#PASAMOS A NUMERIC</span></span>
<span id="cb12-394"><a href="#cb12-394"></a>df_ipc_01 <span class="ot">&lt;-</span> df_ipc_01 <span class="sc">|&gt;</span> </span>
<span id="cb12-395"><a href="#cb12-395"></a>  <span class="fu">mutate</span>(<span class="at">Total =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">""</span>, Total))))</span>
<span id="cb12-396"><a href="#cb12-396"></a></span>
<span id="cb12-397"><a href="#cb12-397"></a><span class="co">#PARA SEPARAR EN LA VARIABLE YEAR LOS DATOS POR AÑOS Y MESES</span></span>
<span id="cb12-398"><a href="#cb12-398"></a><span class="co">#df_sep &lt;- df_ipc_01 |&gt; </span></span>
<span id="cb12-399"><a href="#cb12-399"></a><span class="co">#  separate(col = year, into = c("year", "month"), sep = "M")</span></span>
<span id="cb12-400"><a href="#cb12-400"></a></span>
<span id="cb12-401"><a href="#cb12-401"></a><span class="co">#df_sep &lt;- df_sep |&gt; </span></span>
<span id="cb12-402"><a href="#cb12-402"></a><span class="co">#  mutate(month = paste0("M", month))</span></span>
<span id="cb12-403"><a href="#cb12-403"></a></span>
<span id="cb12-404"><a href="#cb12-404"></a><span class="fu">export</span>(df_ipc_01, <span class="st">"./datos_pulidos/IPC_mas_vivienda.csv"</span>, <span class="at">type =</span> <span class="st">"csv"</span>)</span>
<span id="cb12-405"><a href="#cb12-405"></a></span>
<span id="cb12-406"><a href="#cb12-406"></a><span class="in">```</span></span>
<span id="cb12-407"><a href="#cb12-407"></a></span>
<span id="cb12-408"><a href="#cb12-408"></a>:::</span>
<span id="cb12-409"><a href="#cb12-409"></a></span>
<span id="cb12-410"><a href="#cb12-410"></a>---</span>
<span id="cb12-411"><a href="#cb12-411"></a></span>
<span id="cb12-412"><a href="#cb12-412"></a><span class="fu"># Evolución de la renta neta por edad</span></span>
<span id="cb12-413"><a href="#cb12-413"></a></span>
<span id="cb12-414"><a href="#cb12-414"></a>Iniciaremos analizando los datos de renta según la edad (como pueden imaginar, los jóvenes constituyen el grupo poblacional que dispone de menos renta), para, a continuación, adentrarnos en datos que muestran la evolución de los precios de la vivienda.</span>
<span id="cb12-415"><a href="#cb12-415"></a></span>
<span id="cb12-416"><a href="#cb12-416"></a>::: {.panel-tabset}</span>
<span id="cb12-417"><a href="#cb12-417"></a></span>
<span id="cb12-418"><a href="#cb12-418"></a><span class="fu"># Gráfico en movimiento</span></span>
<span id="cb12-419"><a href="#cb12-419"></a></span>
<span id="cb12-422"><a href="#cb12-422"></a><span class="in">```{R}</span></span>
<span id="cb12-423"><a href="#cb12-423"></a><span class="co">#Cargamos datos</span></span>
<span id="cb12-424"><a href="#cb12-424"></a><span class="fu">library</span>(rio)</span>
<span id="cb12-425"><a href="#cb12-425"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-426"><a href="#cb12-426"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb12-427"><a href="#cb12-427"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb12-428"><a href="#cb12-428"></a><span class="fu">library</span>(hrbrthemes)</span>
<span id="cb12-429"><a href="#cb12-429"></a></span>
<span id="cb12-430"><a href="#cb12-430"></a><span class="co">#-</span></span>
<span id="cb12-431"><a href="#cb12-431"></a></span>
<span id="cb12-432"><a href="#cb12-432"></a>renta_edad <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos_pulidos/renta_por_edad.csv"</span>)</span>
<span id="cb12-433"><a href="#cb12-433"></a></span>
<span id="cb12-434"><a href="#cb12-434"></a>dff  <span class="ot">&lt;-</span> renta_edad <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">tipo =</span> Renta.anual.neta.media.por.persona.y.por.unidad.de.consumo) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(tipo <span class="sc">==</span> <span class="st">"Renta neta media por persona"</span>, Sexo <span class="sc">==</span> <span class="st">"Ambos sexos"</span>, <span class="sc">!</span>(Edad <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"De 18 a 64 años"</span>, <span class="st">"Menos de 18 años"</span>, <span class="st">"Total"</span>)))</span>
<span id="cb12-435"><a href="#cb12-435"></a></span>
<span id="cb12-436"><a href="#cb12-436"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dff, <span class="fu">aes</span>(<span class="at">x =</span> Periodo, <span class="at">y =</span> renta, <span class="at">color =</span> Edad)) <span class="sc">+</span></span>
<span id="cb12-437"><a href="#cb12-437"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb12-438"><a href="#cb12-438"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Evolución de la renta neta media por edad"</span>, <span class="at">subtitle =</span> <span class="st">"(Euros corrientes)"</span>,</span>
<span id="cb12-439"><a href="#cb12-439"></a>       <span class="at">x =</span> <span class="st">"Año"</span>, <span class="at">y =</span> <span class="st">"Renta neta"</span>) <span class="sc">+</span></span>
<span id="cb12-440"><a href="#cb12-440"></a>  <span class="fu">theme_ipsum</span>() <span class="sc">+</span> </span>
<span id="cb12-441"><a href="#cb12-441"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb12-442"><a href="#cb12-442"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"gray87"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>),</span>
<span id="cb12-443"><a href="#cb12-443"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"aliceblue"</span>),</span>
<span id="cb12-444"><a href="#cb12-444"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-445"><a href="#cb12-445"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"serif"</span>, <span class="at">size =</span> <span class="dv">9</span>, <span class="at">colour =</span> <span class="st">"gray17"</span>)) <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"green4"</span>, <span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb12-446"><a href="#cb12-446"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Edad), <span class="at">nudge_x =</span> <span class="fl">0.5</span>, <span class="at">nudge_y =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb12-447"><a href="#cb12-447"></a></span>
<span id="cb12-448"><a href="#cb12-448"></a>p_animated <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">transition_reveal</span>(Periodo) <span class="sc">+</span></span>
<span id="cb12-449"><a href="#cb12-449"></a>  <span class="fu">enter_fade</span>() <span class="sc">+</span> </span>
<span id="cb12-450"><a href="#cb12-450"></a>  <span class="fu">exit_fade</span>()</span>
<span id="cb12-451"><a href="#cb12-451"></a></span>
<span id="cb12-452"><a href="#cb12-452"></a><span class="fu">animate</span>(p_animated, <span class="at">nframes =</span> <span class="dv">200</span>, <span class="at">fps =</span> <span class="dv">20</span>)</span>
<span id="cb12-453"><a href="#cb12-453"></a></span>
<span id="cb12-454"><a href="#cb12-454"></a><span class="in">```</span></span>
<span id="cb12-455"><a href="#cb12-455"></a></span>
<span id="cb12-456"><a href="#cb12-456"></a><span class="fu"># Gráfico fijo interactivo</span></span>
<span id="cb12-457"><a href="#cb12-457"></a></span>
<span id="cb12-460"><a href="#cb12-460"></a><span class="in">```{R}</span></span>
<span id="cb12-461"><a href="#cb12-461"></a><span class="fu">library</span>(rio)</span>
<span id="cb12-462"><a href="#cb12-462"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-463"><a href="#cb12-463"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb12-464"><a href="#cb12-464"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb12-465"><a href="#cb12-465"></a><span class="fu">library</span>(hrbrthemes)</span>
<span id="cb12-466"><a href="#cb12-466"></a></span>
<span id="cb12-467"><a href="#cb12-467"></a>renta_edad <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos_pulidos/renta_por_edad.csv"</span>)</span>
<span id="cb12-468"><a href="#cb12-468"></a></span>
<span id="cb12-469"><a href="#cb12-469"></a>dff  <span class="ot">&lt;-</span> renta_edad <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">tipo =</span> Renta.anual.neta.media.por.persona.y.por.unidad.de.consumo) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(tipo <span class="sc">==</span> <span class="st">"Renta neta media por persona"</span>, Sexo <span class="sc">==</span> <span class="st">"Ambos sexos"</span>, <span class="sc">!</span>(Edad <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"De 18 a 64 años"</span>, <span class="st">"Menos de 18 años"</span>, <span class="st">"Total"</span>)))</span>
<span id="cb12-470"><a href="#cb12-470"></a></span>
<span id="cb12-471"><a href="#cb12-471"></a>p6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dff) <span class="sc">+</span></span>
<span id="cb12-472"><a href="#cb12-472"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Periodo, <span class="at">y =</span> renta, <span class="at">color =</span> Edad, <span class="at">group =</span> Edad)) <span class="sc">+</span><span class="fu">labs</span> (<span class="at">title =</span> <span class="st">"Evolución de la renta neta media por edad"</span>, <span class="at">subtitle =</span> <span class="st">"(En euros corrientes)"</span>, <span class="at">y =</span> <span class="st">"Renta"</span>, <span class="at">x =</span> <span class="st">"Año"</span>) <span class="sc">+</span> <span class="fu">theme_ipsum</span>()</span>
<span id="cb12-473"><a href="#cb12-473"></a></span>
<span id="cb12-474"><a href="#cb12-474"></a>plotly<span class="sc">::</span><span class="fu">ggplotly</span>(p6)</span>
<span id="cb12-475"><a href="#cb12-475"></a><span class="in">```</span></span>
<span id="cb12-476"><a href="#cb12-476"></a></span>
<span id="cb12-477"><a href="#cb12-477"></a>:::</span>
<span id="cb12-478"><a href="#cb12-478"></a></span>
<span id="cb12-479"><a href="#cb12-479"></a>Tenemos este primer gráfico dinámico, que básicamente lo hemos hecho para demostrar que lo podemos hacer. Sabemos que no es especialmente útil, pero sí vistoso, por eso hemos hecho esta presión interactiva pero estática del mismo gráfico</span>
<span id="cb12-480"><a href="#cb12-480"></a></span>
<span id="cb12-481"><a href="#cb12-481"></a>En este gráfico, cuyos datos están extraídos del INE podemos observar, como ya anticipábamos, que los jóvenes (16-29 años de edad) son el rango de edad que dispone de menos renta. Más notorio es, claro está, con los menores de 16 años. Los jóvenes de 16 a 29 años contaban con una renta media neta o disponible (después de impuestos) de 11.660€.</span>
<span id="cb12-482"><a href="#cb12-482"></a></span>
<span id="cb12-483"><a href="#cb12-483"></a><span class="ss">- </span>La diferencia con el grupo de 30 a 44 años ha pasado de un 6’38% en 2008 a 10’13% en 2022. Un incremento de un 58’78%.</span>
<span id="cb12-484"><a href="#cb12-484"></a></span>
<span id="cb12-485"><a href="#cb12-485"></a><span class="ss">- </span>Con el grupo de 45 a 64 años del 16’86% mencionado arriba a un 18’03%. Un incremento de un 6’94%.</span>
<span id="cb12-486"><a href="#cb12-486"></a></span>
<span id="cb12-487"><a href="#cb12-487"></a><span class="ss">- </span>La mayor divergencia se da con el grupo de los mayores de 65 años. De una diferencia del 6’03% en 2008 a una del 21% en 2022. Un espectacular incremento del 248’23%.</span>
<span id="cb12-488"><a href="#cb12-488"></a></span>
<span id="cb12-489"><a href="#cb12-489"></a>Por tanto, la renta de lo jóvenes de entre 16 y 29 años es la que menos ha crecido: tan solo un 12’97% en 14 años.</span>
<span id="cb12-490"><a href="#cb12-490"></a></span>
<span id="cb12-491"><a href="#cb12-491"></a>Como podemos observar, no sólo es que los jóvenes tengan una renta disponible menor, si no que cada vez se queda más atrás respecto al resto. Los jóvenes, en términos de renta, son cada vez relativamente más tarde.</span>
<span id="cb12-492"><a href="#cb12-492"></a></span>
<span id="cb12-493"><a href="#cb12-493"></a>---</span>
<span id="cb12-494"><a href="#cb12-494"></a></span>
<span id="cb12-495"><a href="#cb12-495"></a><span class="fu"># Índice del nivel de Precios de la vivienda a nivel nacional</span></span>
<span id="cb12-496"><a href="#cb12-496"></a></span>
<span id="cb12-497"><a href="#cb12-497"></a>Ahora vamos a analizar cómo se han comportado los precios de la vivienda en general. Primero lo vamos a hacer observando el comportamiento de los precios de forma general a nivel nacional. Luego veremos cómo se ha comportado en términos de tasas de variación, y más tarde, el nivel de precios por comunidades autónomas y en diferentes momentos del tiempo.</span>
<span id="cb12-498"><a href="#cb12-498"></a></span>
<span id="cb12-501"><a href="#cb12-501"></a><span class="in">```{R}</span></span>
<span id="cb12-502"><a href="#cb12-502"></a><span class="fu">library</span>(readxl)</span>
<span id="cb12-503"><a href="#cb12-503"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-504"><a href="#cb12-504"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb12-505"><a href="#cb12-505"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb12-506"><a href="#cb12-506"></a><span class="fu">library</span>(ggExtra)</span>
<span id="cb12-507"><a href="#cb12-507"></a><span class="fu">library</span>(pxR)</span>
<span id="cb12-508"><a href="#cb12-508"></a></span>
<span id="cb12-509"><a href="#cb12-509"></a>url <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/px/25171.px?nocab=1"</span></span>
<span id="cb12-510"><a href="#cb12-510"></a>aa <span class="ot">&lt;-</span> <span class="fu">read.px</span>(url)</span>
<span id="cb12-511"><a href="#cb12-511"></a><span class="fu">write.csv</span>(aa, <span class="at">file =</span> <span class="st">"./datos_pulidos/data.csv"</span>)</span>
<span id="cb12-512"><a href="#cb12-512"></a></span>
<span id="cb12-513"><a href="#cb12-513"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos_pulidos/data.csv"</span>)</span>
<span id="cb12-514"><a href="#cb12-514"></a></span>
<span id="cb12-515"><a href="#cb12-515"></a>df1 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(á<span class="at">mbito =</span> Comunidades.y.Ciudades.Autónomas, <span class="at">tipo =</span> General..vivienda.nueva.y.de.segunda.mano, <span class="at">Valor =</span> value) <span class="sc">%&gt;%</span> <span class="fu">filter</span> (tipo <span class="sc">==</span> <span class="st">"General"</span>, Índices.y.tasas <span class="sc">==</span> <span class="st">"Índice"</span>, ámbito <span class="sc">==</span> <span class="st">"Nacional"</span>)</span>
<span id="cb12-516"><a href="#cb12-516"></a></span>
<span id="cb12-517"><a href="#cb12-517"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df1, <span class="fu">aes</span>(<span class="at">x =</span> Periodo, <span class="at">y =</span> Valor)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Índice nivel de precios de la vivienda a nivel nacional"</span>, <span class="at">subtitle =</span> <span class="st">"Base 100 = 2015"</span>, <span class="at">y =</span> <span class="st">"Valor"</span>, <span class="at">x =</span> <span class="st">"Periodo"</span>,) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">theme_light</span>() <span class="sc">+</span> <span class="fu">rotateTextX</span>()</span>
<span id="cb12-518"><a href="#cb12-518"></a></span>
<span id="cb12-519"><a href="#cb12-519"></a>p1</span>
<span id="cb12-520"><a href="#cb12-520"></a></span>
<span id="cb12-521"><a href="#cb12-521"></a><span class="in">```</span></span>
<span id="cb12-522"><a href="#cb12-522"></a></span>
<span id="cb12-523"><a href="#cb12-523"></a>En este gráfico podemos observar cómo el nivel de precios general en españa tiene una forma de “uve”. Los precios caen de forma abrupta desde 2008 hasta 2013 (donde encontramos los valores más bajos) y luego vuelven a crecer más lentamente. Actualmente (2023T3) nos encontramos en niveles de precios similares a los de la burbuja, lo cual es negativo, pues ya era muy difícil acceder a la vivienda en la burbuja (sin endeudarse masivamente). Ahora, con el poco crecimiento de la renta con estos niveles de precios, también lo es. </span>
<span id="cb12-524"><a href="#cb12-524"></a></span>
<span id="cb12-525"><a href="#cb12-525"></a>---</span>
<span id="cb12-526"><a href="#cb12-526"></a></span>
<span id="cb12-527"><a href="#cb12-527"></a><span class="fu"># Variación del Indice de Precios de la Vivienda</span></span>
<span id="cb12-528"><a href="#cb12-528"></a></span>
<span id="cb12-531"><a href="#cb12-531"></a><span class="in">```{r}</span></span>
<span id="cb12-532"><a href="#cb12-532"></a>df_IPV <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"./datos_pulidos/indice_precio_vivienda.csv"</span>)</span>
<span id="cb12-533"><a href="#cb12-533"></a></span>
<span id="cb12-534"><a href="#cb12-534"></a>df <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"./datos_pulidos/tenencia_de_vivienda.csv"</span>)</span>
<span id="cb12-535"><a href="#cb12-535"></a></span>
<span id="cb12-536"><a href="#cb12-536"></a>df_IPV_01 <span class="ot">&lt;-</span> df_IPV <span class="sc">|&gt;</span></span>
<span id="cb12-537"><a href="#cb12-537"></a>  <span class="fu">filter</span>(Índices.y.tasas <span class="sc">==</span> <span class="st">"Variación anual"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-538"><a href="#cb12-538"></a>  <span class="fu">filter</span>(Comunidades.y.Ciudades.Autónomas <span class="sc">==</span> <span class="st">"Nacional"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-539"><a href="#cb12-539"></a>  <span class="fu">filter</span>(General..vivienda.nueva.y.de.segunda.mano <span class="sc">==</span> <span class="st">"General"</span>)</span>
<span id="cb12-540"><a href="#cb12-540"></a></span>
<span id="cb12-541"><a href="#cb12-541"></a>df_media_anual <span class="ot">&lt;-</span> df_IPV_01 <span class="sc">|&gt;</span> </span>
<span id="cb12-542"><a href="#cb12-542"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">substr</span>(Periodo, <span class="dv">1</span>, <span class="dv">4</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb12-543"><a href="#cb12-543"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span> </span>
<span id="cb12-544"><a href="#cb12-544"></a>  <span class="fu">summarise</span>(<span class="at">media_salario =</span> <span class="fu">mean</span>(value))</span>
<span id="cb12-545"><a href="#cb12-545"></a></span>
<span id="cb12-546"><a href="#cb12-546"></a><span class="fu">ggplot</span>(df_media_anual, <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>media_salario)) <span class="sc">+</span></span>
<span id="cb12-547"><a href="#cb12-547"></a>  <span class="fu">geom_segment</span>( <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">xend=</span> year, <span class="at">y=</span><span class="dv">0</span>, <span class="at">yend=</span>media_salario), <span class="at">color=</span><span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb12-548"><a href="#cb12-548"></a>  <span class="fu">geom_point</span>( <span class="at">color=</span><span class="st">"orange"</span>, <span class="at">size=</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb12-549"><a href="#cb12-549"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb12-550"><a href="#cb12-550"></a>  <span class="fu">theme</span>(</span>
<span id="cb12-551"><a href="#cb12-551"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-552"><a href="#cb12-552"></a>    <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-553"><a href="#cb12-553"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb12-554"><a href="#cb12-554"></a>  ) <span class="sc">+</span></span>
<span id="cb12-555"><a href="#cb12-555"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb12-556"><a href="#cb12-556"></a>  <span class="fu">ylab</span>(<span class="st">"Índice del Precio de la Vivienda"</span>)</span>
<span id="cb12-557"><a href="#cb12-557"></a><span class="in">```</span></span>
<span id="cb12-558"><a href="#cb12-558"></a></span>
<span id="cb12-559"><a href="#cb12-559"></a>En este gráfico podemos observar las tasas de variación, de los niveles de precios por año. En este caso los datos son anuales. Sencillamente hemos sacado la media de los 4 trimestres para cada año. Aquí se puede ver claramente en qué años las tasas de variación fueron más negativas tras la explosión de la burbuja. Al contrario de lo que se suele pensar, las tasas más negativas fueron 2011, 2012 y 2013, no 2008. A partir de ahí se encadenan tasas positivas durante 10 años. Eso explica los altos niveles actuales.</span>
<span id="cb12-560"><a href="#cb12-560"></a></span>
<span id="cb12-561"><a href="#cb12-561"></a>---</span>
<span id="cb12-562"><a href="#cb12-562"></a></span>
<span id="cb12-563"><a href="#cb12-563"></a><span class="fu"># Mapa de coropletas: Vivienda por CCAA</span></span>
<span id="cb12-564"><a href="#cb12-564"></a></span>
<span id="cb12-565"><a href="#cb12-565"></a>A continuación comprobamos cómo ha evolucionado el precio de la vivienda por toda la geografía Española durante los últimos años. Para ello vamos a analizar los siguientes mapas de coropletas en los que, utilizamos un número índice con base 100 en 2015. </span>
<span id="cb12-566"><a href="#cb12-566"></a></span>
<span id="cb12-569"><a href="#cb12-569"></a><span class="in">```{R}</span></span>
<span id="cb12-570"><a href="#cb12-570"></a><span class="co">#Cargamos librerías</span></span>
<span id="cb12-571"><a href="#cb12-571"></a></span>
<span id="cb12-572"><a href="#cb12-572"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-573"><a href="#cb12-573"></a><span class="fu">library</span>(rio)</span>
<span id="cb12-574"><a href="#cb12-574"></a><span class="fu">library</span>(mapSpain)</span>
<span id="cb12-575"><a href="#cb12-575"></a><span class="fu">library</span>(pxR)</span>
<span id="cb12-576"><a href="#cb12-576"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb12-577"><a href="#cb12-577"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb12-578"><a href="#cb12-578"></a><span class="fu">library</span>(ggExtra) </span>
<span id="cb12-579"><a href="#cb12-579"></a><span class="fu">library</span>(data.table)</span>
<span id="cb12-580"><a href="#cb12-580"></a><span class="fu">library</span>(fs)</span>
<span id="cb12-581"><a href="#cb12-581"></a><span class="fu">library</span>(sf)</span>
<span id="cb12-582"><a href="#cb12-582"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb12-583"><a href="#cb12-583"></a><span class="fu">library</span>(plotly)</span>
<span id="cb12-584"><a href="#cb12-584"></a></span>
<span id="cb12-585"><a href="#cb12-585"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"r-lib/conflicted"</span>)</span>
<span id="cb12-586"><a href="#cb12-586"></a></span>
<span id="cb12-587"><a href="#cb12-587"></a><span class="co">#Empezamos creado el dataframe</span></span>
<span id="cb12-588"><a href="#cb12-588"></a></span>
<span id="cb12-589"><a href="#cb12-589"></a>url <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/px/25171.px?nocab=1"</span></span>
<span id="cb12-590"><a href="#cb12-590"></a>aa <span class="ot">&lt;-</span> <span class="fu">read.px</span>(url)</span>
<span id="cb12-591"><a href="#cb12-591"></a><span class="fu">write.csv</span>(aa, <span class="at">file =</span> <span class="st">"./datos_pulidos/data.csv"</span>)</span>
<span id="cb12-592"><a href="#cb12-592"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos_pulidos/data.csv"</span>)</span>
<span id="cb12-593"><a href="#cb12-593"></a></span>
<span id="cb12-594"><a href="#cb12-594"></a><span class="co">#Empezamos con el manejo de datos/ limpieza</span></span>
<span id="cb12-595"><a href="#cb12-595"></a>df1 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(á<span class="at">mbito =</span> Comunidades.y.Ciudades.Autónomas, <span class="at">tipo =</span> General..vivienda.nueva.y.de.segunda.mano, <span class="at">Valor =</span> value) <span class="sc">%&gt;%</span> <span class="fu">filter</span> (tipo <span class="sc">==</span> <span class="st">"General"</span>, Índices.y.tasas <span class="sc">==</span> <span class="st">"Índice"</span>, ámbito <span class="sc">==</span> <span class="st">"Nacional"</span>)</span>
<span id="cb12-596"><a href="#cb12-596"></a></span>
<span id="cb12-597"><a href="#cb12-597"></a>df1<span class="fl">.1</span>  <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Territorio =</span> Comunidades.y.Ciudades.Autónomas, <span class="at">tipo =</span> General..vivienda.nueva.y.de.segunda.mano, <span class="at">Valor =</span> value) </span>
<span id="cb12-598"><a href="#cb12-598"></a></span>
<span id="cb12-599"><a href="#cb12-599"></a>df1<span class="fl">.2</span> <span class="ot">&lt;-</span> df1<span class="fl">.1</span> <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Territorio =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-600"><a href="#cb12-600"></a>  Territorio <span class="sc">==</span> <span class="st">"01 Andalucía"</span> <span class="sc">~</span> <span class="st">"Andalucía"</span>,</span>
<span id="cb12-601"><a href="#cb12-601"></a>  Territorio <span class="sc">==</span> <span class="st">"02 Aragón"</span> <span class="sc">~</span> <span class="st">"Aragón"</span>,</span>
<span id="cb12-602"><a href="#cb12-602"></a>  Territorio <span class="sc">==</span> <span class="st">"03 Asturias, Principado de"</span> <span class="sc">~</span> <span class="st">"Asturias, Principado de"</span>,</span>
<span id="cb12-603"><a href="#cb12-603"></a>  Territorio <span class="sc">==</span> <span class="st">"04 Balears, Illes"</span> <span class="sc">~</span> <span class="st">"Balears, Illes"</span>,</span>
<span id="cb12-604"><a href="#cb12-604"></a>  Territorio <span class="sc">==</span> <span class="st">"05 Canarias"</span> <span class="sc">~</span> <span class="st">"Canarias"</span>,</span>
<span id="cb12-605"><a href="#cb12-605"></a>  Territorio <span class="sc">==</span> <span class="st">"06 Cantabria"</span> <span class="sc">~</span> <span class="st">"Cantabria"</span>,</span>
<span id="cb12-606"><a href="#cb12-606"></a>  Territorio <span class="sc">==</span> <span class="st">"07 Castilla y León"</span> <span class="sc">~</span> <span class="st">"Castilla y León"</span>,</span>
<span id="cb12-607"><a href="#cb12-607"></a>  Territorio <span class="sc">==</span> <span class="st">"08 Castilla - La Mancha"</span> <span class="sc">~</span> <span class="st">"Castilla-La Mancha"</span>,</span>
<span id="cb12-608"><a href="#cb12-608"></a>  Territorio <span class="sc">==</span> <span class="st">"09 Cataluña"</span> <span class="sc">~</span> <span class="st">"Cataluña"</span>,</span>
<span id="cb12-609"><a href="#cb12-609"></a>  Territorio <span class="sc">==</span> <span class="st">"10 Comunitat Valenciana"</span> <span class="sc">~</span> <span class="st">"Comunitat Valenciana"</span>,</span>
<span id="cb12-610"><a href="#cb12-610"></a>  Territorio <span class="sc">==</span> <span class="st">"11 Extremadura"</span> <span class="sc">~</span> <span class="st">"Extremadura"</span>,</span>
<span id="cb12-611"><a href="#cb12-611"></a>  Territorio <span class="sc">==</span> <span class="st">"12 Galicia"</span> <span class="sc">~</span> <span class="st">"Galicia"</span>,</span>
<span id="cb12-612"><a href="#cb12-612"></a>  Territorio <span class="sc">==</span> <span class="st">"13 Madrid, Comunidad de"</span> <span class="sc">~</span> <span class="st">"Madrid, Comunidad de"</span>,</span>
<span id="cb12-613"><a href="#cb12-613"></a>  Territorio <span class="sc">==</span> <span class="st">"14 Murcia, Región de"</span> <span class="sc">~</span> <span class="st">"Murcia, Región de"</span>,</span>
<span id="cb12-614"><a href="#cb12-614"></a>  Territorio <span class="sc">==</span> <span class="st">"15 Navarra, Comunidad Foral de"</span> <span class="sc">~</span> <span class="st">"Navarra, Comunidad Foral de"</span>,</span>
<span id="cb12-615"><a href="#cb12-615"></a>  Territorio <span class="sc">==</span> <span class="st">"16 País Vasco"</span> <span class="sc">~</span> <span class="st">"País Vasco"</span>,</span>
<span id="cb12-616"><a href="#cb12-616"></a>  Territorio <span class="sc">==</span> <span class="st">"17 Rioja, La"</span> <span class="sc">~</span> <span class="st">"Rioja, La"</span>,</span>
<span id="cb12-617"><a href="#cb12-617"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> Territorio))</span>
<span id="cb12-618"><a href="#cb12-618"></a></span>
<span id="cb12-619"><a href="#cb12-619"></a>df3 <span class="ot">&lt;-</span> df1<span class="fl">.2</span> <span class="sc">%&gt;%</span> <span class="fu">filter</span> (tipo <span class="sc">==</span> <span class="st">"General"</span>, Índices.y.tasas <span class="sc">==</span> <span class="st">"Índice"</span>, <span class="sc">!</span>(Territorio <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Nacional"</span>, <span class="st">"18 Ceuta"</span>, <span class="st">"19 Melilla"</span>)))</span>
<span id="cb12-620"><a href="#cb12-620"></a></span>
<span id="cb12-621"><a href="#cb12-621"></a>prov <span class="ot">&lt;-</span> pjpv.curso.R<span class="fl">.2022</span><span class="sc">::</span>LAU2_prov_2020_canarias</span>
<span id="cb12-622"><a href="#cb12-622"></a></span>
<span id="cb12-623"><a href="#cb12-623"></a>ccaa <span class="ot">&lt;-</span> prov <span class="sc">%&gt;%</span> </span>
<span id="cb12-624"><a href="#cb12-624"></a>  <span class="fu">group_by</span>(ine_ccaa, ine_ccaa.n, ine_ccaa.n.pjp) <span class="sc">%&gt;%</span> </span>
<span id="cb12-625"><a href="#cb12-625"></a>  <span class="fu">summarise</span>() <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb12-626"><a href="#cb12-626"></a></span>
<span id="cb12-627"><a href="#cb12-627"></a>ccaa <span class="ot">&lt;-</span> ccaa <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Territorio =</span> ine_ccaa.n)</span>
<span id="cb12-628"><a href="#cb12-628"></a></span>
<span id="cb12-629"><a href="#cb12-629"></a>df4 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Periodo <span class="sc">==</span> <span class="st">"2023T3"</span>)</span>
<span id="cb12-630"><a href="#cb12-630"></a></span>
<span id="cb12-631"><a href="#cb12-631"></a>df5 <span class="ot">&lt;-</span> <span class="fu">full_join</span>(ccaa, df4, <span class="at">by =</span> <span class="st">"Territorio"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>( <span class="sc">!</span>(Territorio <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ceuta"</span>, <span class="st">"Melilla"</span>)))</span>
<span id="cb12-632"><a href="#cb12-632"></a></span>
<span id="cb12-633"><a href="#cb12-633"></a>df6 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span> </span>
<span id="cb12-634"><a href="#cb12-634"></a>  <span class="fu">filter</span>(Periodo <span class="sc">==</span> <span class="st">"2018T3"</span>)</span>
<span id="cb12-635"><a href="#cb12-635"></a></span>
<span id="cb12-636"><a href="#cb12-636"></a>df7 <span class="ot">&lt;-</span> <span class="fu">full_join</span>(ccaa, df6, <span class="at">by =</span> <span class="st">"Territorio"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>( <span class="sc">!</span>(Territorio <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ceuta"</span>, <span class="st">"Melilla"</span>)))</span>
<span id="cb12-637"><a href="#cb12-637"></a></span>
<span id="cb12-638"><a href="#cb12-638"></a>df8 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Periodo <span class="sc">==</span> <span class="st">"2015T3"</span>)</span>
<span id="cb12-639"><a href="#cb12-639"></a></span>
<span id="cb12-640"><a href="#cb12-640"></a>df9 <span class="ot">&lt;-</span> <span class="fu">full_join</span>(ccaa, df8, <span class="at">by =</span> <span class="st">"Territorio"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>( <span class="sc">!</span>(Territorio <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ceuta"</span>, <span class="st">"Melilla"</span>)))</span>
<span id="cb12-641"><a href="#cb12-641"></a></span>
<span id="cb12-642"><a href="#cb12-642"></a>df10 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Periodo <span class="sc">==</span> <span class="st">"2011T3"</span>)</span>
<span id="cb12-643"><a href="#cb12-643"></a></span>
<span id="cb12-644"><a href="#cb12-644"></a>df11 <span class="ot">&lt;-</span> <span class="fu">full_join</span>(ccaa, df10, <span class="at">by =</span> <span class="st">"Territorio"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>( <span class="sc">!</span>(Territorio <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ceuta"</span>, <span class="st">"Melilla"</span>)))</span>
<span id="cb12-645"><a href="#cb12-645"></a></span>
<span id="cb12-646"><a href="#cb12-646"></a><span class="co">#Empezamos a dibujar mapas</span></span>
<span id="cb12-647"><a href="#cb12-647"></a></span>
<span id="cb12-648"><a href="#cb12-648"></a>escala_limites <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">170</span>)</span>
<span id="cb12-649"><a href="#cb12-649"></a></span>
<span id="cb12-650"><a href="#cb12-650"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df5, <span class="fu">aes</span>(<span class="at">fill =</span> Valor)) <span class="sc">+</span> </span>
<span id="cb12-651"><a href="#cb12-651"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb12-652"><a href="#cb12-652"></a>  <span class="fu">geom_sf_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">as.character</span>(Valor)), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb12-653"><a href="#cb12-653"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">guide =</span> <span class="st">"legend"</span>,<span class="at">limits =</span> escala_limites) <span class="sc">+</span></span>
<span id="cb12-654"><a href="#cb12-654"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Nivel de precios de la vivienda 2023"</span>) <span class="sc">+</span> </span>
<span id="cb12-655"><a href="#cb12-655"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb12-656"><a href="#cb12-656"></a></span>
<span id="cb12-657"><a href="#cb12-657"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df7, <span class="fu">aes</span>(<span class="at">fill =</span> Valor)) <span class="sc">+</span> </span>
<span id="cb12-658"><a href="#cb12-658"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb12-659"><a href="#cb12-659"></a>  <span class="fu">geom_sf_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">as.character</span>(Valor)), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb12-660"><a href="#cb12-660"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">guide =</span> <span class="st">"legend"</span>, <span class="at">limits =</span> escala_limites) <span class="sc">+</span></span>
<span id="cb12-661"><a href="#cb12-661"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Nivel de precios de la vivienda 2018"</span>) <span class="sc">+</span> </span>
<span id="cb12-662"><a href="#cb12-662"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb12-663"><a href="#cb12-663"></a></span>
<span id="cb12-664"><a href="#cb12-664"></a>p6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df9, <span class="fu">aes</span>(<span class="at">fill =</span> Valor)) <span class="sc">+</span> </span>
<span id="cb12-665"><a href="#cb12-665"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb12-666"><a href="#cb12-666"></a>  <span class="fu">geom_sf_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">as.character</span>(Valor)), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb12-667"><a href="#cb12-667"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">guide =</span> <span class="st">"legend"</span>,<span class="at">limits =</span> escala_limites) <span class="sc">+</span></span>
<span id="cb12-668"><a href="#cb12-668"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Nivel de precios de la vivienda 2015"</span>) <span class="sc">+</span> </span>
<span id="cb12-669"><a href="#cb12-669"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb12-670"><a href="#cb12-670"></a></span>
<span id="cb12-671"><a href="#cb12-671"></a>p7 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df11, <span class="fu">aes</span>(<span class="at">fill =</span> Valor)) <span class="sc">+</span> </span>
<span id="cb12-672"><a href="#cb12-672"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb12-673"><a href="#cb12-673"></a>  <span class="fu">geom_sf_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">as.character</span>(Valor)), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb12-674"><a href="#cb12-674"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">guide =</span> <span class="st">"legend"</span>,<span class="at">limits =</span> escala_limites) <span class="sc">+</span></span>
<span id="cb12-675"><a href="#cb12-675"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Nivel de precios de la vivienda 2011"</span>) <span class="sc">+</span> </span>
<span id="cb12-676"><a href="#cb12-676"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb12-677"><a href="#cb12-677"></a></span>
<span id="cb12-678"><a href="#cb12-678"></a><span class="co">#Combinar todos los gráficos</span></span>
<span id="cb12-679"><a href="#cb12-679"></a></span>
<span id="cb12-680"><a href="#cb12-680"></a>p9 <span class="ot">&lt;-</span>p7 <span class="sc">+</span> p6 <span class="sc">+</span>p5 <span class="sc">+</span>p4</span>
<span id="cb12-681"><a href="#cb12-681"></a></span>
<span id="cb12-682"><a href="#cb12-682"></a>p9</span>
<span id="cb12-683"><a href="#cb12-683"></a></span>
<span id="cb12-684"><a href="#cb12-684"></a><span class="in">```</span></span>
<span id="cb12-685"><a href="#cb12-685"></a></span>
<span id="cb12-686"><a href="#cb12-686"></a>Estos mapas de coropletas reflejan los niveles de precios de la vivienda en 6 momentos diferentes del tiempo. El primero es del tercer trimestre del año 2007. En ese momento los precios, como podemos observar, son los más altos. Este es el punto más elevado de la burbuja. Los años siguientes reflejan el pinchazo de la burbuja, con un descenso continuado de los precios hasta 2013. Que es el punto más bajo. Hemos decidido poner el año 2015 por ser el año de la base 100. A partir de ahí, vemos cómo en los años posteriores los precios son ya más elevados que en 2015, y particularmente en 2023, ligeramente por debajo, pero sin haber una burbuja. O, al menos, no parece haberla. </span>
<span id="cb12-687"><a href="#cb12-687"></a></span>
<span id="cb12-688"><a href="#cb12-688"></a>Al ser mapas de coropletas podemos sacar conclusiones acerca de en qué comunidades han aumentado más los precios y por tanto, dónde es más difícil acceder a la vivienda, ceteris paribus. En el último gráfico destacan claramente la Comunidad de Madrid, Cataluña y Baleares. Esto no nos sorprende, tanto la Comunidad de Madrid, como Cataluña son regiones muy dinámicas donde, además, se encuentran las principales ciudades de España. Baleares, por su parte, es una de las regiones más turísticas, donde la oferta de inmuebles tampoco es demasiado elevada. Destacan también en segunda fila País Vasco (región muy dinámica), Andalucía y Canarias (regiones muy turísticas).</span>
<span id="cb12-689"><a href="#cb12-689"></a></span>
<span id="cb12-690"><a href="#cb12-690"></a>Tal vez os habéis fijado en que estos mapas no concuerdan exactamente con lo que hemos visto hace dos gráficos (se veía que el nivel general de precios de la vivienda es ahora igual al del punto más alto de la burbuja y, sin embargo, en los mapas parece que en 2007T3 los precios son mucho más elevados que en la actualidad).</span>
<span id="cb12-691"><a href="#cb12-691"></a></span>
<span id="cb12-692"><a href="#cb12-692"></a>Esto se debe a que hay más viviendas allá donde más está subiendo el precio como se observa en el gráfico (que hay que insertar). La explicación de la afirmación anterior que parece a priori contradictoria, es que aunque hay más vivienda en esta zona (oferta elevada), la demanda es todavía más elevada que la oferta.</span>
<span id="cb12-693"><a href="#cb12-693"></a></span>
<span id="cb12-694"><a href="#cb12-694"></a>Este continuo encarecimiento de las viviendas se traduce en que los jóvenes cambian su régimen de tenencia de vivienda:P$OE</span>
<span id="cb12-695"><a href="#cb12-695"></a></span>
<span id="cb12-696"><a href="#cb12-696"></a>---</span>
<span id="cb12-697"><a href="#cb12-697"></a> </span>
<span id="cb12-698"><a href="#cb12-698"></a><span class="fu"># Régimen de viviendas de 16 a 29 años</span></span>
<span id="cb12-699"><a href="#cb12-699"></a></span>
<span id="cb12-702"><a href="#cb12-702"></a><span class="in">```{R}</span></span>
<span id="cb12-703"><a href="#cb12-703"></a><span class="co">#Hogares por regimen de tenencia edad</span></span>
<span id="cb12-704"><a href="#cb12-704"></a><span class="co">#Cargamos liberías</span></span>
<span id="cb12-705"><a href="#cb12-705"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb12-706"><a href="#cb12-706"></a><span class="fu">library</span>(hrbrthemes)</span>
<span id="cb12-707"><a href="#cb12-707"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-708"><a href="#cb12-708"></a><span class="fu">library</span>(pxR)</span>
<span id="cb12-709"><a href="#cb12-709"></a></span>
<span id="cb12-710"><a href="#cb12-710"></a>url4 <span class="ot">&lt;-</span> <span class="st">"https://www.ine.es/jaxiT3/files/t/es/px/9994.px?nocab=1"</span></span>
<span id="cb12-711"><a href="#cb12-711"></a>ac <span class="ot">&lt;-</span> <span class="fu">read.px</span>(url4)</span>
<span id="cb12-712"><a href="#cb12-712"></a><span class="fu">write.csv</span>(ac, <span class="at">file =</span> <span class="st">"./datos_pulidos/data_1.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb12-713"><a href="#cb12-713"></a>vivienda_edad <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos_pulidos/data_1.csv"</span>)</span>
<span id="cb12-714"><a href="#cb12-714"></a></span>
<span id="cb12-715"><a href="#cb12-715"></a>dd <span class="ot">&lt;-</span> vivienda_edad <span class="sc">%&gt;%</span></span>
<span id="cb12-716"><a href="#cb12-716"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">regimen =</span> Régimen.de.tenencia.de.la.vivienda.principal, <span class="at">edad =</span> Edad.de.la.persona.de.referencia, <span class="at">sexo =</span> Sexo.de.la.persona.de.referencia) <span class="sc">%&gt;%</span></span>
<span id="cb12-717"><a href="#cb12-717"></a>  <span class="fu">filter</span>(edad <span class="sc">==</span> <span class="st">"De 16 a 29 años"</span>, sexo <span class="sc">==</span> <span class="st">"Ambos sexos"</span>)</span>
<span id="cb12-718"><a href="#cb12-718"></a></span>
<span id="cb12-719"><a href="#cb12-719"></a>p30 <span class="ot">&lt;-</span> dd <span class="sc">%&gt;%</span></span>
<span id="cb12-720"><a href="#cb12-720"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Periodo, <span class="at">y =</span> value, <span class="at">fill =</span> regimen)) <span class="sc">+</span></span>
<span id="cb12-721"><a href="#cb12-721"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb12-722"><a href="#cb12-722"></a>  <span class="fu">theme_ipsum</span>() <span class="sc">+</span></span>
<span id="cb12-723"><a href="#cb12-723"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Año"</span>, <span class="at">y =</span> <span class="st">"% según régimen de tenencia"</span>, </span>
<span id="cb12-724"><a href="#cb12-724"></a>       <span class="at">title =</span> <span class="st">"Régimen de vivienda de 16 a 29 años"</span>,</span>
<span id="cb12-725"><a href="#cb12-725"></a>       <span class="at">subtitle =</span> <span class="st">"Datos porcentuales"</span>,</span>
<span id="cb12-726"><a href="#cb12-726"></a>       <span class="at">caption =</span> <span class="st">"Elaboración propia a partir de datos del INE"</span>) <span class="sc">+</span></span>
<span id="cb12-727"><a href="#cb12-727"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#66c2a5"</span>, <span class="st">"#fc8d62"</span>, <span class="st">"#8da0cb"</span>, <span class="st">"#e78ac3"</span>), </span>
<span id="cb12-728"><a href="#cb12-728"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Alquiler a precios de mercado"</span>, <span class="st">"Alquiler inferior al precio de mercado"</span>, <span class="st">"Cesión"</span>, <span class="st">"Propiedad"</span>)) <span class="sc">+</span></span>
<span id="cb12-729"><a href="#cb12-729"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>), </span>
<span id="cb12-730"><a href="#cb12-730"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb12-731"><a href="#cb12-731"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">18</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb12-732"><a href="#cb12-732"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb12-733"><a href="#cb12-733"></a></span>
<span id="cb12-734"><a href="#cb12-734"></a>p30</span>
<span id="cb12-735"><a href="#cb12-735"></a><span class="in">```</span></span>
<span id="cb12-736"><a href="#cb12-736"></a></span>
<span id="cb12-737"><a href="#cb12-737"></a>En este gráfico podemos observar cómo el régimen de vivienda entre los jóvenes ha ido variando a lo largo del tiempo. La mayor sustitución ha sido de régimen de propiedad al de alquiler a precios de mercado. También ha aumentado ligeramente el régimen de cesión, es decir; los jóvenes se han trasladado a opciones más asequibles. Aunque los alquileres también suben en las grandes ciudades, siguen siendo opciones más asumibles que pagar la entrada de la hipoteca y su mensualidad, por no hablar de fórmulas utilizadas como el compartir piso.</span>
<span id="cb12-738"><a href="#cb12-738"></a></span>
<span id="cb12-739"><a href="#cb12-739"></a>---</span>
<span id="cb12-740"><a href="#cb12-740"></a></span>
<span id="cb12-741"><a href="#cb12-741"></a><span class="fu"># Otros gráficos bonitos pero poco útiles sobre el salario</span></span>
<span id="cb12-742"><a href="#cb12-742"></a></span>
<span id="cb12-743"><a href="#cb12-743"></a>::: {.panel-tabset}</span>
<span id="cb12-744"><a href="#cb12-744"></a></span>
<span id="cb12-745"><a href="#cb12-745"></a><span class="fu"># Rigeline por grupo de edad</span></span>
<span id="cb12-746"><a href="#cb12-746"></a></span>
<span id="cb12-749"><a href="#cb12-749"></a><span class="in">```{R}</span></span>
<span id="cb12-750"><a href="#cb12-750"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-751"><a href="#cb12-751"></a><span class="fu">library</span>(rio)</span>
<span id="cb12-752"><a href="#cb12-752"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb12-753"><a href="#cb12-753"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb12-754"><a href="#cb12-754"></a></span>
<span id="cb12-755"><a href="#cb12-755"></a>df_edad <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"./datos_pulidos/salario_grupo_edad.csv"</span>)</span>
<span id="cb12-756"><a href="#cb12-756"></a></span>
<span id="cb12-757"><a href="#cb12-757"></a>p1<span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_edad, <span class="fu">aes</span>(<span class="at">x =</span> salario, <span class="at">y =</span> grupo_edad, <span class="at">fill =</span> grupo_edad)) <span class="sc">+</span></span>
<span id="cb12-758"><a href="#cb12-758"></a>  <span class="fu">geom_density_ridges</span>() <span class="sc">+</span></span>
<span id="cb12-759"><a href="#cb12-759"></a>  <span class="fu">theme_ridges</span>() <span class="sc">+</span> </span>
<span id="cb12-760"><a href="#cb12-760"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb12-761"><a href="#cb12-761"></a></span>
<span id="cb12-762"><a href="#cb12-762"></a>p1</span>
<span id="cb12-763"><a href="#cb12-763"></a><span class="in">```</span></span>
<span id="cb12-764"><a href="#cb12-764"></a></span>
<span id="cb12-765"><a href="#cb12-765"></a><span class="fu"># Rigeline por formación</span></span>
<span id="cb12-766"><a href="#cb12-766"></a></span>
<span id="cb12-769"><a href="#cb12-769"></a><span class="in">```{R}</span></span>
<span id="cb12-770"><a href="#cb12-770"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-771"><a href="#cb12-771"></a><span class="fu">library</span>(rio)</span>
<span id="cb12-772"><a href="#cb12-772"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb12-773"><a href="#cb12-773"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb12-774"><a href="#cb12-774"></a></span>
<span id="cb12-775"><a href="#cb12-775"></a>df_formacion <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"./datos_pulidos/salario_formacion.csv"</span>)</span>
<span id="cb12-776"><a href="#cb12-776"></a></span>
<span id="cb12-777"><a href="#cb12-777"></a>p4<span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_formacion, <span class="fu">aes</span>(<span class="at">x =</span> salario, <span class="at">y =</span> formacion, <span class="at">fill =</span> formacion)) <span class="sc">+</span></span>
<span id="cb12-778"><a href="#cb12-778"></a>  <span class="fu">geom_density_ridges</span>() <span class="sc">+</span></span>
<span id="cb12-779"><a href="#cb12-779"></a>  <span class="fu">theme_ridges</span>() <span class="sc">+</span> </span>
<span id="cb12-780"><a href="#cb12-780"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb12-781"><a href="#cb12-781"></a></span>
<span id="cb12-782"><a href="#cb12-782"></a>p4</span>
<span id="cb12-783"><a href="#cb12-783"></a><span class="in">```</span></span>
<span id="cb12-784"><a href="#cb12-784"></a></span>
<span id="cb12-785"><a href="#cb12-785"></a><span class="fu"># Barras agrupadas por edad</span></span>
<span id="cb12-786"><a href="#cb12-786"></a></span>
<span id="cb12-789"><a href="#cb12-789"></a><span class="in">```{R}</span></span>
<span id="cb12-790"><a href="#cb12-790"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-791"><a href="#cb12-791"></a><span class="fu">library</span>(rio)</span>
<span id="cb12-792"><a href="#cb12-792"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb12-793"><a href="#cb12-793"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb12-794"><a href="#cb12-794"></a></span>
<span id="cb12-795"><a href="#cb12-795"></a>df_edad <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"./datos_pulidos/salario_grupo_edad.csv"</span>)</span>
<span id="cb12-796"><a href="#cb12-796"></a></span>
<span id="cb12-797"><a href="#cb12-797"></a>df_edad_01 <span class="ot">&lt;-</span> df_edad <span class="sc">|&gt;</span> </span>
<span id="cb12-798"><a href="#cb12-798"></a>  <span class="fu">filter</span>(grupo_edad <span class="sc">!=</span> <span class="st">"Total"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-799"><a href="#cb12-799"></a>  <span class="fu">filter</span>()</span>
<span id="cb12-800"><a href="#cb12-800"></a></span>
<span id="cb12-801"><a href="#cb12-801"></a>df_edad_01<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_edad_01<span class="sc">$</span>year)</span>
<span id="cb12-802"><a href="#cb12-802"></a></span>
<span id="cb12-803"><a href="#cb12-803"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_edad_01, <span class="fu">aes</span>(<span class="at">fill =</span> grupo_edad, <span class="at">y =</span> salario, <span class="at">x =</span> year))<span class="sc">+</span></span>
<span id="cb12-804"><a href="#cb12-804"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb12-805"><a href="#cb12-805"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Salario por grupo de edad"</span>)</span>
<span id="cb12-806"><a href="#cb12-806"></a></span>
<span id="cb12-807"><a href="#cb12-807"></a>p2</span>
<span id="cb12-808"><a href="#cb12-808"></a><span class="in">```</span></span>
<span id="cb12-809"><a href="#cb12-809"></a></span>
<span id="cb12-810"><a href="#cb12-810"></a><span class="fu"># Barras agrupadas por formación</span></span>
<span id="cb12-811"><a href="#cb12-811"></a></span>
<span id="cb12-814"><a href="#cb12-814"></a><span class="in">```{R}</span></span>
<span id="cb12-815"><a href="#cb12-815"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-816"><a href="#cb12-816"></a><span class="fu">library</span>(rio)</span>
<span id="cb12-817"><a href="#cb12-817"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb12-818"><a href="#cb12-818"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb12-819"><a href="#cb12-819"></a></span>
<span id="cb12-820"><a href="#cb12-820"></a>df_formacion <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"./datos_pulidos/salario_formacion.csv"</span>)</span>
<span id="cb12-821"><a href="#cb12-821"></a></span>
<span id="cb12-822"><a href="#cb12-822"></a>df_form_01 <span class="ot">&lt;-</span> df_formacion <span class="sc">|&gt;</span> </span>
<span id="cb12-823"><a href="#cb12-823"></a>  <span class="fu">filter</span>(formacion <span class="sc">!=</span> <span class="st">"Total"</span>)</span>
<span id="cb12-824"><a href="#cb12-824"></a></span>
<span id="cb12-825"><a href="#cb12-825"></a>df_form_01<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_form_01<span class="sc">$</span>year)</span>
<span id="cb12-826"><a href="#cb12-826"></a></span>
<span id="cb12-827"><a href="#cb12-827"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_form_01, <span class="fu">aes</span>(<span class="at">fill =</span> formacion, <span class="at">y =</span> salario, <span class="at">x =</span> year))<span class="sc">+</span></span>
<span id="cb12-828"><a href="#cb12-828"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb12-829"><a href="#cb12-829"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Salario por formación"</span>)</span>
<span id="cb12-830"><a href="#cb12-830"></a></span>
<span id="cb12-831"><a href="#cb12-831"></a>p5</span>
<span id="cb12-832"><a href="#cb12-832"></a><span class="in">```</span></span>
<span id="cb12-833"><a href="#cb12-833"></a></span>
<span id="cb12-834"><a href="#cb12-834"></a>:::</span>
<span id="cb12-835"><a href="#cb12-835"></a></span>
<span id="cb12-836"><a href="#cb12-836"></a>--- </span>
<span id="cb12-837"><a href="#cb12-837"></a></span>
<span id="cb12-838"><a href="#cb12-838"></a><span class="fu"># Mas información sobre el tema</span></span>
<span id="cb12-839"><a href="#cb12-839"></a></span>
<span id="cb12-840"><a href="#cb12-840"></a>un video de blablabla</span>
<span id="cb12-841"><a href="#cb12-841"></a></span>
<span id="cb12-842"><a href="#cb12-842"></a><span class="kw">&lt;center&gt;&lt;iframe</span> <span class="er">width</span><span class="ot">=</span><span class="st">"560"</span> <span class="er">height</span><span class="ot">=</span><span class="st">"315"</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://www.youtube.com/live/EtIErMd1EYM?si=-LNzHLRcepGHZ-r5"</span><span class="kw">&gt;&lt;/iframe&gt;&lt;/center&gt;</span></span>
<span id="cb12-843"><a href="#cb12-843"></a></span>
</code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">© 2022 Pedro Navaja</div>   
    <div class="nav-footer-center">Hecho con <a href="https://quarto.org">Quarto</a></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/<tu-usuario-github>">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:<tu-mail>@alumni.uv.es">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>